(this["webpackJsonpsecretin-app"]=this["webpackJsonpsecretin-app"]||[]).push([[0],{225:function(e,t,r){var n=r(19).default,s=r(169).default,a=r(14).default,i=r(13).default;!function(e){"use strict";var t=function(e){n(r,e);var t=s(r);function r(){var e;return i(this,r),(e=t.call(this)).message="Invalid hexString",e}return a(r)}(a((function e(t){i(this,e),this.message="Unknown error",this.errorObject="undefined"!==typeof t?t:null})));function r(e){if(e.length%2!==0)throw new t;for(var r=new Uint8Array(e.length/2),n=0;n<e.length;n+=2){var s=parseInt(e.substr(n,2),16);if(Number.isNaN(s))throw new t;r[n/2]=s}return r}function c(e){if(!e)return null;for(var t=new Uint8Array(e),r=[],n=0;n<t.length;n+=1){var s=t[n].toString(16);s.length<2&&(s="0".concat(s)),r.push(s)}return r.join("")}function o(e){for(var t=[],r=0;r<e.length;r+=1)t.push(e.charCodeAt(r));return new Uint8Array(t)}function u(e){return new Uint8Array(e).reduce((function(e,t){return e+String.fromCharCode(t)}),"")}function d(e){var t="SHA-256",r=o(e);return crypto.subtle.digest(t,r).then((function(e){return c(e)}))}function l(){var e={name:"RSA-OAEP",modulusLength:4096,publicExponent:new Uint8Array([1,0,1]),hash:{name:"SHA-256"}},t=!0,r=["wrapKey","unwrapKey","encrypt","decrypt"];return crypto.subtle.generateKey(e,t,r)}function h(){var e={name:"RSA-PSS",modulusLength:4096,publicExponent:new Uint8Array([1,0,1]),hash:{name:"SHA-256"}},t=!0,r=["sign","verify"];return crypto.subtle.generateKey(e,t,r)}function p(){var e={name:"AES-CBC",length:256},t=!0,r=["wrapKey","unwrapKey"];return crypto.subtle.generateKey(e,t,r)}function f(e,t){var r={},n={},s=o(JSON.stringify(e));if("undefined"===typeof t){n={name:"AES-GCM",length:256};var a=!0,i=["encrypt"];return crypto.subtle.generateKey(n,a,i).then((function(e){var t=new Uint8Array(12);return crypto.getRandomValues(t),n={name:"AES-GCM",iv:t,tagLength:128},r.key=e,r.iv=c(t),crypto.subtle.encrypt(n,e,s)})).then((function(e){return r.secret=c(e),r}))}r.key=t;var u=new Uint8Array(12);return crypto.getRandomValues(u),n={name:"AES-GCM",iv:u,tagLength:128},r.iv=c(u),crypto.subtle.encrypt(n,t,s).then((function(e){return r.secret=c(e),r}))}function b(e,t){var n={name:"AES-GCM",iv:r(e.iv),tagLength:128},s=r(e.secret);return crypto.subtle.decrypt(n,t,s).then((function(e){var t=u(e),r=/[\x01-\x09\x0B-\x0C\x0E-\x1F]+/gi;return JSON.parse(t.replace(r,""))}))}function v(e,t){var r={name:"RSA-OAEP",hash:{name:"SHA-256"}},n=o(JSON.stringify(e));return crypto.subtle.encrypt(r,t,n).then((function(e){return c(e)}))}function m(e,t){var n={name:"RSA-OAEP",hash:{name:"SHA-256"}},s=r(e);return crypto.subtle.decrypt(n,t,s).then((function(e){return JSON.parse(u(e))}))}function g(e,t){var r="raw",n={name:"RSA-OAEP",hash:{name:"SHA-256"}};return crypto.subtle.wrapKey(r,e,t,n).then((function(e){return c(e)}))}function y(e,t){var r={name:"RSA-PSS",saltLength:32};return crypto.subtle.sign(r,t,o(e)).then((function(e){return c(e)}))}function j(e,t,n){var s={name:"RSA-PSS",saltLength:32};return crypto.subtle.verify(s,n,r(t),o(e))}function w(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{name:"AES-GCM",length:256},s="raw",a=r(e),i={name:"RSA-OAEP",hash:{name:"SHA-256"}},c=!0,o=["decrypt","encrypt","wrapKey","unwrapKey"];return crypto.subtle.unwrapKey(s,a,t,i,n,c,o)}function O(e){var t="jwk";return crypto.subtle.exportKey(t,e)}function S(e,t){return O(e).then((function(e){var r="jwk",n={name:"RSA-PSS",hash:{name:"SHA-256"}},s=!1,a=[t],i=e;return i.alg="PS256",i.key_ops=a,crypto.subtle.importKey(r,i,n,s,a)}))}function x(e){var t="jwk",r={name:"RSA-OAEP",hash:{name:"SHA-256"}},n=!0,s=["wrapKey","encrypt"];return crypto.subtle.importKey(t,e,r,n,s)}function k(e){var t="jwk",r={name:"RSA-PSS",hash:{name:"SHA-256"}},n=!0,s=["verify"];return crypto.subtle.importKey(t,e,r,n,s)}function C(e,t){var n={},s=o(e),a=!1,i=["deriveKey","deriveBits"];return crypto.subtle.importKey("raw",s,{name:"PBKDF2"},a,i).then((function(e){var s,o;if("undefined"===typeof t){s=new Uint8Array(32),crypto.getRandomValues(s);var u=new Uint8Array(1);crypto.getRandomValues(u),o=1e5+u[0]}else s=r(t.salt),o="undefined"===typeof t.iterations?1e4:t.iterations;n.salt=c(s),n.iterations=o;var d={name:"PBKDF2",salt:s,iterations:o,hash:{name:"SHA-256"}},l={name:"AES-CBC",length:256};return a=!0,i=["wrapKey","unwrapKey"],crypto.subtle.deriveKey(d,e,l,a,i)})).then((function(e){return n.key=e,crypto.subtle.exportKey("raw",e)})).then((function(e){return crypto.subtle.digest("SHA-256",e)})).then((function(e){return n.hash=c(e),n}))}function U(e,t){var r={},n="jwk",s=new Uint8Array(16);crypto.getRandomValues(s);var a={name:"AES-CBC",iv:s};return r.iv=c(s),crypto.subtle.wrapKey(n,t,e,a).then((function(e){return r.key=c(e),r}))}function A(e,t){var n="jwk",s=r(t.privateKey),a={name:"AES-CBC",iv:r(t.iv)},i={name:"RSA-OAEP",hash:{name:"sha-256"}},c=!0,o=["unwrapKey","decrypt"];return crypto.subtle.unwrapKey(n,s,e,a,i,c,o)}function P(e,t){var n="jwk",s=r(t.privateKey),a={name:"AES-CBC",iv:r(t.iv)},i={name:"RSA-PSS",hash:{name:"sha-256"}},c=!0,o=["sign"];return crypto.subtle.unwrapKey(n,s,e,a,i,c,o)}function N(e,t){var n="jwk",s=r(t.key),a={name:"AES-CBC",iv:r(t.iv)},i=a,c=!0,o=["wrapKey","unwrapKey"];return crypto.subtle.unwrapKey(n,s,e,a,i,c,o)}function T(){return crypto.randomUUID()}var D={convertOAEPToPSS:S,decryptAESGCM256:b,decryptRSAOAEP:m,derivePassword:C,encryptAESGCM256:f,encryptRSAOAEP:v,exportClearKey:O,exportKey:U,generateWrappingKey:p,genRSAOAEP:l,genRSAPSS:h,getSHA256:d,importKey:N,importPrivateKey:A,importPrivateKeySign:P,importPublicKey:x,importPublicKeySign:k,sign:y,unwrapRSAOAEP:w,verify:j,wrapRSAOAEP:g,randomUUID:T};e.convertOAEPToPSS=S,e.decryptAESGCM256=b,e.decryptRSAOAEP=m,e.default=D,e.derivePassword=C,e.encryptAESGCM256=f,e.encryptRSAOAEP=v,e.exportClearKey=O,e.exportKey=U,e.genRSAOAEP=l,e.genRSAPSS=h,e.generateWrappingKey=p,e.getSHA256=d,e.importKey=N,e.importPrivateKey=A,e.importPrivateKeySign=P,e.importPublicKey=x,e.importPublicKeySign=k,e.randomUUID=T,e.sign=y,e.unwrapRSAOAEP=w,e.verify=j,e.wrapRSAOAEP=g,Object.defineProperty(e,"__esModule",{value:!0})}(t)},37:function(e,t,r){var n=r(2).default,s=r(167).default,a=r(69),i=r(246).default,c=r(247).default,o=r(160).default,u=r(19).default,d=r(169).default,l=r(14).default,h=r(13).default;e.exports=function(){"use strict";var e="2.5.3",t={allowPassphrases:!0,maxLength:128,minLength:10,minPhraseLength:20,minOptionalTestsToPass:4},r=[function(e){if(e.length<t.minLength)throw new Error("The password must be at least ".concat(t.minLength," characters long."))},function(e){if(e.length>t.maxLength)throw new Error("The password must be fewer than ".concat(t.maxLength," characters."))},function(e){if(/(.)\1{2,}/.test(e))throw new Error("The password may not contain sequences of three or more repeated characters.")},function(e){if(!/[a-z]/.test(e))throw new Error("The password must contain at least one lowercase letter.")},function(e){if(!/[A-Z]/.test(e))throw new Error("The password must contain at least one uppercase letter.")},function(e){if(!/[0-9]/.test(e))throw new Error("The password must contain at least one number.")},function(e){if(!/[^A-Za-z0-9]/.test(e))throw new Error("The password must contain at least one special character.")}];function p(e){r.forEach((function(t){t(e)}))}var f=l((function e(t){h(this,e),this.message="Unknown error",this.errorObject="undefined"!==typeof t?t:null})),b=function(e){u(r,e);var t=d(r);function r(){var e;return h(this,r),(e=t.call(this)).message="Utils.xorSeed expect 32 bytes Uint8Arrays",e}return l(r)}(f),v=function(e){u(r,e);var t=d(r);function r(){var e;return h(this,r),(e=t.call(this)).message="Invalid hexString",e}return l(r)}(f),m=function(e){u(r,e);var t=d(r);function r(){var e;return h(this,r),(e=t.call(this)).message="Something goes wrong.",e}return l(r)}(f),g=function(e){u(r,e);var t=d(r);function r(){var e;return h(this,r),(e=t.call(this)).message="Server error",e}return l(r)}(f),y=function(e){u(r,e);var t=d(r);function r(){var e;return h(this,r),(e=t.call(this)).message="User not found",e}return l(r)}(f),j=function(e){u(r,e);var t=d(r);function r(){var e;return h(this,r),(e=t.call(this)).message="Username already exists",e}return l(r)}(f),w=function(e){u(r,e);var t=d(r);function r(){var e;return h(this,r),(e=t.call(this)).message="Need TOTP token",e}return l(r)}(f),O=function(e){u(r,e);var t=d(r);function r(){var e;return h(this,r),(e=t.call(this)).message="You are disconnected",e}return l(r)}(f),S=function(e){u(r,e);var t=d(r);function r(){var e;return h(this,r),(e=t.call(this)).message="Invalid signature",e}return l(r)}(f),x=function(e){u(r,e);var t=d(r);function r(){var e;return h(this,r),(e=t.call(this)).message="You don't have this secret",e}return l(r)}(f),k=function(e){u(r,e);var t=d(r);function r(){var e;return h(this,r),(e=t.call(this)).message="Folder not found",e}return l(r)}(f),C=function(e){u(r,e);var t=d(r);function r(){var e;return h(this,r),(e=t.call(this)).message="You can't put this folder in itself.",e}return l(r)}(f),U=function(e){u(r,e);var t=d(r);function r(){var e;return h(this,r),(e=t.call(this)).message="LocalStorage unavailable",e}return l(r)}(f),A=function(e){u(r,e);var t=d(r);function r(){var e;return h(this,r),(e=t.call(this)).message="Invalid password",e}return l(r)}(f),P=function(e){u(r,e);var t=d(r);function r(){var e;return h(this,r),(e=t.call(this)).message="You can't edit this secret",e}return l(r)}(f),N=function(e){u(r,e);var t=d(r);function r(){var e;return h(this,r),(e=t.call(this)).message="You can't share this secret",e}return l(r)}(f),T=function(e){u(r,e);var t=d(r);function r(){var e;return h(this,r),(e=t.call(this)).message="You can't unshare this secret",e}return l(r)}(f),D=function(e){u(r,e);var t=d(r);function r(){var e;return h(this,r),(e=t.call(this)).message="You can't unshare with yourself",e}return l(r)}(f),K=function(e){u(r,e);var t=d(r);function r(){var e;return h(this,r),(e=t.call(this)).message="You can't share with yourself",e}return l(r)}(f),F=function(e){u(r,e);var t=d(r);function r(){var e;return h(this,r),(e=t.call(this)).message="Wow you are unlucky ! SecretID already exists",e}return l(r)}(f),I=function(e){u(r,e);var t=d(r);function r(){var e;return h(this,r),(e=t.call(this)).message="Secret not found",e}return l(r)}(f),E=function(e){u(r,e);var t=d(r);function r(){var e;return h(this,r),(e=t.call(this)).message="You can't generate new key for this secret",e}return l(r)}(f),R=function(e){u(r,e);var t=d(r);function r(){var e;return h(this,r),(e=t.call(this)).message="Secret not shared with this user",e}return l(r)}(f),M=function(e){u(r,e);var t=d(r);function r(){var e;return h(this,r),(e=t.call(this)).message="Friend not found",e}return l(r)}(f),L=function(e){u(r,e);var t=d(r);function r(){var e;return h(this,r),(e=t.call(this)).message="Offline",e}return l(r)}(f),B=function(e){u(r,e);var t=d(r);function r(){var e;return h(this,r),(e=t.call(this)).message="Not available in standalone mode",e}return l(r)}(f),H=l((function e(t){h(this,e),t.constructor!==String?this.error=t:this.error="Unknown error"===t?new g:"User not found"===t?new y:"Username already exists"===t?new j:"Need TOTP token"===t?new w:"You are disconnected"===t?new O:"Invalid signature"===t?new S:"You don't have this secret"===t?new x:"Folder not found"===t?new k:"You can't put this folder in itself."===t?new C:"LocalStorage unavailable"===t?new U:"Invalid Password"===t?new A:"You can't edit this secret"===t?new P:"You can't share this secret"===t?new N:"You can't unshare this secret"===t?new T:"You can't unshare with yourself"===t?new D:"You can't share with yourself"===t?new K:"Secret already exists"===t?new F:"Secret not found"===t?new I:"You can't generate new key for this secret"===t?new E:"Secret not shared with this user"===t?new R:"Friend not found"===t?new M:"Offline"===t?new L:"Not available in standalone mode"===t?new B:"Something goes wrong."===t?new m:new f(t)})),_={Error:f,ServerUnknownError:g,UserNotFoundError:y,UsernameAlreadyExistsError:j,NeedTOTPTokenError:w,DisconnectedError:O,InvalidSignatureError:S,DontHaveSecretError:x,FolderNotFoundError:k,FolderInItselfError:C,LocalStorageUnavailableError:U,WrappingError:H,InvalidPasswordError:A,CantEditSecretError:P,CantShareSecretError:N,CantUnshareSecretError:T,CantUnshareWithYourselfError:D,CantShareWithYourselfError:K,SecretAlreadyExistsError:F,SecretNotFoundError:I,CantGenerateNewKeyError:E,NotSharedWithUserError:R,FriendNotFoundError:M,OfflineError:L,InvalidHexStringError:v,XorSeedError:b,NotAvailableError:B,SomethingGoesWrong:m},z=l((function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;h(this,e),this.message="Unknown status",this.state=t,this.total=r})),G=function(e){u(r,e);var t=d(r);function r(){var e;return h(this,r),(e=t.call(this)).message="Password derivation",e}return l(r)}(z),J=function(e){u(r,e);var t=d(r);function r(){var e;return h(this,r),(e=t.call(this)).message="Retrieve derivation parameters",e}return l(r)}(z),Y=function(e){u(r,e);var t=d(r);function r(){var e;return h(this,r),(e=t.call(this)).message="Get user encrypted datas",e}return l(r)}(z),V=function(e){u(r,e);var t=d(r);function r(){var e;return h(this,r),(e=t.call(this)).message="Get encrypted protect key",e}return l(r)}(z),W=function(e){u(r,e);var t=d(r);function r(){var e;return h(this,r),(e=t.call(this)).message="Import public key",e}return l(r)}(z),q=function(e){u(r,e);var t=d(r);function r(){var e;return h(this,r),(e=t.call(this)).message="Decrypt private key",e}return l(r)}(z),Q=function(e){u(r,e);var t=d(r);function r(){var e;return h(this,r),(e=t.call(this)).message="Decrypt user options",e}return l(r)}(z),$=function(e){u(r,e);var t=d(r);function r(){var e;return h(this,r),(e=t.call(this)).message="Decrypt metadata cache",e}return l(r)}(z),X=function(e){u(r,e);var t=d(r);function r(){var e;return h(this,r),(e=t.call(this)).message="End decrypt metadata",e}return l(r)}(z),Z=function(e){u(r,e);var t=d(r);function r(e,n){var s;return h(this,r),(s=t.call(this,e,n)).message="Decrypt metadata",s}return l(r,[{key:"step",value:function(){this.state+=1}}]),r}(z),ee=function(e){u(r,e);var t=d(r);function r(e,n){var s;return h(this,r),(s=t.call(this,e,n)).message="Import secret",s}return l(r,[{key:"step",value:function(){this.state+=1}}]),r}(z),te={Status:z,GetDerivationStatus:J,PasswordDerivationStatus:G,GetUserStatus:Y,ImportPublicKeyStatus:W,DecryptPrivateKeyStatus:q,DecryptUserOptionsStatus:Q,DecryptMetadataCacheStatus:$,DecryptMetadataStatus:Z,EndDecryptMetadataStatus:X,GetProtectKeyStatus:V,ImportSecretStatus:ee},re='!@#$%^&*()+_=}{[]|:;"?.><,`~',ne="aeiouy",se="bcdfghjklmnpqrstvwxz",ae="0123456789",ie="[]i;lLI|`'\"oO09g8B";function ce(e){var t=new Uint8Array(1);return crypto.getRandomValues(t),t[0]%e}function oe(e){return e.replace(/[-/\\^$*+?.()|[\]{}]/g,"\\$&")}var ue=function(e){return null!=e.match(/\d+/g)},de=function(e){return e.toUpperCase()!==e&&e.toLowerCase()!==e},le=function(e){var t="[".concat(oe(re),"]"),r=new RegExp(t);return null!=e.match(r)},he=function(e,t){return t.numbers===ue(e)&&t.mixedCase===de(e)&&t.symbols===le(e)},pe=function(e){var t=[],r=ne+se;return t.push.apply(t,o(r)),e.contentRules.mixedCase&&t.push.apply(t,o(r.toUpperCase())),e.contentRules.numbers&&t.push.apply(t,o(ae)),e.contentRules.symbols&&t.push.apply(t,o(re)),!1===e.allowSimilarChars?t.filter((function(e){return!ie.includes(e)})):t},fe=function(e,t){return o(e).filter((function(e){return!t.includes(e)})).join("")},be=function(e){var t="";if(e.readable){for(var r=fe(se,"qhc"),n=fe(ne,"y"),s=Boolean(ce(1)),a=0;a<e.length;a+=1){var i=s?r:n;s=!s,t+=i[ce(i.length)]}for(var c=o(t),u=5,d=u;d<t.length;d+=u+1)c[d===t.length-1?d-1:d]="-";t=c.join("")}else for(var l=pe(e),h=0;h<e.length;h+=1)t+=l[ce(l.length)];return t},ve=function e(t){var r=c(c({},{length:20,readable:!1,allowSimilarChars:!1,strictRules:!0,contentRules:{numbers:!0,mixedCase:!0,symbols:!0}}),t),n=r.contentRules,s=be(r);return r.strictRules&&!r.readable?he(s,n)?s:e(t):s};function me(e){if(e.length%2!==0)throw new v;for(var t=new Uint8Array(e.length/2),r=0;r<e.length;r+=2){var n=parseInt(e.substr(r,2),16);if(Number.isNaN(n))throw new v;t[r/2]=n}return t}function ge(e){if(!e)return null;for(var t=new Uint8Array(e),r=[],n=0;n<t.length;n+=1){var s=t[n].toString(16);s.length<2&&(s="0".concat(s)),r.push(s)}return r.join("")}function ye(e){for(var t=[],r=0;r<e.length;r+=1)t.push(e.charCodeAt(r));return new Uint8Array(t)}function je(e){return e.split("").map((function(e){return"0".concat(e.charCodeAt(0).toString(16)).slice(-2)})).join("")}function we(e){for(var t=e.toString(),r="",n=0;n<t.length;n+=2)r+=String.fromCharCode(parseInt(t.substr(n,2),16));return r}function Oe(e){return new Uint8Array(e).reduce((function(e,t){return e+String.fromCharCode(t)}),"")}function Se(){var e=8,t=5,r=[],n=new Uint8Array(e/2*t);crypto.getRandomValues(n);for(var s=ge(n),a=0;a<t;a+=1){var i=s.slice(a*e,(a+1)*e);r.push(i)}return r}function xe(){var e=new Uint8Array(32);crypto.getRandomValues(e);var t,r,n=3,s=0,a="",i="ABCDEFGHIJKLMNOPQRSTUVWXYZ234567";for(r=0;r<e.length;r+=1)a+=i[31&(s|(t=e[r])>>n)],n>5&&(a+=i[31&t>>(n-=5)]),s=t<<(n=5-n),n=8-n;return 3!==n&&(a+=i[31&s],n=3,s=0),{b32:a,raw:e}}function ke(){try{var e=window.localStorage,t="__storage_test__";return e.setItem(t,t),e.removeItem(t),!0}catch(r){return!1}}function Ce(e,t){if(e instanceof Uint8Array&&t instanceof Uint8Array&&32===e.length&&32===t.length){var r,n=new Uint8Array(32);for(r=0;r<32;r+=1)n[r]=e[r]^t[r];return ge(n)}throw new b}function Ue(e,t){if(e instanceof Uint8Array&&t instanceof Uint8Array&&32===t.length&&4===e.length){var r,n=new Uint8Array(e.length);for(r=0;r<e.length;r+=1)n[r]=e[r]^t[r];return ge(n)}throw new b}function Ae(e){var t=Math.trunc(Date.now());e.total<2?console.log("".concat(t," : ").concat(e.message)):console.log("".concat(t," : ").concat(e.message," (").concat(e.state,"/").concat(e.total,")"))}var Pe="Secret-in:",Ne={xorRescueCode:Ue,generateRescueCodes:Se,generateSeed:xe,hexStringToUint8Array:me,bytesToHexString:ge,asciiToUint8Array:ye,bytesToASCIIString:Oe,xorSeed:Ce,defaultProgress:Ae,asciiToHexString:je,hexStringToAscii:we,PasswordGenerator:{hasNumber:ue,hasMixedCase:de,hasSymbol:le,checkStrictRules:he,buildCharset:pe,getRandomPassword:be,generatePassword:ve,generateRandomNumber:ce,escapeRegExp:oe},SecretinPrefix:Pe},Te=function(){function e(t,r){h(this,e),this.db="object"===typeof t?t:{users:{},secrets:{}},this.getSHA256=r}return l(e,[{key:"userExists",value:function(e,t){return this.retrieveUser(e,"undefined",t).then((function(){return!0}),(function(){return!1}))}},{key:"addUser",value:function(e){var t,r=this,n=e.username,s=e.privateKey,a=e.publicKey,i=e.privateKeySign,c=e.publicKeySign,o=e.pass,u=e.options;return this.getSHA256(n).then((function(e){return t=e,new Promise((function(e,n){"undefined"===typeof r.db.users[t]?e(r.getSHA256(o.hash)):n(new j)}))})).then((function(e){r.db.users[t]={pass:{salt:o.salt,hash:e,iterations:o.iterations},privateKeySign:i,publicKeySign:c,privateKey:s,publicKey:a,keys:{},options:u}}))}},{key:"addSecret",value:function(e,t){var r=this;return new Promise((function(e,n){"undefined"!==typeof r.db.users[t.hashedUsername]?("undefined"===typeof r.db.secrets[t.hashedTitle]&&(r.db.secrets[t.hashedTitle]={secret:t.secret,metadatas:t.metadatas,history:t.history,iv:t.iv,iv_meta:t.iv_meta,iv_history:t.iv_history,users:[t.hashedUsername],rev:"Standalone"},r.db.users[t.hashedUsername].keys[t.hashedTitle]={key:t.wrappedKey,rights:2},e()),n(new F)):n(new y)}))}},{key:"deleteSecret",value:function(e,t){var r,n=this;return this.getSHA256(e.username).then((function(e){if(r=e,"undefined"!==typeof n.db.users[r]){if("undefined"===typeof n.db.secrets[t])return Promise.reject(new I);delete n.db.users[r].keys[t];var s=n.db.secrets[t].users.indexOf(r);return s>-1&&n.db.secrets[t].users.splice(s,1),0===n.db.secrets[t].users.length&&delete n.db.secrets[t],Promise.resolve()}return Promise.reject(new y)}))}},{key:"editSecret",value:function(e,t,r){var n,s=this;return this.getSHA256(e.username).then((function(e){return n=e,"undefined"!==typeof s.db.users[n]?"undefined"!==typeof s.db.secrets[r]?"undefined"===typeof s.db.users[n].keys[r].rights||s.db.users[n].keys[r].rights<=0?Promise.reject(new P):(s.db.secrets[r].iv=t.iv,s.db.secrets[r].secret=t.secret,s.db.secrets[r].iv_meta=t.iv_meta,s.db.secrets[r].metadatas=t.metadatas,s.db.secrets[r].editOffline=!0,s.db.secrets[r].iv_history=t.iv_history,s.db.secrets[r].history=t.history,Promise.resolve()):Promise.reject(new I):Promise.reject(new y)}))}},{key:"newKey",value:function(e,t,r,n){var s,a=this;return this.getSHA256(e.username).then((function(e){return s=e,"undefined"!==typeof a.db.users[s]?"undefined"!==typeof a.db.secrets[t]?"undefined"===typeof a.db.users[s].keys[t].rights||a.db.users[s].keys[t].rights<=1?Promise.reject(new E):(a.db.secrets[t].iv=r.iv,a.db.secrets[t].secret=r.secret,a.db.secrets[t].iv_meta=r.iv_meta,a.db.secrets[t].metadatas=r.metadatas,a.db.secrets[t].iv_history=r.iv_history,a.db.secrets[t].history=r.history,n.forEach((function(e){"undefined"!==typeof a.db.users[e.user]&&"undefined"!==typeof a.db.users[e.user].keys[t]&&(a.db.users[e.user].keys[t].key=e.key)})),Promise.resolve()):Promise.reject(new I):Promise.reject(new y)}))}},{key:"unshareSecret",value:function(e,t,r){var n,s=this,a=[];return this.getSHA256(e.username).then((function(e){n=e;var r=[];return t.forEach((function(e){r.push(s.getSHA256(e))})),Promise.all(r)})).then((function(e){if(e.forEach((function(e){a.push(e)})),"undefined"!==typeof s.db.users[n]){if("undefined"!==typeof s.db.secrets[r]){if("undefined"!==typeof s.db.users[n].keys[r].rights&&s.db.users[n].keys[r].rights>1){var t=0,i=0,c="Secret unshared";return a.forEach((function(e){if(n!==e){var o=s.db.users[e];if("undefined"===typeof o)throw new R;if("undefined"===typeof o.keys[r])throw new R;delete o.keys[r];var u=s.db.secrets[r].users.indexOf(e);s.db.secrets[r].users.splice(u,1),i+=1}else t=1,1===a.length&&(c="You can't unshare with yourself")})),i===a.length-t?c:Promise.reject(new m)}return Promise.reject(new T)}return Promise.reject(new I)}return Promise.reject(new y)}))}},{key:"shareSecret",value:function(e,t){var r,n=this;return this.getSHA256(e.username).then((function(e){r=e;var s=n.db.users[r];if("undefined"!==typeof s){var a=0;return t.forEach((function(e){if(e.friendName===r)throw new K;if("undefined"===typeof n.db.secrets[e.hashedTitle])throw new I;if(!("undefined"!==typeof s.keys[e.hashedTitle].rights&&s.keys[e.hashedTitle].rights>1))throw new N;var t=n.db.users[e.friendName];if("undefined"===typeof t)throw new M;t.keys[e.hashedTitle]={key:e.wrappedKey,rights:e.rights};var i=n.db.secrets[e.hashedTitle].users;i.indexOf(e.friendName)<0&&i.push(e.friendName),a+=1})),a!==t.length?Promise.reject(new m):Promise.resolve()}return Promise.reject(new y)}))}},{key:"retrieveUser",value:function(e,t,r){var n,s=this,a=e,i=Promise.resolve();return r||(i=i.then((function(){return s.getSHA256(e)})).then((function(e){a=e}))),i.then((function(){return"undefined"===typeof s.db.users[a]?Promise.reject(new y):(n=JSON.parse(JSON.stringify(s.db.users[a])),s.getSHA256(t))})).then((function(e){if(delete n.keys,e===n.pass.hash)return n;var t=new Uint8Array(3232),r=new Uint8Array(16),s=new Uint8Array(32);return crypto.getRandomValues(t),crypto.getRandomValues(r),crypto.getRandomValues(s),n.privateKey={privateKey:ge(t),iv:ge(r)},n.pass.hash=s,n}))}},{key:"getDerivationParameters",value:function(e,t){return this.retrieveUser(e,"undefined",t).then((function(e){return{totp:e.pass.totp,salt:e.pass.salt,iterations:e.pass.iterations}}))}},{key:"getPublicKey",value:function(e,t){return this.retrieveUser(e,"undefined",t).then((function(e){return e.publicKey}))}},{key:"getUser",value:function(e,t){return this.retrieveUser(e,t,!1)}},{key:"getUserWithSignature",value:function(e){var t,r=this;return this.getSHA256(e.username).then((function(e){return t=e,new Promise((function(e,n){if("undefined"===typeof r.db.users[t])n(new y);else{var s=JSON.parse(JSON.stringify(r.db.users[t])),a={};Object.keys(s.keys).forEach((function(e){var t=r.db.secrets[e];a[e]={iv:t.iv_meta,secret:t.metadatas}})),s.metadatas=a,e(s)}}))}))}},{key:"getSecret",value:function(e){var t=this;return new Promise((function(r,n){"undefined"===typeof t.db.secrets[e]?n(new x):r(t.db.secrets[e])}))}},{key:"getAllMetadatas",value:function(e){var t=this,r={};return new Promise((function(n){Object.keys(e.keys).forEach((function(e){var n=t.db.secrets[e];r[e]={iv:n.iv_meta,secret:n.metadatas}})),n(r)}))}},{key:"getHistory",value:function(e,t){var r=this;return new Promise((function(e,n){if("undefined"===typeof r.db.secrets[t])n(new x);else{var s=r.db.secrets[t];e({iv:s.iv_history,secret:s.history})}}))}},{key:"getProtectKeyParameters",value:function(){return Promise.reject(new B)}},{key:"getDb",value:function(){var e=this;return new Promise((function(t){t(e.db)}))}},{key:"editUser",value:function(e,t){var r,n=this;return this.getSHA256(e.username).then((function(e){return r=e,new Promise((function(e,s){"undefined"!==typeof n.db.users[r]?"undefined"!==typeof t.privateKey&&"undefined"!==typeof t.pass?e(n.changePassword(r,t.privateKey,t.pass)):("undefined"===typeof t.options?n.db.users[r].metadataCache=t:n.db.users[r].options=t,e()):s(new y)}))}))}},{key:"changePassword",value:function(e,t,r){var n=this;return this.getSHA256(r.hash).then((function(s){var a=r;a.hash=s,n.db.users[e].privateKey=t,n.db.users[e].pass=a}))}},{key:"isOnline",value:function(){return new Promise((function(e){e(!1)}))}}]),e}(),De=function(){function e(t,r){h(this,e),this.cryptoAdapter=r,this.username=t,this.publicKey=null,this.publicKeySign=null,this.privateKey=null,this.privateKeySign=null,this.keys={},this.hash="",this.totp=!1,this.metadatas={},this.options=e.defaultOptions}return l(e,[{key:"disconnect",value:function(){delete this.username,delete this.publicKey,delete this.publicKeySign,delete this.privateKey,delete this.privateKeySign,delete this.metadatas,delete this.keys,delete this.hash,delete this.totp,delete this.options}},{key:"sign",value:function(e){return this.cryptoAdapter.sign(e,this.privateKeySign)}},{key:"verify",value:function(e,t){return this.cryptoAdapter.verify(e,t,this.publicKeySign)}},{key:"generateMasterKey",value:function(){var e=this;return this.cryptoAdapter.genRSAOAEP().then((function(t){return e.publicKey=t.publicKey,e.privateKey=t.privateKey,e.cryptoAdapter.genRSAPSS()})).then((function(t){e.publicKeySign=t.publicKey,e.privateKeySign=t.privateKey}))}},{key:"deprecatedConvertOAEPToPSS",value:function(){var e=i(a.mark((function e(){return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.isUsingLegacyKey=!0,e.next=3,this.cryptoAdapter.convertOAEPToPSS(this.publicKey,"verify");case 3:return this.publicKeySign=e.sent,e.next=6,this.cryptoAdapter.convertOAEPToPSS(this.privateKey,"sign");case 6:this.privateKeySign=e.sent;case 7:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"exportPublicKey",value:function(){return this.cryptoAdapter.exportClearKey(this.publicKey)}},{key:"importPublicKey",value:function(){var e=i(a.mark((function e(t){return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.cryptoAdapter.importPublicKey(t);case 2:this.publicKey=e.sent;case 3:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"exportPrivateKey",value:function(e){var t=this,r={};return this.cryptoAdapter.derivePassword(e).then((function(e){return r.salt=e.salt,t.hash=e.hash,r.hash=t.hash,r.iterations=e.iterations,t.cryptoAdapter.exportKey(e.key,t.privateKey)})).then((function(e){return{privateKey:{privateKey:e.key,iv:e.iv},pass:r}}))}},{key:"importPrivateKey",value:function(e,t){var r=this;return this.cryptoAdapter.importPrivateKey(e,t).then((function(e){r.privateKey=e})).catch((function(){return Promise.reject(new A)}))}},{key:"exportKeyPairSign",value:function(){var e=i(a.mark((function e(){var t,r,n,s,i,c;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.isUsingLegacyKey){e.next=2;break}return e.abrupt("return",{publicKeySign:null,privateKeySign:null});case 2:return e.next=4,this.cryptoAdapter.exportClearKey(this.publicKeySign);case 4:return t=e.sent,e.next=7,this.cryptoAdapter.generateWrappingKey();case 7:return r=e.sent,e.next=10,this.cryptoAdapter.exportKey(r,this.privateKeySign);case 10:return n=e.sent,s=n.iv,i=n.key,e.next=15,this.wrapKey(r,this.publicKey);case 15:return c=e.sent,e.abrupt("return",{publicKeySign:t,privateKeySign:{iv:s,wrapped:i,key:c}});case 17:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"importKeyPairSign",value:function(){var e=i(a.mark((function e(t){var r,n,s,i,c,o;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.publicKeySign,n=t.privateKeySign,e.next=3,this.cryptoAdapter.importPublicKeySign(r);case 3:return this.publicKeySign=e.sent,s=n.iv,i=n.wrapped,c=n.key,e.next=7,this.unwrapKey(c,{name:"AES-CBC",length:256});case 7:return o=e.sent,e.next=10,this.cryptoAdapter.importPrivateKeySign(o,{privateKey:i,iv:s});case 10:this.privateKeySign=e.sent;case 11:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"exportBigPrivateData",value:function(e){var t=this,r={};return this.cryptoAdapter.encryptAESGCM256(e).then((function(e){return r.secret=e.secret,r.iv=e.iv,t.wrapKey(e.key,t.publicKey)})).then((function(e){return r.wrappedKey=e,r}))}},{key:"importBigPrivateData",value:function(e){var t=this;return this.unwrapKey(e.wrappedKey).then((function(r){return t.cryptoAdapter.decryptAESGCM256(e,r)}))}},{key:"exportPrivateData",value:function(e){var t=this,r={};return this.cryptoAdapter.encryptRSAOAEP(e,this.publicKey).then((function(e){return r.data=e,t.sign(r.data)})).then((function(e){return r.signature=e,r}))}},{key:"importPrivateData",value:function(e,t){var r=this;return this.verify(e,t).then((function(t){return t?r.cryptoAdapter.decryptRSAOAEP(e,r.privateKey):null}))}},{key:"exportOptions",value:function(){return this.exportPrivateData(this.options).then((function(e){return{options:e.data,signature:e.signature}}))}},{key:"importOptions",value:function(t){var r=this;return"undefined"===typeof t?(this.options=e.defaultOptions,Promise.resolve(null)):this.importPrivateData(t.options,t.signature).then((function(t){r.options=t||e.defaultOptions}))}},{key:"shareSecret",value:function(e,t,r){var n=this,s={hashedTitle:r};return this.unwrapKey(t).then((function(t){return n.wrapKey(t,e.publicKey)})).then((function(t){return s.wrappedKey=t,n.cryptoAdapter.getSHA256(e.username)})).then((function(e){return s.friendName=e,s}))}},{key:"editSecret",value:function(e,t,r){var n=this,s=this.metadatas[e];if("undefined"===typeof s)return Promise.reject(new x);var a=new Date;s.lastModifiedAt=a.toISOString(),s.lastModifiedBy=this.username;var i=this.keys[e].key,c={};return this.unwrapKey(i).then((function(e){return n.encryptSecret(s,t,r,e)})).then((function(e){return c.secret=e.secret,c.iv=e.iv,c.metadatas=e.metadatas,c.iv_meta=e.iv_meta,c.history=e.history,c.iv_history=e.iv_history,c}))}},{key:"createSecret",value:function(e,t){var r=this,n=this.cryptoAdapter.randomUUID(),s="".concat(n,"|").concat(e.title),a={},i=e;return this.cryptoAdapter.getSHA256(s).then((function(e){return a.hashedTitle=e,i.id=a.hashedTitle,r.encryptSecret(i,t)})).then((function(e){return a.secret=e.secret,a.iv=e.iv,a.metadatas=e.metadatas,a.iv_meta=e.iv_meta,a.history=e.history,a.iv_history=e.iv_history,a.hashedUsername=e.hashedUsername,r.wrapKey(e.key,r.publicKey)})).then((function(e){return a.wrappedKey=e,a}))}},{key:"exportSecret",value:function(e,t,r,n){var s,a,i=this;return this.decryptSecret(e,t).then((function(t){return s=t,i.decryptSecret(e,r)})).then((function(t){return a=c(c({},t),{},{title:decodeURIComponent(t.title)}),"undefined"===typeof n.iv?Promise.resolve({}):i.decryptSecret(e,n)})).then((function(e){return{secret:s,metadata:a,history:e}}))}},{key:"importSecret",value:function(e,t,r,n){var s=this,a={};return this.encryptSecret(r,t,n).then((function(t){return a.secret=t.secret,a.iv=t.iv,a.metadatas=t.metadatas,a.iv_meta=t.iv_meta,a.history=t.history,a.iv_history=t.iv_history,a.hashedUsername=t.hashedUsername,a.hashedTitle=e,s.wrapKey(t.key,s.publicKey)})).then((function(e){return a.wrappedKey=e,a}))}},{key:"encryptSecret",value:function(e,t,r,n){var s,a=this,i={};return Promise.resolve().then((function(){return Array.isArray(r)?Promise.resolve(r):"undefined"!==typeof r&&"undefined"!==typeof r.iv&&"undefined"!==typeof r.secret?a.decryptSecret(e.id,r):Promise.resolve([])})).then((function(r){return 0!==(s=r).length&&JSON.stringify(s[0].secret)===JSON.stringify(t)||s.unshift({secret:t,lastModifiedAt:e.lastModifiedAt,lastModifiedBy:e.lastModifiedBy}),a.cryptoAdapter.encryptAESGCM256(t,n)})).then((function(t){return i.secret=t.secret,i.iv=t.iv,i.key=t.key,a.cryptoAdapter.encryptAESGCM256(c(c({},e),{},{title:encodeURIComponent(e.title)}),t.key)})).then((function(e){return i.metadatas=e.secret,i.iv_meta=e.iv,a.cryptoAdapter.encryptAESGCM256(s,e.key)})).then((function(e){return i.history=e.secret,i.iv_history=e.iv,a.cryptoAdapter.getSHA256(a.username)})).then((function(e){return i.hashedUsername=e,i}))}},{key:"decryptSecret",value:function(e,t){var r=this;if("undefined"===typeof this.keys[e])return Promise.reject(new x);var n=this.keys[e].key;return this.unwrapKey(n).then((function(e){return r.cryptoAdapter.decryptAESGCM256(t,e)}))}},{key:"unwrapKey",value:function(e,t){return this.cryptoAdapter.unwrapRSAOAEP(e,this.privateKey,t)}},{key:"wrapKey",value:function(e,t){return this.cryptoAdapter.wrapRSAOAEP(e,t)}},{key:"decryptAllMetadatas",value:function(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Ae,n=Object.keys(this.keys),s=new Z(0,n.length);r(s);var a={};return n.reduce((function(n,i){return n.then((function(){return t.decryptSecret(i,e[i]).then((function(e){s.step(),r(s),a[i]=c(c({},e),{},{title:decodeURIComponent(e.title)})}))}))}),Promise.resolve()).then((function(){return a}))}},{key:"activateShortLogin",value:function(e,t){var r,n=this,s={};return this.cryptoAdapter.generateWrappingKey().then((function(e){return r=e,n.cryptoAdapter.exportKey(r,n.privateKey)})).then((function(e){return localStorage.setItem("".concat(Pe,"privateKey"),e.key),localStorage.setItem("".concat(Pe,"privateKeyIv"),e.iv),n.exportKeyPairSign()})).then((function(t){var r=t.privateKeySign,s=t.publicKeySign;return r&&s&&(localStorage.setItem("".concat(Pe,"privateKeySign"),JSON.stringify(r)),localStorage.setItem("".concat(Pe,"publicKeySign"),JSON.stringify(s))),n.cryptoAdapter.derivePassword(e)})).then((function(e){return s.salt=e.salt,s.iterations=e.iterations,s.hash=e.hash,n.cryptoAdapter.exportKey(e.key,r)})).then((function(e){return s.protectKey=e.key,localStorage.setItem("".concat(Pe,"iv"),e.iv),localStorage.setItem("".concat(Pe,"username"),n.username),n.cryptoAdapter.getSHA256(t)})).then((function(e){return s.deviceId=e,localStorage.setItem("".concat(Pe,"deviceName"),t),localStorage.setItem("".concat(Pe,"activatedAt"),(new Date).toISOString()),s}))}},{key:"shortLogin",value:function(e,t){var r=this,n={key:t,iv:localStorage.getItem("".concat(Pe,"iv"))};return this.cryptoAdapter.importKey(e,n).then((function(e){var t={privateKey:localStorage.getItem("".concat(Pe,"privateKey")),iv:localStorage.getItem("".concat(Pe,"privateKeyIv"))};return r.importPrivateKey(e,t)})).then((function(){var e=localStorage.getItem("".concat(Pe,"publicKeySign")),t=localStorage.getItem("".concat(Pe,"privateKeySign"));if(e&&t){var n=JSON.parse(t),s=JSON.parse(e);return r.importKeyPairSign({privateKeySign:n,publicKeySign:s})}return Promise.resolve()})).catch((function(){return Promise.reject(new A)}))}}]),e}();Object.defineProperty(De,"defaultOptions",{value:{timeToClose:30},writable:!1,enumerable:!0,configurable:!1});var Ke=function(){function e(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Te,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:void 0;h(this,e),this.cryptoAdapter=t,this.api=new r(n,this.cryptoAdapter.getSHA256),this.editableDB=!0,this.currentUser={},this.listeners={connectionChange:[]}}return l(e,[{key:"addEventListener",value:function(e,t){this.listeners[e].push(t)}},{key:"removeEventListener",value:function(e,t){var r=this.listeners[e].indexOf(t);this.listeners[e].splice(r,1)}},{key:"dispatchEvent",value:function(e,t){this.listeners[e].map((function(e){return e(t)}))}},{key:"offlineDB",value:function(e){if(this.editableDB){var t="".concat(Pe,"cache_").concat(e||this.currentUser.username),r=localStorage.getItem(t),n=r?JSON.parse(r):{users:{},secrets:{}};this.oldApi=this.api,this.api=new Te(n,this.cryptoAdapter.getSHA256),this.editableDB=!1,this.dispatchEvent("connectionChange",{connection:"offline"}),this.testOnline()}}},{key:"testOnline",value:function(){var e=this;setTimeout(i(a.mark((function t(){return a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,e.oldApi.isOnline();case 3:e.api=e.oldApi,e.editableDB=!0,e.dispatchEvent("connectionChange",{connection:"online"}),"undefined"!==typeof e.currentUser.username&&"undefined"!==typeof window.process&&e.getDb().then((function(){return e.doCacheActions()})),t.next=16;break;case 9:if(t.prev=9,t.t0=t.catch(0),!(t.t0 instanceof L)){t.next=15;break}e.testOnline(),t.next=16;break;case 15:throw t.t0;case 16:case"end":return t.stop()}}),t,null,[[0,9]])}))),1e4)}},{key:"setConflict",value:function(e,t){var r="".concat(Pe,"conflictSecrets").concat(this.currentUser.username),n=localStorage.getItem(r),s=n?JSON.parse(n):{};return s[e]=t,localStorage.setItem(r,JSON.stringify(s))}},{key:"getConflict",value:function(e){var t="".concat(Pe,"conflictSecrets").concat(this.currentUser.username),r=localStorage.getItem(t),n=r?JSON.parse(r):{};return"undefined"!==typeof n[e]?n[e]:e}},{key:"popCacheAction",value:function(){var e="".concat(Pe,"cacheActions_").concat(this.currentUser.username),t=localStorage.getItem(e),r=JSON.parse(t);return r.shift(),localStorage.setItem(e,JSON.stringify(r))}},{key:"pushCacheAction",value:function(e,t){var r="".concat(Pe,"cacheActions_").concat(this.currentUser.username),n=localStorage.getItem(r),s=n?JSON.parse(n):[];s.push({action:e,args:t}),localStorage.setItem(r,JSON.stringify(s))}},{key:"doCacheActions",value:function(){var e=i(a.mark((function e(){var t,r,n,i,c,o,u,d,l,h,p,f,b,v,m;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t="".concat(Pe,"cacheActions_").concat(this.currentUser.username),r=localStorage.getItem(t),n=r?JSON.parse(r):[],i=s(n),e.prev=4,i.s();case 6:if((c=i.n()).done){e.next=54;break}o=c.value,e.t0=o.action,e.next="addSecret"===e.t0?11:"editSecret"===e.t0?20:"renameSecret"===e.t0?36:52;break;case 11:return e.next=13,this.api.addSecret(this.currentUser,o.args[0]);case 13:return this.currentUser.keys[o.args[0].hashedTitle]={key:o.args[0].wrappedKey,rights:2},e.next=16,this.cryptoAdapter.decryptRSAOAEP(o.args[1],this.currentUser.privateKey);case 16:return u=e.sent,this.currentUser.metadatas[o.args[0].hashedTitle]=u,this.popCacheAction(),e.abrupt("break",52);case 20:return d=this.getConflict(o.args[0]),l=o.args[1],e.next=24,this.cryptoAdapter.decryptRSAOAEP(l,this.currentUser.privateKey);case 24:if(h=e.sent,"undefined"!==typeof this.currentUser.keys[d]){e.next=32;break}return e.next=28,this.addSecret("".concat(h.title," (Conflict)"),h.secret);case 28:p=e.sent,this.setConflict(o.args[0],p),e.next=34;break;case 32:return e.next=34,this.editSecret(d,h.secret);case 34:return this.popCacheAction(),e.abrupt("break",52);case 36:return f=this.getConflict(o.args[0]),b=o.args[1],e.next=40,this.cryptoAdapter.decryptRSAOAEP(b,this.currentUser.privateKey);case 40:if(v=e.sent,"undefined"!==typeof this.currentUser.keys[f]){e.next=48;break}return e.next=44,this.addSecret("".concat(v.title," (Conflict)"),v.secret);case 44:m=e.sent,this.setConflict(o.args[0],m),e.next=50;break;case 48:return e.next=50,this.renameSecret(f,v.title);case 50:return this.popCacheAction(),e.abrupt("break",52);case 52:e.next=6;break;case 54:e.next=59;break;case 56:e.prev=56,e.t1=e.catch(4),i.e(e.t1);case 59:return e.prev=59,i.f(),e.finish(59);case 62:case"end":return e.stop()}}),e,this,[[4,56,59,62]])})));function t(){return e.apply(this,arguments)}return t}()},{key:"newUser",value:function(){var e=i(a.mark((function e(t,r){var n,s,i,c,o,u,d,l;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(p(r),this.editableDB){e.next=3;break}throw new L;case 3:return e.prev=3,this.currentUser=new De(t,this.cryptoAdapter),e.next=7,this.api.userExists(t);case 7:if(!e.sent){e.next=10;break}throw new j;case 10:return e.next=12,this.currentUser.generateMasterKey();case 12:return e.next=14,this.currentUser.exportPrivateKey(r);case 14:return n=e.sent,s=n.privateKey,(i=n.pass).totp=!1,i.shortpass=!1,e.next=21,this.currentUser.exportOptions();case 21:return c=e.sent,e.next=24,this.currentUser.exportPublicKey();case 24:return o=e.sent,e.next=27,this.currentUser.exportKeyPairSign();case 27:return u=e.sent,d=u.privateKeySign,l=u.publicKeySign,e.next=32,this.api.addUser({username:this.currentUser.username,privateKey:s,publicKey:o,privateKeySign:d,publicKeySign:l,pass:i,options:c});case 32:if("undefined"===typeof window.process){e.next=35;break}return e.next=35,this.getDb();case 35:return e.abrupt("return",this.currentUser);case 38:if(e.prev=38,e.t0=e.catch(3),!(e.t0 instanceof L)){e.next=43;break}throw this.offlineDB(),e.t0;case 43:throw new H(e.t0).error;case 45:case"end":return e.stop()}}),e,this,[[3,38]])})));function t(t,r){return e.apply(this,arguments)}return t}()},{key:"loginUser",value:function(){var e=i(a.mark((function e(t,r,n){var s,i,c,o,u,d,l,h,p,f,b,v=arguments;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s=v.length>3&&void 0!==v[3]?v[3]:Ae,i=!(v.length>4&&void 0!==v[4])||v[4],e.prev=2,s(new J),e.next=6,this.api.getDerivationParameters(t);case 6:if(!(c=e.sent).totp||"undefined"!==typeof n&&""!==n){e.next=9;break}throw new w;case 9:return s(new G),e.next=12,this.cryptoAdapter.derivePassword(r,c);case 12:return o=e.sent,u=o.hash,d=o.key,s(new Y),e.next=18,this.api.getUser(t,u,n);case 18:return l=e.sent,this.currentUser=new De(t,this.cryptoAdapter),this.currentUser.totp=c.totp,this.currentUser.hash=u,s(new q),e.next=25,this.currentUser.importPrivateKey(d,l.privateKey);case 25:return s(new W),e.next=28,this.currentUser.importPublicKey(l.publicKey);case 28:if(l.publicKeySign&&l.privateKeySign){e.next=33;break}return e.next=31,this.currentUser.deprecatedConvertOAEPToPSS();case 31:e.next=35;break;case 33:return e.next=35,this.currentUser.importKeyPairSign({privateKeySign:l.privateKeySign,publicKeySign:l.publicKeySign});case 35:if(h=localStorage.getItem("".concat(Pe,"shortpass")),p=localStorage.getItem("".concat(Pe,"shortpassSignature")),!(h&&p&&this.editableDB)){e.next=44;break}return e.next=40,this.currentUser.importPrivateData(h,p);case 40:return f=e.sent,b=localStorage.getItem("".concat(Pe,"deviceName")),e.next=44,this.activateShortLogin(f,b);case 44:return e.next=46,this.refreshUser(i,s);case 46:if("undefined"===typeof window.process){e.next=52;break}return e.next=49,this.getDb();case 49:if(!this.editableDB){e.next=52;break}return e.next=52,this.doCacheActions();case 52:return e.abrupt("return",this.currentUser);case 55:if(e.prev=55,e.t0=e.catch(2),!(e.t0 instanceof L)){e.next=62;break}return this.offlineDB(t),e.next=61,this.loginUser(t,r,n,s);case 61:return e.abrupt("return",e.sent);case 62:throw new H(e.t0).error;case 64:case"end":return e.stop()}}),e,this,[[2,55]])})));function t(t,r,n){return e.apply(this,arguments)}return t}()},{key:"updateMetadataCache",value:function(){var e=i(a.mark((function e(t){var r,n,s,i=arguments;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=i.length>1&&void 0!==i[1]?i[1]:Ae,e.next=3,this.currentUser.decryptAllMetadatas(t,r);case 3:return n=e.sent,this.currentUser.metadatas=n,r(new X),e.next=8,this.currentUser.exportBigPrivateData(n);case 8:return s=e.sent,e.next=11,this.api.editUser(this.currentUser,s);case 11:return e.abrupt("return",e.sent);case 12:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"refreshUser",value:function(){var e=i(a.mark((function e(){var t,r,n,s,i=arguments;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=i.length>0&&void 0!==i[0]&&i[0],r=i.length>1&&void 0!==i[1]?i[1]:Ae,n=t,e.prev=3,e.next=6,this.api.getUserWithSignature(this.currentUser);case 6:if(s=e.sent,this.currentUser.keys=s.keys,"undefined"===typeof window.process){e.next=11;break}return e.next=11,this.getDb();case 11:return r(new Q),e.next=14,this.currentUser.importOptions(s.options);case 14:if("undefined"===typeof s.metadataCache){e.next=21;break}return r(new $),e.next=18,this.currentUser.importBigPrivateData(s.metadataCache);case 18:this.currentUser.metadatas=e.sent,e.next=22;break;case 21:n=!0;case 22:if(!n){e.next=27;break}return e.next=25,this.updateMetadataCache(s.metadatas,r);case 25:e.next=28;break;case 27:this.updateMetadataCache(s.metadatas,r);case 28:return e.abrupt("return",!0);case 31:if(e.prev=31,e.t0=e.catch(3),!(e.t0 instanceof L)){e.next=38;break}return this.offlineDB(),e.next=37,this.refreshUser(t,r);case 37:return e.abrupt("return",e.sent);case 38:throw new H(e.t0).error;case 40:case"end":return e.stop()}}),e,this,[[3,31]])})));function t(){return e.apply(this,arguments)}return t}()},{key:"addFolder",value:function(){var e=i(a.mark((function e(t,r){return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.addSecret(t,{},r,"folder");case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)})));function t(t,r){return e.apply(this,arguments)}return t}()},{key:"addSecret",value:function(){var e=i(a.mark((function e(t,r,n){var s,i,c,o,u,d,l=arguments;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s=l.length>3&&void 0!==l[3]?l[3]:"secret",e.prev=1,i=new Date,(c={lastModifiedAt:i.toISOString(),lastModifiedBy:this.currentUser.username,users:{},title:t,type:s}).users[this.currentUser.username]={username:this.currentUser.username,rights:2,folders:{}},"undefined"===typeof n&&(c.users[this.currentUser.username].folders.ROOT=!0),e.next=8,this.currentUser.createSecret(c,r);case 8:if(o=e.sent,u=o.hashedTitle,this.currentUser.keys[o.hashedTitle]={key:o.wrappedKey,rights:c.users[this.currentUser.username].rights},this.editableDB){e.next=16;break}return e.next=14,this.cryptoAdapter.encryptRSAOAEP(c,this.currentUser.publicKey);case 14:d=e.sent,this.pushCacheAction("addSecret",[o,d]);case 16:return e.next=18,this.api.addSecret(this.currentUser,o);case 18:if(this.currentUser.metadatas[u]=c,"undefined"===typeof n){e.next=22;break}return e.next=22,this.addSecretToFolder(u,n);case 22:if("undefined"===typeof window.process){e.next=25;break}return e.next=25,this.getDb();case 25:return e.abrupt("return",u);case 28:if(e.prev=28,e.t0=e.catch(1),!(e.t0 instanceof L)){e.next=35;break}return this.offlineDB(),e.next=34,this.addSecret(t,r,n,s);case 34:return e.abrupt("return",e.sent);case 35:throw new H(e.t0).error;case 37:case"end":return e.stop()}}),e,this,[[1,28]])})));function t(t,r,n){return e.apply(this,arguments)}return t}()},{key:"changePassword",value:function(){var e=i(a.mark((function e(t,r){var n,s,i,o;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(p(t),this.editableDB){e.next=3;break}throw new L;case 3:return e.prev=3,e.next=6,this.api.getDerivationParameters(this.currentUser.username);case 6:return n=e.sent,e.next=9,this.cryptoAdapter.derivePassword(r,n);case 9:if(s=e.sent,(i=s.hash)===this.currentUser.hash){e.next=13;break}throw new A;case 13:return e.next=15,this.currentUser.exportPrivateKey(t);case 15:return o=e.sent,e.next=18,this.api.editUser(this.currentUser,c(c({},o),{},{oldHash:i}));case 18:if("undefined"===typeof window.process){e.next=21;break}return e.next=21,this.getDb();case 21:e.next=30;break;case 23:if(e.prev=23,e.t0=e.catch(3),!(e.t0 instanceof L)){e.next=28;break}throw this.offlineDB(),e.t0;case 28:throw new H(e.t0).error;case 30:case"end":return e.stop()}}),e,this,[[3,23]])})));function t(t,r){return e.apply(this,arguments)}return t}()},{key:"editSecret",value:function(){var e=i(a.mark((function e(t,r){var n,s,i,c,o;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.api.getHistory(this.currentUser,t);case 3:return n=e.sent,e.next=6,this.currentUser.editSecret(t,r,n);case 6:if(s=e.sent,this.editableDB){e.next=17;break}if(!(Object.keys(this.currentUser.metadatas[t].users).length>1)){e.next=10;break}throw new L;case 10:return i=[t],c={secret:r,title:this.currentUser.metadatas[t].title},e.next=14,this.cryptoAdapter.encryptRSAOAEP(c,this.currentUser.publicKey);case 14:o=e.sent,i.push(o),this.pushCacheAction("editSecret",i);case 17:return e.next=19,this.api.editSecret(this.currentUser,s,t);case 19:if("undefined"===typeof window.process){e.next=22;break}return e.next=22,this.getDb();case 22:return e.abrupt("return",!0);case 25:if(e.prev=25,e.t0=e.catch(0),!(e.t0 instanceof L)){e.next=32;break}return this.offlineDB(),e.next=31,this.editSecret(t,r);case 31:return e.abrupt("return",e.sent);case 32:throw new H(e.t0).error;case 34:case"end":return e.stop()}}),e,this,[[0,25]])})));function t(t,r){return e.apply(this,arguments)}return t}()},{key:"editOption",value:function(){var e=i(a.mark((function e(t,r){return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.editableDB){e.next=2;break}throw new L;case 2:return this.currentUser.options[t]=r,e.next=5,this.resetOptions();case 5:return e.abrupt("return",e.sent);case 6:case"end":return e.stop()}}),e,this)})));function t(t,r){return e.apply(this,arguments)}return t}()},{key:"editOptions",value:function(){var e=i(a.mark((function e(t){return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.editableDB){e.next=2;break}throw new L;case 2:return this.currentUser.options=t,e.next=5,this.resetOptions();case 5:return e.abrupt("return",e.sent);case 6:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"resetOptions",value:function(){var e=i(a.mark((function e(){var t;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.editableDB){e.next=2;break}throw new L;case 2:return e.prev=2,e.next=5,this.currentUser.exportOptions();case 5:return t=e.sent,e.next=8,this.api.editUser(this.currentUser,t);case 8:if("undefined"===typeof window.process){e.next=11;break}return e.next=11,this.getDb();case 11:e.next=20;break;case 13:if(e.prev=13,e.t0=e.catch(2),!(e.t0 instanceof L)){e.next=18;break}throw this.offlineDB(),e.t0;case 18:throw new H(e.t0).error;case 20:case"end":return e.stop()}}),e,this,[[2,13]])})));function t(){return e.apply(this,arguments)}return t}()},{key:"addSecretToFolder",value:function(){var e=i(a.mark((function e(t,r){var n,s=this;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.delegateYield(a.mark((function e(){var n,i,c,o,u,d,l,h,p,f,b,v,m,g,y,j,w,O,S,x,k,C;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=s.currentUser.metadatas[r],i=s.currentUser.metadatas[t],c=[],o=0,u=Object.keys(n.users);case 4:if(!(o<u.length)){e.next=19;break}return d=u[o],l=new De(d,s.cryptoAdapter),e.next=9,s.api.getPublicKey(l.username);case 9:return h=e.sent,e.next=12,l.importPublicKey(h);case 12:return e.next=14,s.getSharedSecretObjects(t,l,n.users[l.username].rights,[],!0);case 14:p=e.sent,c.push(p);case 16:o++,e.next=4;break;case 19:return f={},b=[],e.next=23,s.api.getSecret(r,s.currentUser);case 23:return v=e.sent,e.next=26,s.currentUser.decryptSecret(r,v);case 26:return(m=e.sent)[t]=1,e.next=30,s.editSecret(r,m);case 30:if(g=[],c.forEach((function(e){e.forEach((function(e){var t=e;"undefined"===typeof f[t.hashedTitle]&&(f[t.hashedTitle]=[]),f[t.hashedTitle].push({friendName:t.username,folder:t.inFolder}),delete t.inFolder,s.currentUser.username!==t.username&&(delete t.username,g.push(t))}))})),!(g.length>0)){e.next=37;break}if(s.editableDB){e.next=35;break}throw new L;case 35:return e.next=37,s.api.shareSecret(s.currentUser,g);case 37:Object.keys(n.users).forEach((function(e){Object.keys(n.users[e].folders).forEach((function(t){"undefined"!==typeof i.users[e]&&"undefined"!==typeof i.users[e].folders[t]&&b.push(t)}))})),y=a.mark((function e(){var t;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=w[j],f[t].forEach((function(e){var a=s.currentUser.metadatas[t],i={username:e.friendName,rights:n.users[e.friendName].rights};"undefined"!==typeof a.users[e.friendName]?i.folders=a.users[e.friendName].folders:i.folders={},"undefined"!==typeof e.folder?i.folders[e.folder]=!0:i.folders[r]=!0,b.forEach((function(e){delete i.folders[e]})),e.friendName===s.currentUser.username&&(i.rights=2),s.currentUser.metadatas[t].users[e.friendName]=i})),e.next=4,s.resetMetadatas(t);case 4:case"end":return e.stop()}}),e)})),j=0,w=Object.keys(f);case 40:if(!(j<w.length)){e.next=45;break}return e.delegateYield(y(),"t0",42);case 42:j++,e.next=40;break;case 45:O=0,S=b;case 46:if(!(O<S.length)){e.next=61;break}if("ROOT"===(x=S[O])){e.next=58;break}return e.next=51,s.api.getSecret(x,s.currentUser);case 51:return k=e.sent,e.next=54,s.currentUser.decryptSecret(x,k);case 54:return delete(C=e.sent)[t],e.next=58,s.editSecret(x,C);case 58:O++,e.next=46;break;case 61:if("undefined"===typeof window.process){e.next=64;break}return e.next=64,s.getDb();case 64:return e.abrupt("return",{v:t});case 65:case"end":return e.stop()}}),e)}))(),"t0",2);case 2:if("object"!==typeof(n=e.t0)){e.next=5;break}return e.abrupt("return",n.v);case 5:e.next=16;break;case 7:if(e.prev=7,e.t1=e.catch(0),!(e.t1 instanceof L)){e.next=14;break}return this.offlineDB(),e.next=13,this.addSecretToFolder(t,r);case 13:return e.abrupt("return",e.sent);case 14:throw new H(e.t1).error;case 16:case"end":return e.stop()}}),e,this,[[0,7]])})));function t(t,r){return e.apply(this,arguments)}return t}()},{key:"getSharedSecretObjects",value:function(){var e=i(a.mark((function e(t,r,n,s){var i,c,o,u,d,l,h,p,f,b,v=arguments;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=v.length>4&&void 0!==v[4]&&v[4],c=v.length>5&&void 0!==v[5]?v[5]:void 0,e.prev=2,"undefined"!==typeof(o=this.currentUser.metadatas[t])){e.next=6;break}throw new x;case 6:if("folder"!==o.type){e.next=21;break}return e.next=9,this.api.getSecret(t,this.currentUser);case 9:return u=e.sent,e.next=12,this.currentUser.decryptSecret(t,u);case 12:d=e.sent,l=0,h=Object.keys(d);case 14:if(!(l<h.length)){e.next=21;break}return p=h[l],e.next=18,this.getSharedSecretObjects(p,r,n,s,i,t);case 18:l++,e.next=14;break;case 21:return e.next=23,this.currentUser.shareSecret(r,this.currentUser.keys[t].key,t);case 23:return f=e.sent,(b=f).rights=n,b.inFolder=c,i&&(b.username=r.username),s.push(b),e.abrupt("return",s);case 32:if(e.prev=32,e.t0=e.catch(2),!(e.t0 instanceof L)){e.next=37;break}throw this.offlineDB(),e.t0;case 37:throw new H(e.t0).error;case 39:case"end":return e.stop()}}),e,this,[[2,32]])})));function t(t,r,n,s){return e.apply(this,arguments)}return t}()},{key:"renameSecret",value:function(){var e=i(a.mark((function e(t,r){var n,s,i,c;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,this.currentUser.metadatas[t].title=r,this.editableDB){e.next=15;break}if(!(Object.keys(this.currentUser.metadatas[t].users).length>1)){e.next=5;break}throw new L;case 5:return n=[t],e.next=8,this.getSecret(t);case 8:return s=e.sent,i={secret:s,title:r},e.next=12,this.cryptoAdapter.encryptRSAOAEP(i,this.currentUser.publicKey);case 12:return c=e.sent,n.push(c),e.abrupt("return",this.pushCacheAction("renameSecret",n));case 15:return e.next=17,this.resetMetadatas(t);case 17:return e.abrupt("return",!0);case 20:if(e.prev=20,e.t0=e.catch(0),!(e.t0 instanceof L)){e.next=27;break}return this.offlineDB(),e.next=26,this.renameSecret(t,r);case 26:return e.abrupt("return",e.sent);case 27:throw e.t0;case 28:case"end":return e.stop()}}),e,this,[[0,20]])})));function t(t,r){return e.apply(this,arguments)}return t}()},{key:"resetMetadatas",value:function(){var e=i(a.mark((function e(t){var r;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.getSecret(t);case 3:return r=e.sent,e.next=6,this.editSecret(t,r);case 6:if("undefined"===typeof window.process){e.next=9;break}return e.next=9,this.getDb();case 9:e.next=18;break;case 11:if(e.prev=11,e.t0=e.catch(0),!(e.t0 instanceof L)){e.next=16;break}throw this.offlineDB(),e.t0;case 16:throw new H(e.t0).error;case 18:case"end":return e.stop()}}),e,this,[[0,11]])})));function t(t){return e.apply(this,arguments)}return t}()},{key:"shareSecret",value:function(){var e=i(a.mark((function e(t,r,n){var i,c,o,u,d,l,h,p,f;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,this.editableDB){e.next=3;break}throw new L;case 3:return i=parseInt(n,10),c=new De(r,this.cryptoAdapter),e.next=7,this.api.getPublicKey(c.username);case 7:return o=e.sent,e.next=10,c.importPublicKey(o);case 10:return e.next=12,this.getSharedSecretObjects(t,c,i,[]);case 12:return u=e.sent,e.next=15,this.api.shareSecret(this.currentUser,u);case 15:d=s(u),e.prev=16,d.s();case 18:if((l=d.n()).done){e.next=27;break}return h=l.value,(p=this.currentUser.metadatas[h.hashedTitle]).users[c.username]={username:c.username,rights:i,folders:{}},"undefined"!==typeof h.inFolder?p.users[c.username].folders[h.inFolder]=!0:p.users[c.username].folders.ROOT=!0,e.next=25,this.resetMetadatas(h.hashedTitle);case 25:e.next=18;break;case 27:e.next=32;break;case 29:e.prev=29,e.t0=e.catch(16),d.e(e.t0);case 32:return e.prev=32,d.f(),e.finish(32);case 35:if("undefined"===typeof window.process){e.next=38;break}return e.next=38,this.getDb();case 38:return e.abrupt("return",this.currentUser.metadatas[t]);case 41:if(e.prev=41,e.t1=e.catch(0),!(e.t1 instanceof L)){e.next=46;break}throw this.offlineDB(),e.t1;case 46:if(!((f=new H(e.t1)).error instanceof y)){e.next=49;break}throw new M;case 49:throw f.error;case 50:case"end":return e.stop()}}),e,this,[[0,41],[16,29,32,35]])})));function t(t,r,n){return e.apply(this,arguments)}return t}()},{key:"unshareSecret",value:function(){var e=i(a.mark((function e(t,r){var n,s;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,this.editableDB){e.next=3;break}throw new L;case 3:if("undefined"!==typeof(n=this.currentUser.metadatas[t])){e.next=6;break}throw new x;case 6:if("folder"!==n.type){e.next=9;break}return e.next=9,this.unshareFolderSecrets(t,r);case 9:return e.next=11,this.api.unshareSecret(this.currentUser,[r],t);case 11:if("Secret unshared"===(s=e.sent)){e.next=15;break}throw new H(s).error;case 15:return delete n.users[r],e.next=18,this.resetMetadatas(t);case 18:return e.next=20,this.renewKey(t);case 20:if("undefined"===typeof window.process){e.next=23;break}return e.next=23,this.getDb();case 23:return e.abrupt("return",this.currentUser.metadatas[t]);case 26:if(e.prev=26,e.t0=e.catch(0),!(e.t0 instanceof L)){e.next=31;break}throw this.offlineDB(),e.t0;case 31:throw new H(e.t0).error;case 33:case"end":return e.stop()}}),e,this,[[0,26]])})));function t(t,r){return e.apply(this,arguments)}return t}()},{key:"unshareFolderSecrets",value:function(){var e=i(a.mark((function e(t,r){var n,s,i,c,o;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,this.editableDB){e.next=3;break}throw new L;case 3:return e.next=5,this.api.getSecret(t,this.currentUser);case 5:return n=e.sent,e.next=8,this.currentUser.decryptSecret(t,n);case 8:s=e.sent,i=0,c=Object.keys(s);case 10:if(!(i<c.length)){e.next=17;break}return o=c[i],e.next=14,this.unshareSecret(o,r);case 14:i++,e.next=10;break;case 17:if("undefined"===typeof window.process){e.next=20;break}return e.next=20,this.getDb();case 20:e.next=29;break;case 22:if(e.prev=22,e.t0=e.catch(0),!(e.t0 instanceof L)){e.next=27;break}throw this.offlineDB(),e.t0;case 27:throw new H(e.t0).error;case 29:case"end":return e.stop()}}),e,this,[[0,22]])})));function t(t,r){return e.apply(this,arguments)}return t}()},{key:"wrapKeyForFriend",value:function(){var e=i(a.mark((function e(t,r){var n,s,i;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,this.editableDB){e.next=3;break}throw new L;case 3:return e.next=5,this.api.getPublicKey(t,!0);case 5:return n=e.sent,s=new De(t,this.cryptoAdapter),e.next=9,s.importPublicKey(n);case 9:return e.next=11,this.currentUser.wrapKey(r,s.publicKey);case 11:return i=e.sent,e.abrupt("return",{user:t,key:i});case 15:if(e.prev=15,e.t0=e.catch(0),!(e.t0 instanceof L)){e.next=20;break}throw this.offlineDB(),e.t0;case 20:throw new H(e.t0).error;case 22:case"end":return e.stop()}}),e,this,[[0,15]])})));function t(t,r){return e.apply(this,arguments)}return t}()},{key:"renewKey",value:function(){var e=i(a.mark((function e(t){var r,n,i,c,o,u,d,l,h,p,f,b=this;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,this.editableDB){e.next=3;break}throw new L;case 3:return e.next=5,this.api.getSecret(t,this.currentUser);case 5:return r=e.sent,e.next=8,this.api.getHistory(this.currentUser,t);case 8:return n=e.sent,e.next=11,this.currentUser.decryptSecret(t,r);case 11:return i=e.sent,e.next=14,this.currentUser.encryptSecret(this.currentUser.metadatas[t],i,n);case 14:c=e.sent,o={secret:c.secret,iv:c.iv,metadatas:c.metadatas,iv_meta:c.iv_meta,history:c.history,iv_history:c.iv_history},u=c.hashedUsername,d=[],l=s(r.users),e.prev=19,l.s();case 21:if((h=l.n()).done){e.next=37;break}if(p=h.value,u!==p){e.next=30;break}return e.next=26,this.currentUser.wrapKey(c.key,this.currentUser.publicKey);case 26:f=e.sent,d.push({user:u,key:f}),e.next=35;break;case 30:return e.t0=d,e.next=33,this.wrapKeyForFriend(p,c.key);case 33:e.t1=e.sent,e.t0.push.call(e.t0,e.t1);case 35:e.next=21;break;case 37:e.next=42;break;case 39:e.prev=39,e.t2=e.catch(19),l.e(e.t2);case 42:return e.prev=42,l.f(),e.finish(42);case 45:return e.next=47,this.api.newKey(this.currentUser,t,o,d);case 47:if(d.forEach((function(e){e.user===u&&(b.currentUser.keys[t].key=e.key)})),"undefined"===typeof window.process){e.next=51;break}return e.next=51,this.getDb();case 51:e.next=60;break;case 53:if(e.prev=53,e.t3=e.catch(0),!(e.t3 instanceof L)){e.next=58;break}throw this.offlineDB(),e.t3;case 58:throw new H(e.t3).error;case 60:case"end":return e.stop()}}),e,this,[[0,53],[19,39,42,45]])})));function t(t){return e.apply(this,arguments)}return t}()},{key:"removeSecretFromFolder",value:function(){var e=i(a.mark((function e(t,r){var n,s,i,c,o=this;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,n=this.currentUser.metadatas[t],s=[],Object.keys(n.users).forEach((function(e){"undefined"!==typeof n.users[e].folders[r]&&s.push(e)})),!(s.length>1)){e.next=9;break}if(this.editableDB){e.next=7;break}throw new L;case 7:return e.next=9,this.api.unshareSecret(this.currentUser,s,t);case 9:if(s.forEach((function(e){delete n.users[e].folders[r],0===Object.keys(n.users[e].folders).length&&(o.currentUser.username===e?n.users[e].folders.ROOT=!0:delete n.users[e])})),!(s.length>1)){e.next=13;break}return e.next=13,this.renewKey(t);case 13:return e.next=15,this.resetMetadatas(t);case 15:return e.next=17,this.api.getSecret(r,this.currentUser);case 17:return i=e.sent,e.next=20,this.currentUser.decryptSecret(r,i);case 20:return delete(c=e.sent)[t],e.next=24,this.editSecret(r,c);case 24:if("undefined"===typeof window.process){e.next=27;break}return e.next=27,this.getDb();case 27:return e.abrupt("return",!0);case 30:if(e.prev=30,e.t0=e.catch(0),!(e.t0 instanceof L)){e.next=37;break}return this.offlineDB(),e.next=36,this.removeSecretFromFolder(t,r);case 36:return e.abrupt("return",e.sent);case 37:throw new H(e.t0).error;case 39:case"end":return e.stop()}}),e,this,[[0,30]])})));function t(t,r){return e.apply(this,arguments)}return t}()},{key:"getSecret",value:function(){var e=i(a.mark((function e(t){var r,n;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.api.getSecret(t,this.currentUser);case 3:return r=e.sent,e.next=6,this.currentUser.decryptSecret(t,r);case 6:return n=e.sent,e.abrupt("return",n);case 10:if(e.prev=10,e.t0=e.catch(0),!(e.t0 instanceof L)){e.next=17;break}return this.offlineDB(),e.next=16,this.getSecret(t);case 16:return e.abrupt("return",e.sent);case 17:throw new H(e.t0).error;case 19:case"end":return e.stop()}}),e,this,[[0,10]])})));function t(t){return e.apply(this,arguments)}return t}()},{key:"getHistory",value:function(){var e=i(a.mark((function e(t,r){var n,s,i;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.api.getHistory(this.currentUser,t);case 3:return n=e.sent,e.next=6,this.currentUser.decryptSecret(t,n);case 6:if(s=e.sent,"undefined"!==typeof r){e.next=9;break}return e.abrupt("return",s);case 9:if(!(r<0)){e.next=12;break}return i=-r%s.length,e.abrupt("return",s[-i]);case 12:return e.abrupt("return",s[r%s.length]);case 15:if(e.prev=15,e.t0=e.catch(0),!(e.t0 instanceof L)){e.next=22;break}return this.offlineDB(),e.next=21,this.getHistory(t,r);case 21:return e.abrupt("return",e.sent);case 22:throw new H(e.t0).error;case 24:case"end":return e.stop()}}),e,this,[[0,15]])})));function t(t,r){return e.apply(this,arguments)}return t}()},{key:"deleteSecret",value:function(){var e=i(a.mark((function e(t){var r,n,s,i,c,o,u,d,l=arguments;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=l.length>1&&void 0!==l[1]?l[1]:[],this.editableDB){e.next=3;break}throw new L;case 3:if(e.prev=3,"undefined"!==typeof(n=this.currentUser.metadatas[t])){e.next=7;break}throw new x;case 7:if("folder"!==n.type||-1!==r.indexOf(t)){e.next=10;break}return e.next=10,this.deleteFolderSecrets(t,r);case 10:return e.next=12,this.api.deleteSecret(this.currentUser,t);case 12:delete this.currentUser.metadatas[t],delete this.currentUser.keys[t],s=this.currentUser.username,i=0,c=Object.keys(n.users[s].folders);case 16:if(!(i<c.length)){e.next=31;break}if("ROOT"===(o=c[i])){e.next=28;break}return e.next=21,this.api.getSecret(o,this.currentUser);case 21:return u=e.sent,e.next=24,this.currentUser.decryptSecret(o,u);case 24:return delete(d=e.sent)[t],e.next=28,this.editSecret(o,d);case 28:i++,e.next=16;break;case 31:if("undefined"===typeof window.process){e.next=34;break}return e.next=34,this.getDb();case 34:e.next=43;break;case 36:if(e.prev=36,e.t0=e.catch(3),!(e.t0 instanceof L)){e.next=41;break}throw this.offlineDB(),e.t0;case 41:throw new H(e.t0).error;case 43:case"end":return e.stop()}}),e,this,[[3,36]])})));function t(t){return e.apply(this,arguments)}return t}()},{key:"deleteFolderSecrets",value:function(){var e=i(a.mark((function e(t,r){var n,s,i,c,o;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.editableDB){e.next=2;break}throw new L;case 2:return e.prev=2,r.push(t),e.next=6,this.api.getSecret(t,this.currentUser);case 6:return n=e.sent,e.next=9,this.currentUser.decryptSecret(t,n);case 9:s=e.sent,i=0,c=Object.keys(s);case 11:if(!(i<c.length)){e.next=18;break}return o=c[i],e.next=15,this.deleteSecret(o,r);case 15:i++,e.next=11;break;case 18:if("undefined"===typeof window.process){e.next=21;break}return e.next=21,this.getDb();case 21:e.next=30;break;case 23:if(e.prev=23,e.t0=e.catch(2),!(e.t0 instanceof L)){e.next=28;break}throw this.offlineDB(),e.t0;case 28:throw new H(e.t0).error;case 30:case"end":return e.stop()}}),e,this,[[2,23]])})));function t(t,r){return e.apply(this,arguments)}return t}()},{key:"deactivateTotp",value:function(){var e=i(a.mark((function e(){return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.editableDB){e.next=2;break}throw new L;case 2:return e.prev=2,e.next=5,this.api.deactivateTotp(this.currentUser);case 5:if("undefined"===typeof window.process){e.next=8;break}return e.next=8,this.getDb();case 8:e.next=17;break;case 10:if(e.prev=10,e.t0=e.catch(2),!(e.t0 instanceof L)){e.next=15;break}throw this.offlineDB(),e.t0;case 15:throw new H(e.t0).error;case 17:case"end":return e.stop()}}),e,this,[[2,10]])})));function t(){return e.apply(this,arguments)}return t}()},{key:"activateTotp",value:function(){var e=i(a.mark((function e(t){var r;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.editableDB){e.next=2;break}throw new L;case 2:return e.prev=2,r=Ce(me(this.currentUser.hash),t.raw),e.next=6,this.api.activateTotp(r,this.currentUser);case 6:if("undefined"===typeof window.process){e.next=9;break}return e.next=9,this.getDb();case 9:e.next=16;break;case 11:throw e.prev=11,e.t0=e.catch(2),e.t0 instanceof L&&this.offlineDB(),new H(e.t0).error;case 16:case"end":return e.stop()}}),e,this,[[2,11]])})));function t(t){return e.apply(this,arguments)}return t}()},{key:"activateShortLogin",value:function(){var e=i(a.mark((function e(t,r){var n,s;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.editableDB){e.next=2;break}throw new L;case 2:if(ke()){e.next=4;break}throw new U;case 4:return e.prev=4,e.next=7,this.currentUser.activateShortLogin(t,r);case 7:return n=e.sent,e.next=10,this.api.activateShortLogin(n,this.currentUser);case 10:if("undefined"===typeof window.process){e.next=13;break}return e.next=13,this.getDb();case 13:return e.next=15,this.currentUser.exportPrivateData(t);case 15:s=e.sent,localStorage.setItem("".concat(Pe,"shortpass"),s.data),localStorage.setItem("".concat(Pe,"shortpassSignature"),s.signature),e.next=30;break;case 20:if(e.prev=20,e.t0=e.catch(4),"OperationError"!==e.t0.name){e.next=25;break}return this.deactivateShortLogin(),e.abrupt("return");case 25:if(!(e.t0 instanceof L)){e.next=28;break}throw this.offlineDB(),e.t0;case 28:throw new H(e.t0).error;case 30:case"end":return e.stop()}}),e,this,[[4,20]])})));function t(t,r){return e.apply(this,arguments)}return t}()},{key:"getShortLoginActivationDate",value:function(){if(!ke())throw new U;var e=localStorage.getItem("".concat(Pe,"activatedAt"));return e?new Date(e):null}},{key:"deactivateShortLogin",value:function(){if(!ke())throw new U;localStorage.removeItem("".concat(Pe,"username")),localStorage.removeItem("".concat(Pe,"deviceName")),localStorage.removeItem("".concat(Pe,"privateKey")),localStorage.removeItem("".concat(Pe,"privateKeyIv")),localStorage.removeItem("".concat(Pe,"privateKeyIv")),localStorage.removeItem("".concat(Pe,"iv")),localStorage.removeItem("".concat(Pe,"shortpass")),localStorage.removeItem("".concat(Pe,"shortpassSignature")),localStorage.removeItem("".concat(Pe,"activatedAt")),localStorage.removeItem("".concat(Pe,"privateKeySign")),localStorage.removeItem("".concat(Pe,"publicKeySign"))}},{key:"shortLogin",value:function(){var e=i(a.mark((function e(t){var r,n,s,i,c,o,u,d,l,h=arguments;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=h.length>1&&void 0!==h[1]?h[1]:Ae,n=!(h.length>2&&void 0!==h[2])||h[2],ke()){e.next=4;break}throw new U;case 4:return e.prev=4,s=localStorage.getItem("".concat(Pe,"username")),i=localStorage.getItem("".concat(Pe,"deviceName")),this.currentUser=new De(s,this.cryptoAdapter),r(new J),e.next=11,this.api.getProtectKeyParameters(s,i);case 11:return c=e.sent,this.currentUser.totp=c.totp,r(new G),e.next=16,this.cryptoAdapter.derivePassword(t,c);case 16:return o=e.sent,u=o.hash,d=o.key,r(new V),e.next=22,this.api.getProtectKey(s,i,u);case 22:return l=e.sent,r(new q),e.next=26,this.currentUser.shortLogin(d,l);case 26:return r(new W),e.next=29,this.currentUser.importPublicKey(c.publicKey);case 29:if(this.currentUser.publicKeySign&&this.currentUser.privateKeySign){e.next=32;break}return e.next=32,this.currentUser.deprecatedConvertOAEPToPSS();case 32:return e.next=34,this.refreshUser(n,r);case 34:if("undefined"===typeof window.process){e.next=40;break}return e.next=37,this.getDb();case 37:if(!this.editableDB){e.next=40;break}return e.next=40,this.doCacheActions();case 40:return e.abrupt("return",this.currentUser);case 43:if(e.prev=43,e.t0=e.catch(4),!(e.t0 instanceof L)){e.next=50;break}return this.offlineDB(),e.next=49,this.shortLogin(t);case 49:return e.abrupt("return",e.sent);case 50:throw"Not available in standalone mode"===e.t0||e.t0 instanceof B||(localStorage.removeItem("".concat(Pe,"username")),localStorage.removeItem("".concat(Pe,"privateKey")),localStorage.removeItem("".concat(Pe,"privateKeyIv")),localStorage.removeItem("".concat(Pe,"publicKeySign")),localStorage.removeItem("".concat(Pe,"privateKeySign")),localStorage.removeItem("".concat(Pe,"iv"))),new H(e.t0).error;case 53:case"end":return e.stop()}}),e,this,[[4,43]])})));function t(t){return e.apply(this,arguments)}return t}()},{key:"canITryShortLogin",value:function(){return this.editableDB&&ke()&&null!==localStorage.getItem("".concat(Pe,"username"))}},{key:"getSavedUsername",value:function(){return this.canITryShortLogin()?localStorage.getItem("".concat(Pe,"username")):null}},{key:"getRescueCodes",value:function(){var e=i(a.mark((function e(){var t,r,n=this;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,t=Se(),r=t.map((function(e){return Ue(me(e),me(n.currentUser.hash))})),e.next=5,this.api.postRescueCodes(this.currentUser,r);case 5:return e.abrupt("return",t);case 8:if(e.prev=8,e.t0=e.catch(0),!(e.t0 instanceof L)){e.next=15;break}return this.offlineDB(),e.next=14,this.getRescueCodes();case 14:return e.abrupt("return",e.sent);case 15:throw new H(e.t0).error;case 17:case"end":return e.stop()}}),e,this,[[0,8]])})));function t(){return e.apply(this,arguments)}return t}()},{key:"getDb",value:function(){var e=i(a.mark((function e(){var t,r,n,s,i,c,o=this;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(ke()){e.next=2;break}throw new U;case 2:return e.prev=2,t="".concat(Pe,"cache_").concat(this.currentUser.username),r=localStorage.getItem(t),n=r?JSON.parse(r):{users:{},secrets:{}},s={},Object.keys(n.secrets).forEach((function(e){s[e]=n.secrets[e].rev})),e.next=10,this.api.getDb(this.currentUser,s);case 10:return i=e.sent,Object.keys(i.secrets).forEach((function(e){"undefined"!==typeof n.secrets[e]&&n.secrets[e].editOffline&&o.setConflict(e,"conflict")})),Object.assign(n.users,i.users),Object.assign(n.secrets,i.secrets),Object.keys(n.secrets).forEach((function(e){n.secrets[e]||delete n.secrets[e]})),c=JSON.stringify(n),localStorage.setItem(t,JSON.stringify(n)),e.abrupt("return",c);case 20:if(e.prev=20,e.t0=e.catch(2),!(e.t0 instanceof L)){e.next=27;break}return this.offlineDB(),e.next=26,this.getDb();case 26:return e.abrupt("return",e.sent);case 27:throw new H(e.t0).error;case 29:case"end":return e.stop()}}),e,this,[[2,20]])})));function t(){return e.apply(this,arguments)}return t}()},{key:"exportDb",value:function(){var t=i(a.mark((function t(r,n){var s,i,c;return a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,this.api.getDb(this.currentUser,{});case 3:if(s=t.sent,i=new e(this.cryptoAdapter,Te,JSON.parse(JSON.stringify(s))),"undefined"!==typeof r){t.next=8;break}return s.username=this.currentUser.username,t.abrupt("return",JSON.stringify(s));case 8:return i.currentUser=this.currentUser,t.next=11,i.changePassword(r,n);case 11:return t.next=13,i.api.getDb(i.currentUser,{});case 13:return(c=t.sent).username=this.currentUser.username,t.abrupt("return",JSON.stringify(c));case 18:if(t.prev=18,t.t0=t.catch(0),!(t.t0 instanceof L)){t.next=25;break}return this.offlineDB(),t.next=24,this.getDb();case 24:return t.abrupt("return",t.sent);case 25:throw new H(t.t0).error;case 27:case"end":return t.stop()}}),t,this,[[0,18]])})));function r(e,r){return t.apply(this,arguments)}return r}()},{key:"importDb",value:function(){var t=i(a.mark((function t(r,s){var i,c,o,u,d,l,h,p,f,b,v,m,g,y,j,w,O,S,x,k,C,U,A,P=this,N=arguments;return a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(i=N.length>2&&void 0!==N[2]?N[2]:Ae,this.editableDB){t.next=3;break}throw new L;case 3:return c=JSON.parse(s),o=c.username,u=new e(this.cryptoAdapter,Te,c),d={},t.next=9,u.api.getDerivationParameters(o);case 9:return l=t.sent,t.next=12,this.cryptoAdapter.derivePassword(r,l);case 12:return h=t.sent,p=h.hash,f=h.key,t.next=17,u.api.getUser(o,p);case 17:return b=t.sent,u.currentUser=new De(o,this.cryptoAdapter),u.currentUser.totp=l.totp,u.currentUser.hash=p,t.next=23,u.currentUser.importPrivateKey(f,b.privateKey);case 23:return t.next=25,u.currentUser.importPublicKey(b.publicKey);case 25:return t.next=27,u.api.getUserWithSignature(u.currentUser);case 27:v=t.sent,m=v.metadatas,u.currentUser.keys=v.keys,g=0,y=Object.keys(u.currentUser.keys);case 31:if(!(g<y.length)){t.next=42;break}return j=y[g],w=this.cryptoAdapter.randomUUID(),O="".concat(w,"|").concat(j),t.next=37,this.cryptoAdapter.getSHA256(O);case 37:S=t.sent,d[j]=S;case 39:g++,t.next=31;break;case 42:x=Object.keys(u.currentUser.keys),k=new ee(0,x.length),i(k),C=a.mark((function e(){var t,r,s,c,o,l,h,p,f,b,v,g,y;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=A[U],e.next=3,u.api.getSecret(t,u.currentUser);case 3:return r=e.sent,e.next=6,u.api.getHistory(u.currentUser,t);case 6:return s=e.sent,e.next=9,u.currentUser.exportSecret(t,r,m[t],s);case 9:return c=e.sent,o=c.secret,l=c.metadata,h=c.history,p=l,f=o,b=Object.keys(p.users[u.currentUser.username].folders),v={},b.forEach((function(e){"ROOT"!==e?v[d[e]]=!0:v.ROOT=!0})),p.id=d[l.id],p.users=n({},P.currentUser.username,{username:P.currentUser.username,rights:2,folders:v}),g=new Date,p.lastModifiedAt=g.toISOString(),p.lastModifiedBy=P.currentUser.username,"folder"===l.type&&Object.keys(o).forEach((function(e){var t=d[e];f[t]=1,delete f[e]})),e.next=26,P.currentUser.importSecret(d[t],f,p,h);case 26:return y=e.sent,P.currentUser.keys[y.hashedTitle]={key:y.wrappedKey,rights:p.users[P.currentUser.username].rights},P.currentUser.metadatas[y.hashedTitle]=p,e.next=31,P.api.addSecret(P.currentUser,y);case 31:k.step(),i(k);case 33:case"end":return e.stop()}}),e)})),U=0,A=x;case 47:if(!(U<A.length)){t.next=52;break}return t.delegateYield(C(),"t0",49);case 49:U++,t.next=47;break;case 52:case"end":return t.stop()}}),t,this)})));function r(e,r){return t.apply(this,arguments)}return r}()}]),e}();function Fe(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1e4;return new Promise((function(s,a){var i=new XMLHttpRequest;"undefined"!==typeof window.process&&(i.timeout=n),i.open(r,encodeURI(e)),i.setRequestHeader("Content-Type","application/json"),i.onload=function(){var e=JSON.parse(i.responseText);200===i.status?s(e.reason?e.reason:e):a(e.reason)},i.ontimeout=function(){a(new L)},i.onerror=function(){a(new L)},i.send(JSON.stringify(t))}))}function Ie(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:6e3;return new Promise((function(r,n){var s=new XMLHttpRequest;"undefined"!==typeof window.process&&(s.timeout=t),s.open("GET",encodeURI(e)),s.onload=function(){var e=JSON.parse(s.responseText);200===s.status?r(e):n(e.reason)},s.ontimeout=function(){n(new L)},s.onerror=function(){n(new L)},s.send()}))}function Ee(e,t){return Fe(e,t,"POST",arguments.length>2&&void 0!==arguments[2]?arguments[2]:1e4)}function Re(e,t){return Fe(e,t,"PUT",arguments.length>2&&void 0!==arguments[2]?arguments[2]:1e4)}function Me(e,t){return Fe(e,t,"DELETE",arguments.length>2&&void 0!==arguments[2]?arguments[2]:1e4)}var Le=function(){function e(t,r){h(this,e),this.db=t||window.location.origin,this.getSHA256=r}return l(e,[{key:"userExists",value:function(e,t){return this.retrieveUser(e,"undefined",t).then((function(){return!0}),(function(){return!1}))}},{key:"addUser",value:function(e){var t=this,r=e.username,n=e.privateKey,s=e.publicKey,a=e.privateKeySign,i=e.publicKeySign,c=e.pass,o=e.options;return this.getSHA256(r).then((function(e){return Ee("".concat(t.db,"/user/").concat(e),{pass:c,privateKey:n,publicKey:s,privateKeySign:a,publicKeySign:i,keys:{},options:o})}))}},{key:"addSecret",value:function(e,t){var r=this,n=JSON.stringify({secret:t.secret,iv:t.iv,metadatas:t.metadatas,iv_meta:t.iv_meta,history:t.history,iv_history:t.iv_history,key:t.wrappedKey,title:t.hashedTitle}),s=Date.now();return e.sign("".concat(n,"|").concat(s)).then((function(e){return Ee("".concat(r.db,"/secret/").concat(t.hashedUsername),{json:n,sig:e,sigTime:s})}))}},{key:"deleteSecret",value:function(e,t){var r,n=this,s=Date.now();return this.getSHA256(e.username).then((function(n){return r="/secret/".concat(n,"/").concat(t),e.sign("DELETE ".concat(r,"|").concat(s))})).then((function(e){return Me("".concat(n.db).concat(r),{sig:e,sigTime:s})}))}},{key:"editSecret",value:function(e,t,r){var n,s=this,a=JSON.stringify({iv:t.iv,secret:t.secret,iv_meta:t.iv_meta,metadatas:t.metadatas,iv_history:t.iv_history,history:t.history,title:r}),i=Date.now();return this.getSHA256(e.username).then((function(t){return n=t,e.sign("".concat(a,"|").concat(i))})).then((function(e){return Re("".concat(s.db,"/secret/").concat(n),{json:a,sig:e,sigTime:i})}))}},{key:"newKey",value:function(e,t,r,n){var s,a=this,i=JSON.stringify({wrappedKeys:n,secret:r,title:t}),c=Date.now();return this.getSHA256(e.username).then((function(t){return s=t,e.sign("".concat(i,"|").concat(c))})).then((function(e){return Ee("".concat(a.db,"/newKey/").concat(s),{json:i,sig:e,sigTime:c})}))}},{key:"unshareSecret",value:function(e,t,r){var n,s,a=this,i=[],c={title:r},o=Date.now();return this.getSHA256(e.username).then((function(e){n=e;var r=[];return t.forEach((function(e){r.push(a.getSHA256(e))})),Promise.all(r)})).then((function(t){return t.forEach((function(e){i.push(e)})),c.friendNames=i,s=JSON.stringify(c),e.sign("".concat(s,"|").concat(o))})).then((function(e){return Ee("".concat(a.db,"/unshare/").concat(n),{json:s,sig:e,sigTime:o})}))}},{key:"shareSecret",value:function(e,t){var r,n=this,s=JSON.stringify({secretObjects:t}),a=Date.now();return this.getSHA256(e.username).then((function(t){return r=t,e.sign("".concat(s,"|").concat(a))})).then((function(e){return Ee("".concat(n.db,"/share/").concat(r),{json:s,sig:e,sigTime:a})}))}},{key:"retrieveUser",value:function(e,t,r){var n=this,s=Promise.resolve(),a=e;return r||(s=s.then((function(){return n.getSHA256(e)})).then((function(e){a=e}))),s.then((function(){return Ie("".concat(n.db,"/user/").concat(a,"/").concat(t))}))}},{key:"getDerivationParameters",value:function(e,t){return this.retrieveUser(e,"undefined",t).then((function(e){return{totp:e.pass.totp,shortpass:e.pass.shortpass,salt:e.pass.salt,iterations:e.pass.iterations}}))}},{key:"getPublicKey",value:function(e,t){return this.retrieveUser(e,"undefined",t).then((function(e){return e.publicKey}))}},{key:"getUser",value:function(e,t,r){var n=this;return this.getSHA256(e).then((function(e){return Ie("".concat(n.db,"/user/").concat(e,"/").concat(t,"?otp=").concat(r))}))}},{key:"getUserWithSignature",value:function(e){var t,r=this,n=Date.now();return this.getSHA256(e.username).then((function(r){return t="/user/".concat(r),e.sign("".concat(t,"|").concat(n))})).then((function(e){return Ie("".concat(r.db).concat(t,"?sig=").concat(e,"&sigTime=").concat(n),0)}))}},{key:"getSecret",value:function(e,t){var r,n=this,s=Date.now();return this.getSHA256(t.username).then((function(n){return r="/secret/".concat(n,"/").concat(e),t.sign("".concat(r,"|").concat(s))})).then((function(e){return Ie("".concat(n.db).concat(r,"?sig=").concat(e,"&sigTime=").concat(s))}))}},{key:"getHistory",value:function(e,t){var r,n=this,s=Date.now();return this.getSHA256(e.username).then((function(n){return r="/history/".concat(n,"/").concat(t),e.sign("".concat(r,"|").concat(s))})).then((function(e){return Ie("".concat(n.db).concat(r,"?sig=").concat(e,"&sigTime=").concat(s))})).then((function(e){return{iv:e.iv_history,secret:e.history}}))}},{key:"getProtectKey",value:function(e,t,r){var n,s=this;return this.getSHA256(e).then((function(e){return n=e,s.getSHA256(t)})).then((function(e){return Ie("".concat(s.db,"/protectKey/").concat(n,"/").concat(e,"/").concat(r))})).then((function(e){return"undefined"===r?e:e.protectKey}))}},{key:"getProtectKeyParameters",value:function(e,t){return this.getProtectKey(e,t,"undefined")}},{key:"getDb",value:function(e,t){var r,n=this,s=JSON.stringify(t),a=Date.now();return this.getSHA256(e.username).then((function(t){return r="/database/".concat(t),e.sign("".concat(s,"|").concat(a))})).then((function(e){return Ee("".concat(n.db).concat(r),{json:s,sig:e,sigTime:a})}))}},{key:"getRescueCodes",value:function(e){var t,r=this,n=Date.now();return this.getSHA256(e.username).then((function(r){return t="/rescueCodes/".concat(r),e.sign("".concat(t,"|").concat(n))})).then((function(e){return Ie("".concat(r.db).concat(t,"?sig=").concat(e,"&sigTime=").concat(n))}))}},{key:"postRescueCodes",value:function(e,t){var r,n=this,s=JSON.stringify({rescueCodes:t}),a=Date.now();return this.getSHA256(e.username).then((function(t){return r=t,e.sign("".concat(s,"|").concat(a))})).then((function(e){return Re("".concat(n.db,"/rescueCodes/").concat(r),{json:s,sig:e,sigTime:a})}))}},{key:"editUser",value:function(e,t){var r,n=this,s=JSON.stringify(t),a=Date.now();return this.getSHA256(e.username).then((function(t){return r=t,e.sign("".concat(s,"|").concat(a))})).then((function(e){return Re("".concat(n.db,"/user/").concat(r),{json:s,sig:e,sigTime:a})}))}},{key:"changePassword",value:function(e,t,r){var n,s=this,a=JSON.stringify({pass:r,privateKey:t}),i=Date.now();return this.getSHA256(e.username).then((function(t){return n=t,e.sign("".concat(a,"|").concat(i))})).then((function(e){return Re("".concat(s.db,"/user/").concat(n),{json:a,sig:e,sigTime:i})}))}},{key:"testTotp",value:function(e,t){return Ie("".concat(this.db,"/totp/").concat(e,"/").concat(t))}},{key:"activateTotp",value:function(e,t){var r,n=this,s=JSON.stringify({seed:e}),a=Date.now();return this.getSHA256(t.username).then((function(e){return r=e,t.sign("".concat(s,"|").concat(a))})).then((function(e){return Re("".concat(n.db,"/activateTotp/").concat(r),{json:s,sig:e,sigTime:a})}))}},{key:"deactivateTotp",value:function(e){var t,r=this,n=Date.now();return this.getSHA256(e.username).then((function(r){return t="/deactivateTotp/".concat(r),e.sign("".concat(t,"|").concat(n))})).then((function(e){return Re("".concat(r.db).concat(t,"?sig=").concat(e,"&sigTime=").concat(n),{})}))}},{key:"activateShortLogin",value:function(e,t){var r,n=this,s=JSON.stringify({shortpass:e}),a=Date.now();return this.getSHA256(t.username).then((function(e){return r=e,t.sign("".concat(s,"|").concat(a))})).then((function(e){return Re("".concat(n.db,"/activateShortLogin/").concat(r),{json:s,sig:e,sigTime:a})}))}},{key:"isOnline",value:function(){return Ie("".concat(this.db,"/ping"))}}]),e}();return Ke.version=e,Ke.User=De,Ke.API={Standalone:Te,Server:Le},Ke.Errors=_,Ke.Statuses=te,Ke.Utils=Ne,Ke}()},484:function(e,t,r){},485:function(e,t,r){"use strict";r.r(t);var n={};r.r(n),r.d(n,"MetadataSlice",(function(){return It})),r.d(n,"loadMetadataSuccess",(function(){return Rt})),r.d(n,"deleteSecretSuccess",(function(){return Mt})),r.d(n,"deleteSecretFailure",(function(){return Lt})),r.d(n,"addSecretToFolderSuccess",(function(){return Bt})),r.d(n,"removeSecretFromCurrentFolderSuccess",(function(){return Ht})),r.d(n,"createSecretUserRightsSuccess",(function(){return _t})),r.d(n,"updateSecretSuccess",(function(){return zt})),r.d(n,"renameSecretSuccess",(function(){return Gt})),r.d(n,"updateSecretUserRightsSuccess",(function(){return Jt})),r.d(n,"deleteSecretUserRightsSuccess",(function(){return Yt})),r.d(n,"loadMetadata",(function(){return Vt})),r.d(n,"createSecret",(function(){return Wt})),r.d(n,"updateSecret",(function(){return qt})),r.d(n,"renameSecret",(function(){return Qt})),r.d(n,"deleteSecret",(function(){return $t})),r.d(n,"createSecretUserRights",(function(){return Xt})),r.d(n,"updateSecretUserRights",(function(){return Zt})),r.d(n,"deleteSecretUserRights",(function(){return er})),r.d(n,"addSecretToFolder",(function(){return tr})),r.d(n,"removeSecretFromCurrentFolder",(function(){return rr})),r.d(n,"default",(function(){return nr}));var s={};r.r(s),r.d(s,"ShowSecretUISlice",(function(){return ir})),r.d(s,"showModal",(function(){return or})),r.d(s,"showSecretSuccess",(function(){return ur})),r.d(s,"hideModal",(function(){return dr})),r.d(s,"changeTab",(function(){return lr})),r.d(s,"updateSecretStart",(function(){return hr})),r.d(s,"updateSecretFailure",(function(){return pr})),r.d(s,"createSecretUserRightsFailure",(function(){return fr})),r.d(s,"updateSecretUserRightsFailure",(function(){return br})),r.d(s,"deleteSecretUserRightsFailure",(function(){return vr})),r.d(s,"historyShowOlder",(function(){return mr})),r.d(s,"historyShowNewer",(function(){return gr})),r.d(s,"showSecret",(function(){return yr})),r.d(s,"default",(function(){return jr}));var a={};r.r(a),r.d(a,"EditSecretUISlice",(function(){return Or})),r.d(a,"updateData",(function(){return xr})),r.d(a,"changeField",(function(){return kr})),r.d(a,"default",(function(){return Cr}));var i={};r.r(i),r.d(i,"NewSecretUISlice",(function(){return xn})),r.d(i,"showModal",(function(){return Cn})),r.d(i,"hideModal",(function(){return Un})),r.d(i,"changeTitle",(function(){return An})),r.d(i,"changeField",(function(){return Pn})),r.d(i,"default",(function(){return Nn}));var c={};r.r(c),r.d(c,"OptionsSlice",(function(){return Dn})),r.d(c,"_activateTotp",(function(){return Fn})),r.d(c,"_activateShortLogin",(function(){return In})),r.d(c,"_toggleTotp",(function(){return En})),r.d(c,"_toggleShortLogin",(function(){return Rn})),r.d(c,"activateTotpFailure",(function(){return Mn})),r.d(c,"activateTotpSuccess",(function(){return Ln})),r.d(c,"hideQRCode",(function(){return Bn})),r.d(c,"hideShortLogin",(function(){return Hn})),r.d(c,"deactivateTotpSuccess",(function(){return _n})),r.d(c,"deactivateShortLoginSuccess",(function(){return zn})),r.d(c,"activateShortLoginSuccess",(function(){return Gn})),r.d(c,"changeDelaySuccess",(function(){return Jn})),r.d(c,"changeDefaultUsernameSuccess",(function(){return Yn})),r.d(c,"changeNewPass1",(function(){return Vn})),r.d(c,"changeNewPass2",(function(){return Wn})),r.d(c,"showChangePassword",(function(){return qn})),r.d(c,"hideChangePassword",(function(){return Qn})),r.d(c,"_changePassword",(function(){return $n})),r.d(c,"changePasswordSuccess",(function(){return Xn})),r.d(c,"changePasswordFailure",(function(){return Zn})),r.d(c,"showRescueCodesSuccess",(function(){return es})),r.d(c,"hideRescueCodes",(function(){return ts})),r.d(c,"deactivateTotp",(function(){return rs})),r.d(c,"activateTotp",(function(){return ns})),r.d(c,"activateShortLogin",(function(){return ss})),r.d(c,"deactivateShortLogin",(function(){return as})),r.d(c,"changePassword",(function(){return is})),r.d(c,"toggleTotp",(function(){return cs})),r.d(c,"showRescueCodes",(function(){return os})),r.d(c,"toggleShortLogin",(function(){return us})),r.d(c,"toggleAutoLogout",(function(){return ds})),r.d(c,"changeDefaultUsername",(function(){return ls})),r.d(c,"changeTimeToClose",(function(){return hs})),r.d(c,"default",(function(){return ps}));var o={};r.r(o),r.d(o,"ImportSlice",(function(){return ks})),r.d(o,"showModal",(function(){return Us})),r.d(o,"_importSecrets",(function(){return As})),r.d(o,"detectTypeFailure",(function(){return Ps})),r.d(o,"detectTypeSuccess",(function(){return Ns})),r.d(o,"importSecretsProgress",(function(){return Ts})),r.d(o,"importSecretsSuccess",(function(){return Ds})),r.d(o,"importSecretsFailure",(function(){return Ks})),r.d(o,"defaultStore",(function(){return Fs})),r.d(o,"changeMandatoryField",(function(){return Is})),r.d(o,"detectType",(function(){return Es})),r.d(o,"importSecrets",(function(){return Rs})),r.d(o,"default",(function(){return Ms}));var u=r(1),d=r.n(u),l=r(23),h=r.n(l),p=r(5),f=r(6),b=r(9),v=r(7),m=r(8),g=r(10),y=r(32),j=r(12),w=r(37),O=r.n(w),S=r(225),x=r.n(S),k="https://api.secret-in.me";"undefined"!==typeof window.process&&(k=new URLSearchParams(window.location.search).get("api"));var C=new O.a(x.a,O.a.API.Server,k),U=Object(j.a)({},O.a.Statuses),A=Object(j.a)({},O.a.Errors),P=C,N=r(34),T=U.DecryptMetadataStatus,D=U.EndDecryptMetadataStatus,K=U.DecryptUserOptionsStatus,F=U.DecryptMetadataCacheStatus,I=A.UsernameAlreadyExistsError,E=A.UserNotFoundError,R=A.InvalidPasswordError,M=A.NeedTOTPTokenError,L=function(e){e.loading=!0},B=function(e){e.loading=!1},H=Object(N.b)({name:"AppUI",initialState:{savedUsername:P.getSavedUsername(),loading:!1,connected:!1,online:!0,errors:{},currentUser:null,status:null,showShortpass:P.canITryShortLogin()},reducers:{loading:L,endLoading:B,createSecret:L,createSecretSuccess:B,createSecretFailure:B,connectionChange:function(e,t){e.online="online"===t.payload.connection},disconnectUserSuccess:function(e){e.savedUsername=P.getSavedUsername(),e.showShortpass=P.canITryShortLogin(),e.loading=!1,e.connected=!1,e.errors={},e.currentUser=null},createUserSuccess:function(e,t){e.loading=!1,e.connected=!0,e.errors={},e.currentUser=t.payload.currentUser},createUserFailure:function(e,t){e.loading=!1,e.connected=!1,e.errors=t.payload.error,e.status=null},disableShortLoginSuccess:B,onLoginUserProgress:function(e,t){var r=t.payload.status;r&&(e.status=Object(j.a)({},r))},loginUserSuccess:function(e,t){var r=t.payload.currentUser;e.loading=!1,e.connected=!0,e.errors={},e.status=null,e.currentUser=r},loginUserFailure:function(e,t){var r=t.payload.error;e.loading=!1,e.connected=!1,e.errors=r,e.status=null},addSecretToFolderFailure:function(e,t){var r=t.payload.error;e.errors=r},removeSecretFromCurrentFolderFailure:function(e,t){var r=t.payload.error;e.errors=r},hideShortpass:function(e){e.showShortpass=!1}}}),_=H.actions,z=_.loading,G=(_.endLoading,_.createSecret,_.createSecretSuccess),J=_.createSecretFailure,Y=_.disconnectUserSuccess,V=_.connectionChange,W=_.createUserSuccess,q=_.createUserFailure,Q=_.disableShortLoginSuccess,$=_.onLoginUserProgress,X=_.loginUserSuccess,Z=_.loginUserFailure,ee=_.addSecretToFolderFailure,te=_.removeSecretFromCurrentFolderFailure,re=_.hideShortpass,ne=function(e){var t=e.username,r=e.password,n=e.confirmPassword;return function(e){e(z()),r!==n?setTimeout((function(){return e(q({error:{confirmPassword:"Passwords mismatch"}}))}),100):P.newUser(t,r).then((function(t){return e(W({currentUser:t}))})).catch((function(t){if(t instanceof I)return e(q({error:{username:"User already exists"}}));if(t.message.startsWith("The password"))return e(q({error:{password:t.message}}));throw t}))}},se=function(e){var t=e.username,r=e.password,n=e.token;return function(e){console.time("decrypt"),e(z()),P.loginUser(t,r,n,(function(){return e(ae.apply(void 0,arguments))}),!1).then((function(t){return e(X({currentUser:t,options:Object(j.a)(Object(j.a)({},t.options),{},{totp:t.totp,shortLogin:P.canITryShortLogin()}),metadata:t.metadatas}))})).catch((function(t){if(t instanceof E)return e(Z({error:{username:"User not found"}}));if(t instanceof R)return e(Z(n?{error:{totp:"Token",password:"Invalid password",token:"or invalid token"}}:{error:{password:"Invalid password"}}));if(t instanceof M)return e(Z({error:{totp:"Token"}}));throw t}))}},ae=function(e){return function(t,r){var n=P.currentUser;switch(e.constructor){case F:case T:case K:var s=r().AppUI.status;if(s){var a=s.state,i=s.total;if(a&&i&&Math.round(e.state/e.total*100)===Math.round(a/i*100))return}return t($({status:e}));case D:return t(X({currentUser:n,options:Object(j.a)(Object(j.a)({},n.options),{},{totp:n.totp,shortLogin:P.canITryShortLogin()}),metadata:n.metadatas})),console.timeEnd("decrypt"),t($({status:null}));default:return}}},ie=H.reducer,ce=r(57),oe=Object(ce.a)((function(e){return e.Metadata.metadata}),(function(e){return Object.values(e).filter((function(e){return"folder"!==e.type}))})),ue=Object(ce.a)(oe,(function(e){return e.AppUI.currentUser}),(function(e,t){return e?e.filter((function(e){var r=e.users.find((function(e){return e.username===t.username}));return 2===(null===r||void 0===r?void 0:r.rights)})):[]})),de=Object(ce.a)((function(e){return e.Metadata.metadata}),(function(e){return e.AppUI.currentUser}),(function(e,t){return t}),(function(e,t,r){if(!t||!e)return{};var n=t.username;return Object.values(e).filter((function(e){var t=e.users.find((function(e){return e.id===n})),s=(null===t||void 0===t?void 0:t.folders)||{};return!r&&s.ROOT||r&&Object.keys(s).includes(r)}))})),le=Object(ce.a)(oe,(function(e){return e?e.filter((function(e){return e.users.length>1})):[]})),he=r(51),pe=r(226),fe=r(489),be=r(227),ve=r.n(be),me=r(15),ge=r.n(me),ye=r(17),je=r(0),we={small:18,base:24},Oe=function(e){Object(v.a)(r,e);var t=Object(m.a)(r);function r(){return Object(p.a)(this,r),t.apply(this,arguments)}return Object(f.a)(r,[{key:"render",value:function(){var e=this.props,t=e.id,r=e.size,n=ge()("icon","icon--id-".concat(t),this.props.className,Object(ye.a)({},"icon--size-".concat(r),"string"===typeof r));return Object(je.jsx)("svg",{className:n,width:"string"===typeof r?we[r]:r,height:"string"===typeof r?we[r]:r,children:Object(je.jsx)("use",{xlinkHref:"#".concat(t)})})}}]),r}(u.Component);Oe.defaultProps={size:"base",className:""};var Se=Oe;function xe(e){var t=ge()("modal",e.className,{"modal--centered":e.centered});return Object(je.jsx)(ve.a,{className:t,backdropClassName:"modal-backdrop",show:e.show,onHide:e.closeOnBackdropClick?e.onClose:void 0,children:Object(je.jsxs)("div",{className:"modal-dialog",children:[e.onClose&&Object(je.jsx)("button",{className:"modal-dialog-close",onClick:e.onClose,children:Object(je.jsx)(Se,{id:"close",size:"small"})}),e.children]})})}xe.defaultProps={centered:!1},xe.Body=function(e){return Object(je.jsx)("div",{className:"modal-body",children:e.children})},xe.Header=function(e){return Object(je.jsx)("div",{className:"modal-header",children:Object(je.jsx)("h2",{className:"modal-header-title",children:e.title||e.children})})},xe.Footer=function(e){return Object(je.jsx)("div",{className:"modal-footer",children:e.children})};var ke=xe,Ce=function(e){Object(v.a)(r,e);var t=Object(m.a)(r);function r(e){var n;return Object(p.a)(this,r),(n=t.call(this,e)).handleClick=n.handleClick.bind(Object(b.a)(n)),n}return Object(f.a)(r,[{key:"handleClick",value:function(){this.props.disabled||this.props.onClick()}},{key:"render",value:function(){var e=ge()("button","button--style-".concat(this.props.buttonStyle),"button--size-".concat(this.props.size));return this.props.to?Object(je.jsx)(y.b,{className:e,title:this.props.title,onClick:this.handleClick,to:this.props.to,disabled:this.props.disabled,children:this.props.children}):Object(je.jsx)("button",{className:e,name:this.props.name,title:this.props.title,type:this.props.type,form:this.props.form,onClick:this.handleClick,disabled:this.props.disabled,tabIndex:this.props.tabIndex,children:this.props.children})}}]),r}(u.Component);Ce.defaultProps={type:"button",size:"base",form:null,buttonStyle:"primary",onClick:function(){return{}},disabled:!1};var Ue=Ce,Ae=function(e){Object(v.a)(r,e);var t=Object(m.a)(r);function r(){return Object(p.a)(this,r),t.apply(this,arguments)}return Object(f.a)(r,[{key:"render",value:function(){return Object(je.jsxs)(je.Fragment,{children:[Object(je.jsx)(ke.Header,{title:"Welcome to Secret-in.me"}),Object(je.jsx)(ke.Body,{children:Object(je.jsxs)("div",{children:[Object(je.jsxs)("p",{children:[Object(je.jsx)("a",{href:"https://my.secret-in.me",target:"_blank",rel:"noopener noreferrer",children:"Secret-in.me"})," ","is a team-oriented"," ",Object(je.jsx)("a",{href:"https://github.com/secretin",target:"_blank",rel:"noopener noreferrer",children:"open source"})," ","password manager with a focus on transparency, usability and security."]}),Object(je.jsx)("p",{children:"If it's your first time here, you can create a user and start saving your secrets."}),Object(je.jsxs)("p",{children:["Be careful, all your secrets will be protected by the password you pick. There is ",Object(je.jsx)("b",{children:"no way"})," to retrieve your secrets if you forget your password !"]}),Object(je.jsxs)("p",{children:["This secret manager is freely provided with"," ",Object(je.jsx)("span",{role:"img","aria-label":"red-heart-emoji",children:"\u2764\ufe0f"})," ","by"," ",Object(je.jsx)("a",{href:"https://bug.builders",target:"_blank",rel:"noopener noreferrer",children:"Bug Builders."})]}),Object(je.jsxs)("p",{children:["If you enjoy it, please consider"," ",Object(je.jsx)("a",{href:"https://donorbox.org/secret-in-me/",target:"_blank",rel:"noopener noreferrer",children:Object(je.jsx)("b",{children:"donating !"})})," "]}),Object(je.jsx)("p",{children:"It'll help us support hosting costs (~50$ per month)."})]})})]})}}]),r}(u.Component),Pe=Ae,Ne=function(e){Object(v.a)(r,e);var t=Object(m.a)(r);function r(){return Object(p.a)(this,r),t.apply(this,arguments)}return Object(f.a)(r,[{key:"render",value:function(){return Object(je.jsxs)(ke,{show:this.props.showModal,onClose:null!==this.props.acknowledgedVersion&&this.props.hideNews,children:[null===this.props.acknowledgedVersion?Object(je.jsx)(Pe,{}):Object(je.jsxs)(je.Fragment,{children:[Object(je.jsx)(ke.Header,{title:"What's new ?"}),Object(je.jsx)(ke.Body,{children:this.props.news.map((function(e){return Object(je.jsxs)("div",{children:[Object(je.jsx)("h2",{children:e.title}),Object(je.jsx)("p",{children:e.description})]},e.version)}))})]}),Object(je.jsxs)(ke.Footer,{children:[null!==this.props.acknowledgedVersion&&Object(je.jsx)(Ue,{type:"reset",buttonStyle:"default",onClick:this.props.hideNews,children:Object(je.jsx)(fe.a,{id:"Close"})}),Object(je.jsx)(Ue,{type:"submit",onClick:this.props.acknowledgeVersion,children:"OK"})]})]})}}]),r}(u.Component),Te=Ne;function De(e){return Ie[e]}function Ke(){return window.navigator.language&&Fe[window.navigator.language]?window.navigator.language:"en"}var Fe={en:"English",fr:"Fran\xe7ais"},Ie={en:{login:"Username",password:"Password","Sign up":"Sign up","Sign in":"Sign in",confirmPassword:"Confirm password",alreadyHaveAccount:"I already have an account",SignInSubtext:"sign in",logout:"Log out",dontHaveAccount:"I don't have an account",SignUpSubtext:"create one",defaultLanguage:"Language",donate:"Donate",all:"All","my secrets":"My secrets","shared secrets":"Shared secrets",settings:"Settings","export secrets":"Export secrets","import secrets":"Importer secrets","new secret":"Secret","new folder":"Folder",search:"Search...","Last modified":"Last modified","Shared with":"Shared with",Title:"Title","create folder title":"Add new folder","create secret title":"Add new secret","add folder button":"Add folder","add secret button":"Add secret",Close:"Close",shareWarning:"You are about to give",latest:"(latest)",oldest:"(oldest)","Secret title":"Secret title",Copy:"Copy",Open:"Open",url:"url",to:"to",on:"on","Share the secret":"Share the secret","Read only":"Read only","Read and write":"Read and write","Read, write and share":"Read, write and share","You don't have the permission to share this secret":"You don't have the permission to share this secret","You can't modify or remove yourself":"You can't modify or remove yourself","Generate strong":"Generate strong","Generate alphanumeric":"Generate alphanumeric","Generate pronounceable":"Generate pronounceable",Details:"Details","Who has access":"Who has access",History:"History",Save:"Save","Untitled secret":"Untitled secret","Untitled folder":"Untitled folder","Folder title":"Folder title",Cancel:"Cancel"},fr:{login:"Nom d'utilisateur",password:"Mot de passe","Sign up":"Cr\xe9er un compte","Sign in":"Se connecter",logout:"D\xe9connexion",confirmPassword:"Confirmer le mot de passe",alreadyHaveAccount:"J'ai d\xe9j\xe0 un compte",SignInSubtext:"me connecter",dontHaveAccount:"Je n'ai pas de compte",SignUpSubtext:"m'enregistrer",defaultLanguage:"Langue de l'interface",donate:"Faire un don",all:"Tous les secrets","my secrets":"Mes secrets","shared secrets":"Secrets partag\xe9s",settings:"Param\xe8tres","export secrets":"Exporter mes secrets","import secrets":"Importer des secrets","new secret":"Secret","new folder":"Dossier",search:"Rechercher...","Last modified":"Derni\xe8re modification","Shared with":"Partag\xe9 avec",Title:"Titre","create folder title":"Ajout d'un dossier","create secret title":"Ajout d'un secret","Folder title":"Titre du dossier","Secret title":"Titre du secret",Cancel:"Annuler","add folder button":"Cr\xe9er le dossier","add secret button":"Cr\xe9er le secret",Copy:"Copier","Untitled folder":"Dossier sans titre","Untitled secret":"Secret sans titre",Open:"Ouvrir",Close:"Fermer",Details:"D\xe9tails","Who has access":"Partage",History:"Historique",Save:"Sauvegarder","read access":"lecture","read and write access":"lecture et \xe9criture","read, write and share access":"lecture, \xe9criture et partage","Are you sure?":"\xcates-vous s\xfbr\xb7e ?",shareWarning:"Vous vous appr\xeatez \xe0 donner les droits de",to:"\xe0",on:"sur","Share the secret":"Partager le secret","Read only":"Lecture seule","Read and write":"Lecture et \xe9criture","Read, write and share":"Lecture, \xe9criture et partage","You don't have the permission to share this secret":"Vous n'avez pas la permission de partager ce secret","You can't modify or remove yourself":"Vous ne pouvez pas modifier vos propres permissions","Generate strong":"Mot de passe fort","Generate alphanumeric":"Mot de passe alphanum\xe9rique","Generate pronounceable":"Mot de passe pronon\xe7able",latest:"(le plus r\xe9cent)",oldest:"(le plus ancien)",url:"url"}},Ee=r(26),Re=function(e){Object(v.a)(r,e);var t=Object(m.a)(r);function r(e){var n;return Object(p.a)(this,r),(n=t.call(this,e)).onChange=function(e){var t=e.target;n.props.onChange({name:n.props.name,value:t.value})},n.getValue=function(){return n.select.value},n.id=Object(Ee.uniqueId)("input_"),n}return Object(f.a)(r,[{key:"render",value:function(){var e=this,t=ge()("input","input--type-select","input--size-".concat(this.props.size));return Object(je.jsxs)("div",{className:t,children:[this.props.label&&Object(je.jsxs)("label",{htmlFor:this.id,children:[this.props.label,this.props.actions.length>0&&Object(je.jsx)("span",{className:"input-label-actions",children:this.props.actions})]}),Object(je.jsxs)("div",{className:"input--type-select--input",children:[Object(je.jsx)("select",{ref:function(t){e.select=t},value:this.props.value,disabled:this.props.disabled,title:this.props.title,onChange:this.onChange,children:this.props.options.map((function(e){return Object(je.jsx)("option",{value:e[0],children:e[1]},e[0])}))}),Object(je.jsx)(Se,{id:"arrow-down"})]})]})}}]),r}(u.Component);Re.defaultProps={disabled:!1,size:"base",onChange:Ee.noop,actions:[]};var Me=Re,Le="Secret-in:acknowledgedVersion",Be=function(e){Object(v.a)(r,e);var t=Object(m.a)(r);function r(e){var n;Object(p.a)(this,r),(n=t.call(this,e)).showNews=function(){return n.setState({showModal:!0})},n.hideNews=function(){return n.setState({showModal:!1})},n.acknowledgeVersion=function(){window.localStorage.setItem(Le,n.state.commit),n.setState({news:[],acknowledgeVersion:n.state.commit,showModal:!1})};var s=SECRETIN_APP_COMMIT,a=window.localStorage.getItem(Le);return n.state={commit:s,acknowledgedVersion:a,news:[],showModal:!a,defaultLanguage:localStorage.getItem("defaultLanguage")||Ke()},n}return Object(f.a)(r,[{key:"onChangeUserLanguage",value:function(e){localStorage.setItem("defaultLanguage",e),this.setState({defaultLanguage:e}),this.props.onChangeLanguage()}},{key:"componentDidMount",value:function(){var e=this;null!==this.state.acknowledgedVersion&&("develop"!==this.state.commit&&this.state.acknowledgedVersion!==this.state.commit&&fetch("https://raw.githubusercontent.com/secretin/secretin-website/develop/changelog.json").then((function(e){return e.json()})).then((function(t){var r,n=[],s=!1,a=Object(pe.a)(t.changelog);try{for(a.s();!(r=a.n()).done;){var i=r.value;if(i.version===e.state.acknowledgedVersion){s=!0;break}n.push(i)}}catch(c){a.e(c)}finally{a.f()}s?e.setState({news:n}):e.setState({news:[t.changelog[0]]})})).catch((function(){})))}},{key:"render",value:function(){var e=this,t=this.state.commit?this.state.commit.substr(0,7):"",r=this.state.defaultLanguage;return Object(je.jsxs)("div",{className:"footer",children:[Object(je.jsx)(Te,{news:this.state.news,acknowledgeVersion:this.acknowledgeVersion,acknowledgedVersion:this.state.acknowledgedVersion,hideNews:this.hideNews,showModal:this.state.showModal}),Object(je.jsxs)("span",{className:"secretin-version",children:[this.state.news.length>0&&Object(je.jsx)("span",{className:"new-in-secretin-version",onClick:this.showNews,children:"\u2022"}),Object(je.jsxs)("span",{className:"secretin-version-text",children:["secretin-app"," ",Object(je.jsx)("a",{href:"https://github.com/secretin/secretin-app/commit/".concat(this.state.commit),rel:"noopener noreferrer",target:"_blank",children:t})]})]}),Object(je.jsx)("span",{className:"secretin-version",children:Object(je.jsxs)("span",{className:"secretin-version-text",children:["secretin-lib v",O.a.version]})}),Object(je.jsx)("span",{className:"secretin-version",children:Object(je.jsx)("span",{className:"secretin-version-text",children:Object(je.jsxs)("a",{href:"https://donorbox.org/secret-in-me/",target:"_blank",rel:"noopener noreferrer",children:[Object(je.jsx)("span",{role:"img","aria-label":"red-heart-emoji",children:"\u2764\ufe0f"})," ",Object(je.jsx)("b",{children:Object(je.jsx)(fe.a,{id:"donate"})}),Object(je.jsx)("span",{role:"img","aria-label":"red-heart-emoji",children:"\u2764\ufe0f"})," "]})})}),Object(je.jsx)(Me,{value:r,label:Object(je.jsx)(fe.a,{id:"defaultLanguage"}),options:Object.entries(Fe).map((function(e){var t=Object(he.a)(e,2);return[t[0],t[1]]})),size:"extra-small",title:"Preferred language",onChange:function(t){var r=t.value;return e.onChangeUserLanguage(r)}})]})}}]),r}(u.Component),He=function(e){Object(v.a)(r,e);var t=Object(m.a)(r);function r(e){var n;return Object(p.a)(this,r),(n=t.call(this,e)).id=e.id||Object(Ee.uniqueId)("form_"),n.onSubmit=n.onSubmit.bind(Object(b.a)(n)),n}return Object(f.a)(r,[{key:"onSubmit",value:function(e){e.preventDefault(),this.props.disabled||this.props.onSubmit()}},{key:"render",value:function(){var e=ge()("form",this.props.className);return Object(je.jsxs)("form",{id:this.id,className:e,onSubmit:this.onSubmit,autoComplete:this.props.autoComplete?null:"new-password",children:[!this.props.autoComplete&&[Object(je.jsx)("input",{name:"autofill_trap_email",type:"text",style:{display:"none"}},"autofill_trap_email"),Object(je.jsx)("input",{name:"autofill_trap_password",type:"password",style:{display:"none"}},"autofill_trap_password")],Object(je.jsx)("input",{type:"submit",style:{display:"none"}}),this.props.children]})}}]),r}(u.Component);He.defaultProps={disabled:!1,autoComplete:!1,onSubmit:function(){return{}}};var _e=He,ze=r(163),Ge=r.n(ze),Je=r(229),Ye=r.n(Je);Ge.a.MenuItem=function(e){return Object(je.jsx)(Ye.a,Object(j.a)({className:"dropdown-menu-item"},e))};var Ve=Ge.a,We=function(e){Object(v.a)(r,e);var t=Object(m.a)(r);function r(e){var n;return Object(p.a)(this,r),(n=t.call(this,e)).handleChange=n.handleChange.bind(Object(b.a)(n)),n.onTogglePasswordShow=n.onTogglePasswordShow.bind(Object(b.a)(n)),n.id=Object(Ee.uniqueId)("".concat(n.props.name,"_input_")),n.state={autoCompleteSelected:!1,showPassword:!1},n}return Object(f.a)(r,[{key:"componentDidMount",value:function(){var e=this;this.props.autoSelect&&setTimeout((function(){return e.input.select()}),0),this.props.autoFocus&&setTimeout((function(){return e.input.focus()}),0)}},{key:"onTogglePasswordShow",value:function(){this.setState({showPassword:!this.state.showPassword})}},{key:"handleChange",value:function(e){this.state.autoCompleteSelected&&this.setState({autoCompleteSelected:!1}),this.props.onChange({name:this.props.name,value:e.target.value})}},{key:"handleAutoCompleteSelect",value:function(e){this.setState({autoCompleteSelected:!0}),this.props.onChange({name:this.props.name,value:e})}},{key:"select",value:function(){this.input.select()}},{key:"render",value:function(){var e=this,t=ge()("input","input--type-".concat(this.props.type),"input--size-".concat(this.props.size),{"input--error":this.props.error}),r=this.props,n=r.type,s=r.title,a=r.autoComplete,i=r.autoFocus,c=r.disabled,o=r.error,u=r.label,d=r.placeholder,l=r.readOnly,h=r.actions,p=r.inputProps,f=r.autoCompleteFromList,b=this.props.value.length>0?f.filter((function(t){return t.toLowerCase().includes(e.props.value.toLowerCase())})):[];return Object(je.jsxs)("div",{className:t,children:[u&&Object(je.jsxs)("label",{htmlFor:this.id,children:[u,h.length>0&&Object(je.jsx)("span",{className:"input-label-actions",children:h})]}),Object(je.jsxs)("div",{className:"input--wrapper",children:[Object(je.jsx)("input",Object(j.a)({id:this.id,ref:function(t){e.input=t},name:this.id,title:s,type:"password"===n&&this.state.showPassword?"text":n,value:this.props.value,onChange:this.handleChange,placeholder:d,autoComplete:a?"on":"off",autoFocus:i,disabled:c,readOnly:l},p)),!this.state.autoCompleteSelected&&b.length>0&&Object(je.jsx)(Ve,{id:"input--auto-complete-list",open:Boolean(this.props.value.length>0),children:Object(je.jsx)(Ve.Menu,{children:b.slice(0,5).map((function(t){return Object(je.jsx)(Ve.MenuItem,{onSelect:function(){return e.handleAutoCompleteSelect(t)},children:t},t)}))})}),"password"===n&&Object(je.jsx)("div",{className:"input--password-show",children:Object(je.jsx)(Ue,{title:"Show",buttonStyle:"icon",onClick:this.onTogglePasswordShow,tabIndex:"-1",children:Object(je.jsx)(Se,{id:this.state.showPassword?"show":"hide",size:"small"})})})]}),o&&Object(je.jsx)("span",{className:"input-error",children:o})]})}}]),r}(u.Component);We.defaultProps={type:"text",value:"",autoFocus:!1,autoSelect:!1,autoComplete:!1,autoCompleteFromList:[],disabled:!1,readOnly:!1,actions:[],size:"base",debounce:0};var qe=We,Qe=function(e){Object(v.a)(r,e);var t=Object(m.a)(r);function r(e){var n;return Object(p.a)(this,r),(n=t.call(this,e)).onSubmit=n.onSubmit.bind(Object(b.a)(n)),n.toggleSignup=n.toggleSignup.bind(Object(b.a)(n)),n.handleChange=n.handleChange.bind(Object(b.a)(n)),n.state={signup:!1,username:e.savedUsername,password:"",confirmPassword:"",showShortpass:P.canITryShortLogin()},n}return Object(f.a)(r,[{key:"onSubmit",value:function(e){e&&e.preventDefault(),this.state.signup?this.props.dispatch(ne({username:this.state.username,password:this.state.password,confirmPassword:this.state.confirmPassword})):this.props.dispatch(se({username:this.state.username,password:this.state.password,token:this.state.token}))}},{key:"toggleSignup",value:function(e){this.setState({signup:e})}},{key:"handleChange",value:function(e){var t=e.name,r=e.value;this.setState(Object(ye.a)({},t,r))}},{key:"render",value:function(){var e=this,t=this.state.signup?Object(je.jsx)(fe.a,{id:"Sign up"}):Object(je.jsx)(fe.a,{id:"Sign in"});return Object(je.jsxs)(_e,{className:"user-connect-form",disabled:this.props.loading,onSubmit:this.onSubmit,children:[Object(je.jsx)("h2",{className:"user-connect-title",title:this.props.isOnline&&P.api.db,children:Object(je.jsx)("img",{src:"/logo.svg",style:{width:"70%"},alt:"logo",title:this.props.isOnline?"Secret-In.me":"Offline"})}),Object(je.jsx)(qe,{name:"username",label:Object(je.jsx)(fe.a,{id:"login"}),type:"text",value:this.state.username,onChange:this.handleChange,disabled:this.props.loading,error:this.props.errors.username,autoFocus:""===this.props.savedUsername,autoComplete:!0}),Object(je.jsx)(qe,{name:"password",label:Object(je.jsx)(fe.a,{id:"password"}),type:"password",value:this.state.password,onChange:this.handleChange,disabled:this.props.loading,error:this.props.errors.password,autoFocus:""!==this.props.savedUsername}),this.props.errors.totp&&Object(je.jsx)(qe,{name:"token",label:"Token",type:"text",value:this.state.token,onChange:this.handleChange,disabled:this.props.loading,error:this.props.errors.token,autoFocus:!0}),this.state.signup&&Object(je.jsx)(qe,{name:"confirmPassword",label:Object(je.jsx)(fe.a,{id:"confirmPassword"}),type:"password",value:this.state.confirmPassword,onChange:this.handleChange,disabled:this.props.loading,error:this.props.errors.confirmPassword}),this.props.errors.shortLoginExpired&&Object(je.jsxs)("h3",{className:"tooltip",children:[this.props.errors.shortLoginExpired.message,Object(je.jsx)(Se,{id:"info",size:13}),Object(je.jsx)("span",{className:"tooltiptext",children:this.props.errors.shortLoginExpired.info})]}),Object(je.jsx)(Ue,{type:"submit",disabled:this.props.loading||Object(Ee.isEmpty)(this.state.username)||Object(Ee.isEmpty)(this.state.password),children:t}),Object(je.jsx)("div",{className:"user-connect-create",children:Object(je.jsx)("span",{children:this.state.signup?Object(je.jsxs)("span",{children:[Object(je.jsx)(fe.a,{id:"alreadyHaveAccount"}),",\xa0",Object(je.jsx)("a",{onClick:function(){e.toggleSignup(!e.state.signup)},tabIndex:"-1",children:Object(je.jsx)(fe.a,{id:"SignInSubtext"})})]}):Object(je.jsxs)("span",{children:[Object(je.jsx)(fe.a,{id:"dontHaveAccount"}),",\xa0",Object(je.jsx)("a",{onClick:function(){e.toggleSignup(!e.state.signup)},tabIndex:"-1",children:Object(je.jsx)(fe.a,{id:"SignUpSubtext"})})]})})})]})}}]),r}(u.Component),$e=Object(g.b)((function(e){return{isOnline:e.AppUI.online}}))(Qe),Xe=function(e){Object(v.a)(r,e);var t=Object(m.a)(r);function r(e){var n;return Object(p.a)(this,r),(n=t.call(this,e)).handleAccept=n.handleAccept.bind(Object(b.a)(n)),n.handleCancel=n.handleCancel.bind(Object(b.a)(n)),n.promise=new Promise((function(e,t){n.accept=e,n.cancel=t})),n.state={used:!1},n}return Object(f.a)(r,[{key:"handleAccept",value:function(){this.setState({used:!0}),this.accept()}},{key:"handleCancel",value:function(){this.setState({used:!0}),this.cancel()}},{key:"render",value:function(){return Object(je.jsxs)(ke,{show:!0,centered:!0,onClose:this.promise.reject,children:[this.props.title&&Object(je.jsx)(ke.Header,{children:this.props.title}),Object(je.jsx)(ke.Body,{children:this.props.text}),Object(je.jsxs)(ke.Footer,{children:[Object(je.jsx)(Ue,{type:"reset",buttonStyle:"default",onClick:this.handleCancel,disabled:this.state.used,children:this.props.cancelLabel}),Object(je.jsx)(Ue,{buttonStyle:"primary",onClick:this.handleAccept,disabled:this.state.used,children:this.props.acceptLabel})]})]})}}]),r}(u.Component);function Ze(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=document.body.appendChild(document.createElement("div")),r=h.a.render(d.a.createElement(Xe,e),t);return r.promise.then(e.onAccept).catch(e.onCancel).then((function(){h.a.unmountComponentAtNode(t),setTimeout((function(){return t.remove()}))}))}var et=r(28),tt=r.n(et),rt=function(e){Object(v.a)(r,e);var t=Object(m.a)(r);function r(e){var n;return Object(p.a)(this,r),(n=t.call(this,e)).handleChange=n.handleChange.bind(Object(b.a)(n)),n.handleSubmit=n.handleSubmit.bind(Object(b.a)(n)),n.handleDisable=n.handleDisable.bind(Object(b.a)(n)),n.state={shortpass:""},n}return Object(f.a)(r,[{key:"handleChange",value:function(e){this.setState({shortpass:e.value})}},{key:"handleSubmit",value:function(){this.props.dispatch(function(e){var t=e.shortpass;return function(e){e(z()),P.shortLogin(t,(function(){return e(ae.apply(void 0,arguments))}),!1).then((function(t){e(X({currentUser:t,options:Object(j.a)(Object(j.a)({},t.options),{},{totp:t.totp,shortLogin:P.canITryShortLogin()}),metadata:t.metadatas}))})).catch((function(){e(Z({error:{shortlogin:"Expired shortpass"}})),setTimeout((function(){e(re())}),1e3)}))}}({shortpass:this.state.shortpass}))}},{key:"handleDisable",value:function(){var e=this;Ze({title:"Are you sure?",text:Object(je.jsx)("span",{children:"This will disable your short pass login access."}),acceptLabel:"Disable short pass",cancelLabel:"Cancel",onAccept:function(){e.props.dispatch((function(e){e(z()),P.deactivateShortLogin(),e(Q()),e(re())}))},onCancel:function(){return{}}})}},{key:"render",value:function(){var e=P.getShortLoginActivationDate(),t=e?" (expires "+tt()(e).add(7,"days").fromNow()+")":"";return Object(je.jsxs)(_e,{className:"user-connect-form",disabled:this.props.loading,onSubmit:this.handleSubmit,children:[Object(je.jsxs)("h2",{className:"user-connect-title",children:["Hello again ",this.props.savedUsername,"!"]}),Object(je.jsx)(qe,{label:"Shortpass".concat(t),name:"shortpass",value:this.state.shortpass,type:"password",onChange:this.handleChange,error:this.props.error,autoFocus:!0}),Object(je.jsx)(Ue,{type:"button",buttonStyle:"primary",disabled:this.props.loading||Object(Ee.isEmpty)(this.state.shortpass),onClick:this.handleSubmit,children:"Connect"}),Object(je.jsx)("a",{className:"user-connect-more",tabIndex:-1,onClick:this.handleDisable,children:"Use another account"})]})}}]),r}(u.Component),nt=Object(g.b)()(rt),st=function(e){Object(v.a)(r,e);var t=Object(m.a)(r);function r(e){var n;return Object(p.a)(this,r),(n=t.call(this,e)).onSubmit=n.onSubmit.bind(Object(b.a)(n)),n.toggleSignup=n.toggleSignup.bind(Object(b.a)(n)),n.handleChange=n.handleChange.bind(Object(b.a)(n)),n.state={signup:!1,username:"",password:""},n}return Object(f.a)(r,[{key:"onSubmit",value:function(e){e&&e.preventDefault(),this.state.signup?this.props.dispatch(ne({username:this.state.username,password:this.state.password})):this.props.dispatch(se({username:this.state.username,password:this.state.password,token:this.state.token}))}},{key:"toggleSignup",value:function(e){var t=e.checked;this.setState({signup:t})}},{key:"handleChange",value:function(e){var t=e.name,r=e.value;this.setState(Object(ye.a)({},t,r))}},{key:"render",value:function(){var e=this.props,t=e.savedUsername,r=e.loading,n=e.errors,s=e.showShortpass,a=P.getShortLoginActivationDate(),i=!!a&&tt()(a).add(7,"days").isBefore(tt()());return Object(je.jsx)("div",{className:"user-connect",children:s&&!i?Object(je.jsx)(nt,{savedUsername:t,loading:r,error:n.shortlogin}):Object(je.jsx)($e,{loading:r,savedUsername:t||"",errors:Object(j.a)(Object(j.a)({},n),a&&i?{shortLoginExpired:{message:"Your shortpass has expired ",info:"Previous shortpass will automatically reactivate for your account ".concat(t," if you sign-in.")}}:{})})})}}]),r}(u.Component),at=Object(g.b)((function(e){var t=e.AppUI;return{showShortpass:t.showShortpass,status:t.status}}))(st),it=r(25),ct=r(230),ot=["children"];function ut(e){var t=e.children,r=Object(ct.a)(e,ot);return Object(je.jsx)("li",{className:"sidebar-menu-item",children:Object(je.jsx)(y.c,Object(j.a)(Object(j.a)({className:"sidebar-menu-link",activeClassName:"sidebar-menu-link--active"},r),{},{children:t}))})}function dt(){P.exportDb().then((function(e){!function(e,t){var r=document.createElement("a");r.setAttribute("href","data:application/json;charset=utf-8,".concat(encodeURIComponent(t))),r.setAttribute("download",e),r.style.display="none",document.body.appendChild(r),r.click(),document.body.removeChild(r)}("Secret-in_".concat(P.currentUser.username,"_").concat(tt()().format(),".json"),e)}))}var lt=function(){var e=Object(g.d)((function(e){return e.AppUI.currentUser})),t=Object(g.d)((function(e){return e.AppUI.online}));return Object(je.jsxs)("div",{className:"sidebar",children:[Object(je.jsx)("div",{className:"sidebar-header",children:Object(je.jsx)(y.b,{to:"/",title:t&&P.api.db,children:Object(je.jsx)("img",{src:"/logo.svg",style:{width:"100%"},alt:"logo",title:t?"Secret-In.me":"Offline"})})}),Object(je.jsx)("div",{className:"sidebar-content",children:Object(je.jsxs)("ul",{className:"sidebar-menu",children:[Object(je.jsxs)(ut,{to:"/secrets/",exact:!0,children:[Object(je.jsx)(Se,{id:"home",size:"base"}),e.username]}),Object(je.jsx)("div",{className:"sidebar-separator"}),Object(je.jsxs)(ut,{to:"/secrets/all/",children:[Object(je.jsx)(Se,{id:"apps",size:"base"}),Object(je.jsx)(fe.a,{id:"all"})]}),Object(je.jsxs)(ut,{to:"/secrets/mine",exact:!0,children:[Object(je.jsx)(Se,{id:"user",size:"base"}),Object(je.jsx)(fe.a,{id:"my secrets"})]}),Object(je.jsxs)(ut,{to:"/secrets/shared",exact:!0,children:[Object(je.jsx)(Se,{id:"people",size:"base"}),Object(je.jsx)(fe.a,{id:"shared secrets"})]}),Object(je.jsx)("div",{className:"sidebar-separator"}),Object(je.jsxs)(ut,{to:"/settings/",children:[Object(je.jsx)(Se,{id:"gear",size:"base"}),Object(je.jsx)(fe.a,{id:"settings"})]}),Object(je.jsx)("div",{className:"sidebar-separator"}),Object(je.jsx)("li",{className:"sidebar-menu-item",children:Object(je.jsxs)("a",{className:"sidebar-menu-link",onClick:dt,children:[Object(je.jsx)(Se,{id:"export",size:"base"}),Object(je.jsx)(fe.a,{id:"export secrets"})]})}),Object(je.jsxs)(ut,{to:"/import/",children:[Object(je.jsx)(Se,{id:"import",size:"base"}),Object(je.jsx)(fe.a,{id:"import secrets"})]}),Object(je.jsx)("div",{className:"sidebar-separator"}),Object(je.jsx)("li",{className:"sidebar-menu-item",children:Object(je.jsxs)("a",{className:"sidebar-menu-link",onClick:function(){return window.location.reload()},children:[Object(je.jsx)(Se,{id:"logout",size:"base"}),Object(je.jsx)(fe.a,{id:"logout"})]})})]})})]})},ht=r(18),pt=r(116),ft=r(117),bt=r(69),vt=r.n(bt),mt=r(52),gt=r.n(mt),yt=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Object(p.a)(this,e),this.id=t.id||gt.a.v4(),this.date=t.date||null,this.type=t.type||"text",this.label=t.label||"",this.content=t.content||""}return Object(f.a)(e,[{key:"getRaw",value:function(){return{id:this.id,date:this.date,type:this.type,label:this.label,content:this.content}}}],[{key:"createFromRaw",value:function(t){var r=Object(j.a)(Object(j.a)({},t),{},{content:t.content});return r.value&&delete r.value,new e(r)}}]),e}(),jt=yt,wt=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Object(p.a)(this,e),this.type=t.type||"default",this.fields=t.fields||[]}return Object(f.a)(e,[{key:"addNewField",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this.fields.push(new jt(e).getRaw()),this}},{key:"getRaw",value:function(){return{type:this.type,fields:this.fields}}}],[{key:"createWithDefaultFields",value:function(t){return t.reduce((function(e,t){return e.addNewField(t)}),new e)}},{key:"createFromRaw",value:function(t){return new e(Object.entries(t).reduce((function(e,t){var r=Object(he.a)(t,2),n=r[0],s=r[1];return"fields"===n?Object(j.a)(Object(j.a)({},e),{},{fields:s.map((function(e){return jt.createFromRaw(e).getRaw()}))}):e}),t))}}]),e}();wt.DEFAULT_FIELDS=[{label:"login",type:"text"},{label:"password",type:"password"},{label:"url",type:"url"}];var Ot=wt,St=[0,1,2];function xt(e){switch(e){case 0:return"Read only";case 1:return"Read and write";case 2:return"Read, write and share";default:throw new Error('Unknown access rights "'.concat(e,'"'))}}var kt,Ct=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Object(p.a)(this,e),this.id=t.username||gt.a.v4(),this.username=t.username||"",this.rights=t.rights||0,this.folders=t.folders||{}}return Object(f.a)(e,[{key:"isValid",value:function(){return this.username.length>0}},{key:"merge",value:function(e){var t=this;return Object.entries(e).forEach((function(e){var r=Object(he.a)(e,2),n=r[0],s=r[1];t[n]=s})),this}},{key:"getRaw",value:function(){return{id:this.id,username:this.username,rights:this.rights,folders:this.folders}}}],[{key:"createFromRaw",value:function(t){return new e(t)}}]),e}(),Ut=Ct,At=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Object(p.a)(this,e),this.id=t.id||null,this.type=t.type||null,this.title=t.title||null,this.lastModifiedBy=t.lastModifiedBy||null,this.lastModifiedAt=t.lastModifiedAt||null,this.users=t.users||{},this.data=t.data||null}return Object(f.a)(e,[{key:"getIcon",value:function(){switch(this.type){case"folder":return Object.keys(this.users)>1?"folder-shared":"folder";case"secret":default:return"description";case"windows":return"windows"}}},{key:"accessRightForUser",value:function(e){var t;return(null===(t=this.users.find((function(t){return t.id===e.username})))||void 0===t?void 0:t.rights)||0}},{key:"canBeReadBy",value:function(e){return this.accessRightForUser(e)>=0}},{key:"canBeUpdatedBy",value:function(e){return this.accessRightForUser(e)>=1}},{key:"canBeSharedBy",value:function(e){return this.accessRightForUser(e)>=2}},{key:"canBeDeleted",value:function(){return"windows"!==this.type}},{key:"merge",value:function(e){var t=this;return Object.entries(e).forEach((function(e){var r=Object(he.a)(e,2),n=r[0],s=r[1];t[n]=s})),this}},{key:"getRaw",value:function(){var e=this.id,t=this.type,r=this.title,n=this.lastModifiedBy,s=this.lastModifiedAt,a=this.data,i=this.users;return{id:e,type:t,title:r,lastModifiedBy:n,lastModifiedAt:s,data:null===a||void 0===a?void 0:a.getRaw(),users:i.map((function(e){return e.getRaw()}))}}}],[{key:"createFromRaw",value:function(t){return new e(Object.entries(t).reduce((function(e,t){var r=Object(he.a)(t,2),n=r[0],s=r[1];if(!s)return e;switch(n){case"users":return Object(j.a)(Object(j.a)({},e),{},{users:Object.values(s).map((function(e){return Ut.createFromRaw(e)}))});case"data":return Object(j.a)(Object(j.a)({},e),{},{data:Ot.createFromRaw(s).getRaw()});case"lastModifiedAt":return Object(j.a)(Object(j.a)({},e),{},{lastModifiedAt:tt()(s)});default:return e}}),t))}}]),e}(),Pt=At,Nt=A.FriendNotFoundError,Tt=function(e,t){var r=t.payload.metadata;e.metadata=function(e){return e.map((function(e){return Pt.createFromRaw(e)}))}(Object.values(r));var n=new Set;Object.values(r).forEach((function(e){Object.values(e.users).forEach((function(e){n.add(e.username)}))})),e.knownFriendList=Array.from(n).sort()};function Dt(){return{metadata:[]}}var Kt,Ft,It=Object(N.b)({name:"Metadata",initialState:{metadata:[]},reducers:{loadMetadataSuccess:Tt,deleteSecretSuccess:Tt,deleteSecretFailure:Tt,addSecretToFolderSuccess:Tt,removeSecretFromCurrentFolderSuccess:Tt,createSecretUserRightsSuccess:Tt,updateSecretSuccess:Tt,renameSecretSuccess:Tt,updateSecretUserRightsSuccess:function(e,t){var r=t.payload,n=r.secret,s=r.user,a=r.rights,i=function(e,t){return e.metadata.findIndex((function(e){return e.id===t}))}(e,n.id);e.metadata[i].users=e.metadata[i].users.map((function(e){return e.id===s.id?e.merge({rights:a}):e}))},deleteSecretUserRightsSuccess:function(e,t){var r=t.payload,n=r.secret,s=r.user,a=function(e,t){return e.metadata.find((function(e){return e.id===t}))}(e,n.id);a.users=a.users.filter((function(e){return e.id!==s.id}))}},extraReducers:(kt={},Object(ye.a)(kt,G,Tt),Object(ye.a)(kt,X,Tt),Object(ye.a)(kt,Y,Dt),kt)}),Et=It.actions,Rt=Et.loadMetadataSuccess,Mt=Et.deleteSecretSuccess,Lt=Et.deleteSecretFailure,Bt=Et.addSecretToFolderSuccess,Ht=Et.removeSecretFromCurrentFolderSuccess,_t=Et.createSecretUserRightsSuccess,zt=Et.updateSecretSuccess,Gt=Et.renameSecretSuccess,Jt=Et.updateSecretUserRightsSuccess,Yt=Et.deleteSecretUserRightsSuccess,Vt=function(){return function(e){console.time("refresh"),P.refreshUser(!0,(function(){return e(ae.apply(void 0,arguments))})).then((function(){console.timeEnd("refresh"),e(Rt({metadata:P.currentUser.metadatas}))}))}},Wt=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{isFolder:!1},t=e.title,r=e.data,n=e.folder,s=e.isFolder;return function(e){return(s?n?P.addFolder(t,n):P.addFolder(t):n?P.addSecret(t,r,n):P.addSecret(t,r)).then((function(){return e(G({metadata:P.currentUser.metadatas}))})).catch((function(t){throw e(J({error:t})),t}))}},qt=function(e){var t=e.secret,r=e.data;return function(){var e=Object(ft.a)(vt.a.mark((function e(n){var s;return vt.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n(hr()),e.prev=1,s={data:r},e.next=5,P.editSecret(t.id,r);case 5:return e.prev=5,e.next=8,P.getHistory(t.id);case 8:s.history=e.sent,e.next=15;break;case 11:e.prev=11,e.t0=e.catch(5),s.history=[],console.log(e.t0);case 15:n(zt(Object(j.a)(Object(j.a)({},s),{},{metadata:P.currentUser.metadatas}))),e.next=22;break;case 18:throw e.prev=18,e.t1=e.catch(1),n(pr({error:e.t1})),e.t1;case 22:case"end":return e.stop()}}),e,null,[[1,18],[5,11]])})));return function(t){return e.apply(this,arguments)}}()},Qt=function(e){var t=e.secret,r=e.newTitle;return function(e){return P.renameSecret(t.id,r).then((function(){e(Gt({metadata:P.currentUser.metadatas}))})).catch((function(t){throw e(pr({error:t})),t}))}},$t=function(e){var t=e.secret;return function(e){return P.deleteSecret(t.id).catch((function(t){throw e(Lt({metadata:P.currentUser.metadatas})),t})).then((function(){return e(Mt({metadata:P.currentUser.metadatas}))}))}},Xt=function(e){var t=e.secret,r=e.user,n=e.rights;return function(e){return P.shareSecret(t.id,r.username,n).then((function(){e(_t({metadata:P.currentUser.metadatas,user:r,rights:n}))})).catch((function(t){if(t instanceof Nt)return e(fr({error:{username:"User not found"}}));throw e(fr({error:{unknown:"Unknown error"}})),t}))}},Zt=function(e){var t=e.secret,r=e.user,n=e.rights;return function(e){return P.shareSecret(t.id,r.username,n).then((function(){return e(Jt({secret:t,user:r,rights:n}))})).catch((function(t){throw e(br({error:{unknown:"Unknown error"}})),t}))}},er=function(e){var t=e.secret,r=e.user;return function(e){return P.unshareSecret(t.id,r.username).then((function(){return e(Yt({secret:t,user:r}))})).catch((function(t){throw e(vr({error:{unknown:"Unknown error"}})),t}))}},tr=function(e){var t=e.secret,r=e.folder;return function(e){return P.addSecretToFolder(t.id,r.id).then((function(){return e(Bt({secret:t,folder:r,metadata:P.currentUser.metadatas}))})).catch((function(t){throw e(ee({error:{unknown:"Unknown error"}})),t}))}},rr=function(e){var t=e.secret,r=e.currentFolderId;return function(e){return P.removeSecretFromFolder(t.id,r).then((function(){return e(Ht({secret:t,currentFolderId:r,metadata:P.currentUser.metadatas}))})).catch((function(t){throw e(te({error:{unknown:"Unknown error"}})),t}))}},nr=It.reducer,sr=function(){return{secret:null,errors:{},tab:"details",isUpdating:!1,historyDepth:0}},ar=function(e,t){var r=t.payload.error;e.errors=r,e.isUpdating=!1},ir=Object(N.b)({name:"ShowSecretUI",initialState:{secret:null,errors:{},tab:"details",isUpdating:!1,historyDepth:0},reducers:{showModal:function(e,t){var r=t.payload,n=r.secret,s=r.tab;e.secret=n,e.tab=s||"details",e.errors={}},showSecretSuccess:function(e,t){var r=t.payload.secret;e.secret=r,e.errors={}},hideModal:function(e,t){e.secret=null,e.errors={},e.historyDepth=0},changeTab:function(e,t){var r=t.payload.tab;e.tab=r},updateSecretStart:function(e,t){e.isUpdating=!0,e.errors={}},historyShowOlder:function(e){e.historyDepth+1<e.secret.history.length&&(e.historyDepth+=1)},historyShowNewer:function(e){e.historyDepth-1>=0&&(e.historyDepth-=1)},updateSecretFailure:ar,createSecretUserRightsFailure:ar,updateSecretUserRightsFailure:ar,deleteSecretUserRightsFailure:ar},extraReducers:(Kt={},Object(ye.a)(Kt,zt,(function(e,t){var r=t.payload,n=r.metadata,s=r.history,a=n[e.secret.id];a.users=Object.values(a.users).map((function(e){return Ut.createFromRaw(e)})),e.secret=e.secret.merge(n[e.secret.id]),e.secret.history=s,e.isUpdating=!1,e.errors={}})),Object(ye.a)(Kt,_t,(function(e,t){var r=t.payload,n=r.user,s=r.rights;e.secret.users.push(n.merge({rights:s})),e.isUpdating=!1,e.errors={}})),Object(ye.a)(Kt,Jt,(function(e,t){var r=t.payload,n=r.rights,s=r.user;e.secret.users=e.secret.users.map((function(e){return e.id===s.id?e.merge({rights:n}):e})),e.isUpdating=!1,e.errors={}})),Object(ye.a)(Kt,Yt,(function(e,t){var r=t.payload.user;e.secret.users=e.secret.users.filter((function(e){return e.id!==r.id})),e.isUpdating=!1,e.errors={}})),Object(ye.a)(Kt,Y,sr),Kt)}),cr=ir.actions,or=cr.showModal,ur=cr.showSecretSuccess,dr=cr.hideModal,lr=cr.changeTab,hr=cr.updateSecretStart,pr=cr.updateSecretFailure,fr=cr.createSecretUserRightsFailure,br=cr.updateSecretUserRightsFailure,vr=cr.deleteSecretUserRightsFailure,mr=cr.historyShowOlder,gr=cr.historyShowNewer,yr=function(e){var t=e.secret,r=e.tab;return function(){var e=Object(ft.a)(vt.a.mark((function e(n){var s,a,i;return vt.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n(or({secret:t,tab:r})),"folder"!==t.type){e.next=5;break}n(ur({secret:t})),e.next=22;break;case 5:return e.next=7,P.getSecret(t.id);case 7:return s=e.sent,a=s.fields?s:{fields:s},(i=Pt.createFromRaw(t.getRaw())).data=Ot.createFromRaw(a).getRaw(),e.prev=11,e.next=14,P.getHistory(t.id);case 14:i.history=e.sent,e.next=21;break;case 17:e.prev=17,e.t0=e.catch(11),console.log(e.t0),i.history=[];case 21:n(ur({secret:i}));case 22:case"end":return e.stop()}}),e,null,[[11,17]])})));return function(t){return e.apply(this,arguments)}}()},jr=ir.reducer;function wr(){return{isEditing:!1,data:null}}var Or=Object(N.b)({name:"EditSecretUI",initialState:{isEditing:!1,data:null},reducers:{updateData:function(e,t){e.isEditing=!1,e.data=t.payload.data},changeField:function(e,t){var r=t.payload,n=r.field,s=r.value;e.isEditing=!0;var a=e.data.fields.findIndex((function(e){return e.id===n.id}));e.data.fields[a].content=s}},extraReducers:(Ft={},Object(ye.a)(Ft,ur,(function(e,t){e.isEditing=!1,e.data=t.payload.secret.data})),Object(ye.a)(Ft,dr,(function(e){e.isEditing=!1,e.data=null})),Object(ye.a)(Ft,zt,(function(e){e.isEditing=!1})),Object(ye.a)(Ft,Y,wr),Ft)}),Sr=Or.actions,xr=Sr.updateData,kr=Sr.changeField,Cr=Or.reducer,Ur=r(118),Ar=r.n(Ur),Pr=function(e){Object(v.a)(r,e);var t=Object(m.a)(r);function r(e){var n;return Object(p.a)(this,r),(n=t.call(this,e)).onCopy=n.onCopy.bind(Object(b.a)(n)),n.onGenerate=n.onGenerate.bind(Object(b.a)(n)),n.onGenerateAlphanum=n.onGenerateAlphanum.bind(Object(b.a)(n)),n.onGeneratePronounceable=n.onGeneratePronounceable.bind(Object(b.a)(n)),n.handleChange=n.handleChange.bind(Object(b.a)(n)),n}return Object(f.a)(r,[{key:"onCopy",value:function(){Ar()(this.props.field.content,{debug:!0})}},{key:"onGenerate",value:function(){this.handleChange({value:w.Utils.PasswordGenerator.generatePassword()})}},{key:"onGenerateAlphanum",value:function(){this.handleChange({value:w.Utils.PasswordGenerator.generatePassword({contentRules:{numbers:!0,mixedCase:!0,symbols:!1}})})}},{key:"onGeneratePronounceable",value:function(){this.handleChange({value:w.Utils.PasswordGenerator.generatePassword({readable:!0})})}},{key:"handleChange",value:function(e){var t=e.value,r={field:this.props.field,value:t};this.props.onChange(r)}},{key:"render",value:function(){var e=this,t=[];return this.props.isNew||"url"===this.props.field.type&&t.push(Object(je.jsx)("a",{href:this.props.field.content,target:"_blank",rel:"noopener noreferrer",tabIndex:"-1",children:Object(je.jsx)(fe.a,{id:"Open"})},"open")),t.push(Object(je.jsx)("a",{onClick:this.onCopy,tabIndex:"-1",children:Object(je.jsx)(fe.a,{id:"Copy"})},"copy")),Object(je.jsxs)("div",{className:"secret-field",children:[Object(je.jsx)(qe,{ref:function(t){e.input=t},label:this.props.intl.formatMessage({id:this.props.field.label}),name:this.props.field.label,value:this.props.field.content,onChange:this.handleChange,type:this.props.field.type,readOnly:!this.props.canUpdate,actions:t}),Object(je.jsx)("div",{className:"secret-field-action",children:"password"===this.props.field.type&&this.props.canUpdate&&Object(je.jsxs)(Ve,{id:"password-generation-options",pullRight:!0,children:[Object(je.jsx)(Ve.Toggle,{children:Object(je.jsx)(Se,{id:"generate",size:"small"})}),Object(je.jsxs)(Ve.Menu,{children:[Object(je.jsx)(Ve.MenuItem,{onSelect:this.onGenerate,children:Object(je.jsx)(fe.a,{id:"Generate strong"})}),Object(je.jsx)(Ve.MenuItem,{onSelect:this.onGenerateAlphanum,children:Object(je.jsx)(fe.a,{id:"Generate alphanumeric"})}),Object(je.jsx)(Ve.MenuItem,{onSelect:this.onGeneratePronounceable,children:Object(je.jsx)(fe.a,{id:"Generate pronounceable"})})]})]})})]})}}]),r}(u.Component),Nr=Object(pt.c)(Pr),Tr=function(e){Object(v.a)(r,e);var t=Object(m.a)(r);function r(){return Object(p.a)(this,r),t.apply(this,arguments)}return Object(f.a)(r,[{key:"render",value:function(){var e=this;return!!this.props.fields&&Object(je.jsx)("div",{className:"secret-fields",children:this.props.fields.map((function(t){return Object(je.jsx)(Nr,{field:t,onChange:e.props.onChange,isNew:e.props.isNew,canUpdate:e.props.canUpdate},t.id)}))})}}]),r}(u.Component),Dr=Tr,Kr=function(e){Object(v.a)(r,e);var t=Object(m.a)(r);function r(){return Object(p.a)(this,r),t.apply(this,arguments)}return Object(f.a)(r,[{key:"render",value:function(){return this.props.data?Object(je.jsx)("div",{className:"secret-edit",children:Object(je.jsx)(Dr,{fields:this.props.data.fields,onChange:this.props.canUpdate?this.props.actions.changeField:function(){},canUpdate:this.props.canUpdate})}):Object(je.jsx)("pre",{children:"Loading..."})}}]),r}(u.Component),Fr=Object(g.b)((function(e,t){return{data:t.data||e.EditSecretUI.data}}),(function(e){return{actions:Object(ht.bindActionCreators)(a,e)}}))(Kr),Ir=function(e){Object(v.a)(r,e);var t=Object(m.a)(r);function r(e){var n;return Object(p.a)(this,r),(n=t.call(this,e)).handleSubmit=function(){return n.props.onSubmit(n.state.title)},n.handleKeyDown=function(e){var t=e.key,r=e.target;"Enter"===t&&r.blur()},n.handleChange=function(e){var t=e.target;n.setState({title:t.value})},n.state={title:e.title},n}return Object(f.a)(r,[{key:"render",value:function(){var e=this.props,t=e.canUpdate,r=e.isUpdating,n=this.state.title;return Object(je.jsx)("input",{className:"secret-editable-title",type:"text",value:n,onBlur:this.handleSubmit,onKeyDown:this.handleKeyDown,onChange:this.handleChange,readOnly:!t||r,size:n.length+1})}}]),r}(u.Component),Er=function(e){var t=e.icon,r=e.title,n=e.canEditTitle,s=e.isUpdating,a=e.onEditTitle;return Object(je.jsxs)("div",{children:[Object(je.jsx)(Se,{id:t,size:"small"}),Object(je.jsx)(Ir,{title:r,canUpdate:n,isUpdating:s,onSubmit:function(e){e!==r&&a(e)}})]})},Rr=function(e){var t=e.side,r=e.disabled,n=e.onClick;return Object(je.jsx)("div",{className:"secret-history-button",children:Object(je.jsx)(Ue,{title:t,buttonStyle:"icon",disabled:r,onClick:n,children:Object(je.jsx)(Se,{id:t})})})},Mr=function(e){Object(v.a)(r,e);var t=Object(m.a)(r);function r(){return Object(p.a)(this,r),t.apply(this,arguments)}return Object(f.a)(r,[{key:"render",value:function(){var e=this.props,t=e.historyDepth,r=e.historyCount,n=e.modifiedAt,s=e.isLatest,a=e.isOldest,i=e.data,c=this.props.actions,o=c.historyShowOlder,u=c.historyShowNewer,d=s?"#1abc9c":"#afafaf";return Object(je.jsxs)("div",{className:"secret-history",children:[Object(je.jsxs)("div",{className:"secret-history-header",style:{backgroundColor:d,borderColor:d},children:[Object(je.jsxs)("div",{className:"secret-history-navigation",children:[Object(je.jsx)(Rr,{disabled:t>=r-1,side:"previous",onClick:o}),Object(je.jsx)(Rr,{disabled:t<=0,side:"next",onClick:u})]}),Object(je.jsxs)("span",{style:{color:"white",fontWeight:"600"},title:tt()(n).format("MMM Do, YYYY HH:mm"),children:[s&&Object(je.jsx)(fe.a,{id:"latest"}),a&&Object(je.jsx)(fe.a,{id:"oldest"})," ",tt()(n).fromNow()]})]}),Object(je.jsx)("div",{className:"secret-history-fields",children:Object(je.jsx)(Fr,{isUpdating:!1,canUpdate:!1,data:i})})]})}}]),r}(u.Component),Lr=Object(g.b)((function(e){var t,r,n=e.ShowSecretUI,s=n.secret,a=n.historyDepth;return{data:null===s||void 0===s||null===(t=s.history[a])||void 0===t?void 0:t.secret,modifiedAt:null===s||void 0===s||null===(r=s.history[a])||void 0===r?void 0:r.lastModifiedAt,historyCount:null===s||void 0===s?void 0:s.history.length,historyDepth:a,isLatest:0===a,isOldest:a+1>=(null===s||void 0===s?void 0:s.history.length)}}),(function(e){return{actions:Object(ht.bindActionCreators)(s,e)}}))(Mr),Br=function(e){Object(v.a)(r,e);var t=Object(m.a)(r);function r(){var e;Object(p.a)(this,r);for(var n=arguments.length,s=new Array(n),a=0;a<n;a++)s[a]=arguments[a];return(e=t.call.apply(t,[this].concat(s))).handleClick=function(){Ar()(e.select.getValue(),{debug:!0})},e}return Object(f.a)(r,[{key:"render",value:function(){var e=this;if(!this.props.data)return Object(je.jsx)("pre",{children:"Loading..."});var t=this.props.data.fields.reverse().map((function(e){return[e.content,tt()(e.date).format("dddd DD MMMM YYYY")]}));return Object(je.jsx)("div",{className:"secret-edit",children:Object(je.jsxs)("div",{className:"secret-field",children:[Object(je.jsx)(Me,{label:"Passwords",ref:function(t){e.select=t},options:t}),Object(je.jsx)(Ue,{onClick:this.handleClick,children:"Copy"})]})})}}]),r}(u.Component),Hr=Object(g.b)((function(e){return{data:e.EditSecretUI.data}}))(Br),_r=["emerland","nephritis","belize-hole","wisteria","midnight-blue","sun-flower","pumpkin","pomegranate","silver","asbestos"];function zr(e){var t=e.split(" ");return t.length>1?"".concat(t[0][0]).concat(t[1][0]).toUpperCase():e.substring(0,2).toUpperCase()}function Gr(e){var t=e.user,r=e.size,n=function(e){var t=e.split("").reduce((function(e,t){return e+t.charCodeAt()}),0);return _r[t%_r.length]}(t.username),s=ge()("user-avatar","user-avatar--color-".concat(n),"user-avatar--size-".concat(r));return Object(je.jsx)("div",{className:s,title:t.username,children:zr(t.username)})}Gr.defaultProps={size:"base"};var Jr=Gr;var Yr=function(e){var t=e.user,r=e.disabled,n=e.disabledReason,s=e.onChangeUserRights,a=e.onRemoveUserRights,i=e.intl;return Object(je.jsxs)("div",{className:"secret-users-list-item",children:[Object(je.jsxs)("div",{className:"secret-users-list-item-infos",children:[Object(je.jsx)(Jr,{user:t,size:"large"}),t.username]}),Object(je.jsxs)("div",{className:"secret-users-list-item-actions",children:[Object(je.jsx)(Me,{value:t.rights,options:St.map((function(e){return[e,i.formatMessage({id:xt(e)})]})),size:"small",disabled:r,title:n,onChange:function(e){var r=e.value;return s(t,r)}}),Object(je.jsx)(Ue,{buttonStyle:"icon",onClick:function(){return a(t)},disabled:r,title:n,size:"small",iconOnly:!0,children:Object(je.jsx)(Se,{id:"close"})})]})]})},Vr=function(e){Object(v.a)(r,e);var t=Object(m.a)(r);function r(e){var n;return Object(p.a)(this,r),(n=t.call(this,e)).handleChange=n.handleChange.bind(Object(b.a)(n)),n.handleSubmit=n.handleSubmit.bind(Object(b.a)(n)),n.state={user:new Ut},n}return Object(f.a)(r,[{key:"handleChange",value:function(e){var t=e.name,r=e.value;this.setState({user:this.state.user.merge(Object(ye.a)({},t,r))})}},{key:"handleSubmit",value:function(){var e=this,t=this.props.secret,r=this.state.user,n=[this.props.intl.formatMessage({id:"read access"}),this.props.intl.formatMessage({id:"read and write access"}),this.props.intl.formatMessage({id:"read, write and share access"})][r.rights],s=r.username,a=t.title;Ze({title:this.props.intl.formatMessage({id:"Are you sure?"}),text:Object(je.jsxs)("span",{children:[this.props.intl.formatMessage({id:"shareWarning"}),"\xa0",Object(je.jsx)("b",{children:n}),"\xa0",this.props.intl.formatMessage({id:"to"}),"\xa0",Object(je.jsx)("b",{children:s}),"\xa0",this.props.intl.formatMessage({id:"on"}),"\xa0",Object(je.jsx)("b",{children:a}),"."]}),acceptLabel:this.props.intl.formatMessage({id:"Share the secret"}),cancelLabel:this.props.intl.formatMessage({id:"Cancel"}),onAccept:function(){e.props.dispatch(Xt({secret:e.props.secret,user:e.state.user,rights:e.state.user.rights})),e.setState({user:new Ut})},onCancel:function(){return{}}})}},{key:"render",value:function(){var e=this;return Object(je.jsxs)("div",{className:"secret-users-list-new",children:[Object(je.jsx)(qe,{name:"username",placeholder:"".concat(this.props.intl.formatMessage({id:"login"}),"..."),value:this.state.user.username,size:"small",onChange:this.handleChange,autoCompleteFromList:this.props.knownFriendList,error:this.props.errors.username}),Object(je.jsx)(Me,{name:"rights",value:this.state.user.rights,size:"small",onChange:this.handleChange,options:St.map((function(t){return[t,e.props.intl.formatMessage({id:xt(t)})]}))}),Object(je.jsx)(Ue,{buttonStyle:"icon",onClick:this.handleSubmit,disabled:!this.state.user.isValid(),size:"small",iconOnly:!0,children:Object(je.jsx)(Se,{id:"add"})})]})}}]),r}(u.Component),Wr=Object(g.b)((function(e){return{knownFriendList:e.Metadata.knownFriendList}}))(Object(pt.c)(Vr));var qr=function(e){Object(v.a)(r,e);var t=Object(m.a)(r);function r(e){var n;return Object(p.a)(this,r),(n=t.call(this,e)).onChangeUserRights=n.onChangeUserRights.bind(Object(b.a)(n)),n.onRemoveUserRights=n.onRemoveUserRights.bind(Object(b.a)(n)),n}return Object(f.a)(r,[{key:"onChangeUserRights",value:function(e,t){this.props.dispatch(Zt({secret:this.props.secret,user:e,rights:t}))}},{key:"onRemoveUserRights",value:function(e){this.props.dispatch(er({secret:this.props.secret,user:e}))}},{key:"render",value:function(){var e=this,t=this.props.currentUser,r=this.props.secret.canBeSharedBy(t)&&this.props.isOnline;return Object(je.jsxs)("div",{className:"secret-users",children:[Object(je.jsx)("div",{className:"secret-users-list",children:this.props.secret.users.map((function(n){return Object(je.jsx)(Yr,{user:n,disabled:!r||t.username===n.id||e.props.isUpdating,disabledReason:(s=!r,a=t.username===n.id,i=e.props.intl,s?i.formatMessage({id:"You don't have the permission to share this secret"}):a?i.formatMessage({id:"You can't modify or remove yourself"}):null),onChangeUserRights:e.onChangeUserRights,onRemoveUserRights:e.onRemoveUserRights,intl:e.props.intl},n.id);var s,a,i}))}),r&&Object(je.jsx)(Wr,{secret:this.props.secret,errors:this.props.errors})]})}}]),r}(u.Component),Qr=Object(g.b)((function(e){var t=e.AppUI;return{currentUser:t.currentUser,isOnline:t.online}}))(Object(pt.c)(qr));function $r(e){var t=e.type,r=e.children,n=ge()("flash","flash--type-".concat(t));return Object(je.jsxs)("div",{className:n,children:[Object(je.jsx)("div",{className:"flash-icon",children:Object(je.jsx)(Se,{id:t,size:"small"})}),Object(je.jsx)("div",{className:"flash-content",children:r})]})}$r.defaultProps={type:"info"};var Xr=$r,Zr=r(231),en=r.n(Zr),tn=r(232),rn=function(e){return Object(je.jsx)(en.a,Object(j.a)(Object(j.a)({className:"tabs",animation:!1},e),{},{children:e.children}))},nn=r.n(tn).a;r.p,r.p;var sn,an=function(e){Object(v.a)(r,e);var t=Object(m.a)(r);function r(e){var n;return Object(p.a)(this,r),(n=t.call(this,e)).handleChangeTab=n.handleChangeTab.bind(Object(b.a)(n)),n.handleClick=n.handleClick.bind(Object(b.a)(n)),n}return Object(f.a)(r,[{key:"handleChangeTab",value:function(e){this.props.showSecretActions.changeTab({tab:e})}},{key:"handleClick",value:function(){this.props.metadataActions.updateSecret({secret:this.props.secret,data:this.props.data})}},{key:"render",value:function(){var e,t,r=this;if(!this.props.secret)return!1;var n=this.props.currentUser.username,s=this.props.secret.users.filter((function(e){return e.id!==n})),a=this.props.secret.canBeUpdatedBy(this.props.currentUser)&&(this.props.isOnline||0===s.length);return Object(je.jsxs)(ke,{show:this.props.shown,closeOnBackdropClick:!this.props.isEditing,onClose:this.props.showSecretActions.hideModal,children:[Object(je.jsx)(ke.Header,{children:Object(je.jsx)(Er,{icon:this.props.secret.getIcon(),title:this.props.secret.title,canEditTitle:a,isUpdating:this.props.isUpdating,onEditTitle:function(e){setTimeout((function(){r.props.metadataActions.renameSecret({secret:r.props.secret,newTitle:e})}))}})}),Object(je.jsx)(ke.Body,{children:Object(je.jsxs)(je.Fragment,{children:["windows"===this.props.secret.type&&Object(je.jsx)(Xr,{type:"info",children:"This secret is used for your Windows domain authentication. It cannot be deleted."}),Object(je.jsxs)(rn,{id:"secret-tabs",activeKey:this.props.tab,onSelect:this.handleChangeTab,children:["folder"!==this.props.secret.type&&Object(je.jsx)(nn,{eventKey:"details",title:this.props.intl.formatMessage({id:"Details"}),children:"windows"===this.props.secret.type?Object(je.jsx)(Hr,{isUpdating:this.props.isUpdating}):Object(je.jsx)(Fr,{isUpdating:this.props.isUpdating,canUpdate:a,data:this.props.secret.fields})}),"windows"!==this.props.secret.type&&Object(je.jsx)(nn,{eventKey:"access",title:this.props.intl.formatMessage({id:"Who has access"}),children:Object(je.jsx)(Qr,{isUpdating:this.props.isUpdating,errors:this.props.errors,secret:this.props.secret})}),(null===(e=this.props.secret)||void 0===e||null===(t=e.history)||void 0===t?void 0:t.length)>1&&Object(je.jsx)(nn,{eventKey:"history",title:this.props.intl.formatMessage({id:"History"}),children:Object(je.jsx)(Lr,{})})]})]})}),Object(je.jsxs)(ke.Footer,{children:[Object(je.jsx)(Ue,{type:"reset",buttonStyle:"default",onClick:this.props.showSecretActions.hideModal,disabled:this.props.isUpdating,children:Object(je.jsx)(fe.a,{id:this.props.isEditing?"Cancel":"Close"})}),this.props.isEditing&&Object(je.jsx)(Ue,{type:"submit",buttonStyle:"primary",onClick:this.handleClick,disabled:this.props.isUpdating,children:Object(je.jsx)(fe.a,{id:"Save"})})]})]})}}]),r}(u.Component),cn=Object(g.b)((function(e){var t=e.ShowSecretUI,r=t.secret,n=t.errors,s=t.tab,a=t.isUpdating,i=e.EditSecretUI,c=i.isEditing,o=i.data,u=e.AppUI;return{secret:r,shown:!!r,errors:n,tab:s,isUpdating:a,isEditing:c,data:o,currentUser:u.currentUser,isOnline:u.online}}),(function(e){return{showSecretActions:Object(ht.bindActionCreators)(s,e),metadataActions:Object(ht.bindActionCreators)(n,e)}}))(Object(pt.c)(an)),on=r(114),un=r(233),dn=r.n(un),ln=r(92),hn=r.n(ln),pn=r(53),fn=r(59),bn=r(165),vn=r(27),mn=r(488),gn=(r(478),function(){return localStorage.getItem("defaultLanguage")||Ke()}),yn=function(){return tt.a.locale(gn())};yn();var jn,wn=Object(vn.c)(),On=Object(mn.a)({locale:gn(),messages:De(gn())},wn),Sn=function(){return{shown:!1,folder:null,isFolder:!1,title:"",data:Ot.createWithDefaultFields(Ot.DEFAULT_FIELDS).getRaw()}},xn=Object(N.b)({name:"NewSecretUI",initialState:Sn(),reducers:{showModal:function(e,t){var r,n,s=t.payload,a=s.folder,i=s.isFolder;e.shown=!0,e.title=On.formatMessage({id:"Untitled ".concat(i?"folder":"secret")}),e.folder=a,e.isFolder=i;var c=e.data.fields.findIndex((function(e){return"login"===e.label})),o=e.data.fields.findIndex((function(e){return"password"===e.label}));e.data.fields[c].content=null!==(r=null===(n=P.currentUser.options)||void 0===n?void 0:n.defaultUsername)&&void 0!==r?r:"",e.data.fields[o].content=w.Utils.PasswordGenerator.generatePassword()},hideModal:function(){return Sn()},changeTitle:function(e,t){var r=t.payload.value;e.title=r},changeField:function(e,t){var r=t.payload,n=r.field,s=r.value,a=e.data.fields.findIndex((function(e){return e.id===n.id}));e.data.fields[a].content=s}},extraReducers:(sn={},Object(ye.a)(sn,G,Sn),Object(ye.a)(sn,Y,Sn),sn)}),kn=xn.actions,Cn=kn.showModal,Un=kn.hideModal,An=kn.changeTitle,Pn=kn.changeField,Nn=xn.reducer,Tn=function(){return{options:{},errors:{},showQRCode:!1,showShortLogin:!1,showRescueCodes:!1,newPass:{shown:!1,newPass1:"",newPass2:"",error:"",loading:!1,status:"initial"},rescueCodes:[],loading:!1}},Dn=Object(N.b)({name:"Options",initialState:{options:{},errors:{},showQRCode:!1,showShortLogin:!1,showRescueCodes:!1,newPass:{shown:!1,newPass1:"",newPass2:"",error:"",loading:!1,status:"initial"},rescueCodes:[],loading:!1},reducers:{_activateTotp:function(e,t){e.loading=!0},_activateShortLogin:function(e,t){e.loading=!0},_toggleTotp:function(e,t){var r=t.payload.checked;e.showQRCode=r},_toggleShortLogin:function(e,t){var r=t.payload.checked;e.showShortLogin=r},activateTotpFailure:function(e,t){var r=t.payload.error;e.errors.totp=r,e.loading=!1},hideQRCode:function(e,t){e.showQRCode=!1,e.loading=!1,e.errors={}},hideShortLogin:function(e,t){e.showShortLogin=!1,e.loading=!1,e.errors={}},activateTotpSuccess:function(e,t){e.showQRCode=!1,e.loading=!1,e.errors={},e.options.totp=!0},deactivateTotpSuccess:function(e,t){e.options.totp=!1},deactivateShortLoginSuccess:function(e,t){var r=t.payload.shortLogin;e.options.shortLogin=r},activateShortLoginSuccess:function(e,t){var r=t.payload.shortLogin;e.showShortLogin=!1,e.loading=!1,e.errors={},e.options.shortLogin=r},changeDelaySuccess:function(e,t){var r=t.payload.timeToClose;e.options.timeToClose=r},changeDefaultUsernameSuccess:function(e,t){var r=t.payload.defaultUsername;e.options.defaultUsername=r},changeNewPass1:function(e,t){var r=t.payload;e.newPass.newPass1=r.value},changeNewPass2:function(e,t){var r=t.payload;e.newPass.newPass2=r.value},showChangePassword:function(e,t){e.newPass.newPass1="",e.newPass.newPass2="",e.newPass.error="",e.newPass.loading=!1,e.newPass.shown=!0},hideChangePassword:function(e,t){e.newPass.newPass1="",e.newPass.newPass2="",e.newPass.error="",e.newPass.loading=!1,e.newPass.shown=!1},_changePassword:function(e,t){e.newPass.loading=!0,e.newPass.error=""},changePasswordSuccess:function(e,t){e.newPass.newPass1="",e.newPass.newPass2="",e.newPass.error="",e.newPass.loading=!1,e.newPass.status="success"},changePasswordFailure:function(e,t){e.newPass.error="Password change failed",e.newPass.loading=!1,e.newPass.status="failure"},showRescueCodesSuccess:function(e,t){var r=t.payload.rescueCodes;e.rescueCodes=r,e.showRescueCodes=!0},hideRescueCodes:function(e,t){e.rescueCodes=[],e.showRescueCodes=!1}},extraReducers:(jn={},Object(ye.a)(jn,X,(function(e,t){var r=t.payload.options;e.options=r})),Object(ye.a)(jn,W,Tn),Object(ye.a)(jn,Y,Tn),jn)}),Kn=Dn.actions,Fn=Kn._activateTotp,In=Kn._activateShortLogin,En=Kn._toggleTotp,Rn=Kn._toggleShortLogin,Mn=Kn.activateTotpFailure,Ln=Kn.activateTotpSuccess,Bn=Kn.hideQRCode,Hn=Kn.hideShortLogin,_n=Kn.deactivateTotpSuccess,zn=Kn.deactivateShortLoginSuccess,Gn=Kn.activateShortLoginSuccess,Jn=Kn.changeDelaySuccess,Yn=Kn.changeDefaultUsernameSuccess,Vn=Kn.changeNewPass1,Wn=Kn.changeNewPass2,qn=Kn.showChangePassword,Qn=Kn.hideChangePassword,$n=Kn._changePassword,Xn=Kn.changePasswordSuccess,Zn=Kn.changePasswordFailure,es=Kn.showRescueCodesSuccess,ts=Kn.hideRescueCodes,rs=function(){return function(e,t){return P.deactivateTotp().then((function(){return e(_n())})).catch((function(){}))}},ns=function(e){var t=e.seed,r=e.token;return function(e,n){return e(Fn()),P.api.testTotp(t.b32,r).then((function(){return P.activateTotp(t)})).then((function(){return e(Ln())})).catch((function(t){e(Mn("Invalid couple"===t?{error:"Synchronisation error"}:{error:"An error occured"}))}))}},ss=function(e){var t=e.shortpass;return function(e,r){return e(In()),P.activateShortLogin(t,gt.a.v4()).then((function(){return e(Gn({shortLogin:P.canITryShortLogin()}))})).catch((function(){}))}},as=function(){return function(e,t){P.deactivateShortLogin().then((function(){return e(zn({shortLogin:P.canITryShortLogin()}))})).catch((function(){}))}},is=function(e){var t=e.newPass;return function(e,r){e($n()),P.changePassword(t).then((function(){e(Xn())})).catch((function(){e(Zn())}))}},cs=function(e){var t=e.checked;return function(e,r){return e(En({checked:t})),!!t||e(rs())}},os=function(){return function(e,t){window.confirm("Be careful, this will replace your previously generated codes. Continue?")&&P.getRescueCodes().then((function(t){e(es({rescueCodes:t}))}))}},us=function(e){var t=e.checked;return function(e,r){return e(Rn({checked:t})),!!t||e(as())}},ds=function(e){var t=e.checked;return function(e,r){return e(hs({timeToClose:t?30:0}))}},ls=function(e){var t=e.defaultUsername;return function(e,r){return P.editOption("defaultUsername",t).then((function(){e(Yn({defaultUsername:t}))})).catch((function(){})),!0}},hs=function(e){var t=e.timeToClose;return function(e,r){return P.editOption("timeToClose",t).then((function(){e(Jn({timeToClose:t}))})).catch((function(){})),!0}},ps=Dn.reducer,fs=function(){function e(t,r){Object(p.a)(this,e),this.func=t,this.total=r,this.status=0}return Object(f.a)(e,[{key:"update",value:function(){this.status+=1,this.func({state:this.status,total:this.total})}}]),e}();function bs(e,t){for(var r="",n={type:"default",fields:[{id:gt.a.v4(),type:"text",label:"login",content:""},{id:gt.a.v4(),type:"password",label:"password",content:""},{id:gt.a.v4(),type:"url",label:"url",content:""}]},s=e.querySelectorAll(":scope > String"),a=0;a<s.length;a+=1){var i=s[a].children[0].textContent,c=s[a].children[1].textContent;"title"===i.toLowerCase()?r=c:"password"===i.toLowerCase()?n.fields[1].content=c:"url"===i.toLowerCase()?n.fields[2].content=c:"username"===i.toLowerCase()?n.fields[0].content=c:Object(Ee.isEmpty)(c)||n.fields.push({id:gt.a.v4(),type:"text",label:i,content:c})}var o="";return P.addSecret(r,n).then((function(e){return o=e,"undefined"!==typeof t?P.addSecretToFolder(o,t):Promise.resolve()}))}function vs(e,t){console.log("".concat(e,"/").concat(t))}function ms(e,t,r){var n;"undefined"===typeof r?n=[].slice.call(e.querySelectorAll(":scope > Entry")).reduce((function(e,n){return e.then((function(){return bs(n,r).then((function(){t.update()}))}))}),Promise.resolve()):n=Promise.resolve();return n.then((function(){return[].slice.call(e.querySelectorAll(":scope > Group")).reduce((function(e,n){return e.then((function(){return function(e,t,r){var n="",s=e.getElementsByTagName("Name")[0].textContent;return P.addFolder(s).then((function(r){return n=r,[].slice.call(e.querySelectorAll(":scope > Entry")).reduce((function(e,r){return e.then((function(){return bs(r,n).then((function(){t.update()}))}))}),Promise.resolve())})).then((function(){return"undefined"!==typeof r?P.addSecretToFolder(n,r):Promise.resolve()})).then((function(){return ms(e,t,n)}))}(n,t,r)}))}),Promise.resolve())}))}function gs(e){for(var t=e.querySelectorAll(":scope > Entry").length,r=e.querySelectorAll(":scope > Group"),n=0;n<r.length;n+=1)t+=gs(r[n]);return t}var ys={parse:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:vs,n=new DOMParser,s=n.parseFromString(e,"application/xml"),a=s.getElementsByTagName("Root")[0].children[0],i=new fs(r,gs(a));return ms(a,i)},detect:function(e){var t=new DOMParser,r=!1;try{r=1===t.parseFromString(e,"application/xml").getElementsByTagName("KeePassFile").length}catch(n){r=!1}return r},mandatoryFields:{}};function js(e,t){console.log("".concat(e,"/").concat(t))}var ws={parse:function(e,t){t.username;var r=t.password,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:js;return P.importDb(r.value,e,n)},detect:function(e){var t=!1;try{var r=JSON.parse(e);t="users"in r&&"secrets"in r}catch(n){t=!1}return t},mandatoryFields:{password:{type:"password",name:"password",value:""}}},Os={keepass:ys,secretin:ws},Ss=void 0,xs=function(){return{importType:"",importing:!1,importStatus:0,importTotal:0,success:!1,file:"",error:"",mandatoryFields:{}}},ks=Object(N.b)({name:"Import",initialState:{importType:"",importing:!1,importStatus:0,importTotal:0,success:!1,file:"",error:"",mandatoryFields:{}},reducers:{showModal:function(e,t){var r=t.payload,n=r.secret,s=r.tab;Ss.state.secret=n,Ss.state.tab=s||"details",Ss.state.errors={}},_importSecrets:function(e,t){e.importing=!0,e.success=!1,e.error=""},detectTypeFailure:function(e,t){var r=t.payload.error;e.error=r,e.importType="",e.mandatoryFields={}},detectTypeSuccess:function(e,t){var r=t.payload,n=r.file,s=r.importType,a=r.mandatoryFields;e.importType=s,e.error="",e.file=n,e.mandatoryFields=a},importSecretsProgress:function(e,t){var r=t.payload,n=r.importStatus,s=r.importTotal;e.error="",e.importStatus=n,e.importTotal=s},importSecretsSuccess:function(e,t){e.importing=!1,e.success=!0,e.importType="",e.error="",e.importStatus=0,e.importTotal=0,e.mandatoryFields={}},importSecretsFailure:function(e,t){var r=t.payload.error;e.importing=!1,e.success=!1,e.importType="",e.error=r,e.mandatoryFields={}},defaultStore:function(e,t){({importType:"",importing:!1,importStatus:0,importTotal:0,success:!1,file:"",error:"",mandatoryFields:{}})},changeMandatoryField:function(e,t){var r=t.payload,n=r.field,s=r.value;e.mandatoryFields[n.name].value=s}},extraReducers:Object(ye.a)({},Y,xs)}),Cs=ks.actions,Us=Cs.showModal,As=Cs._importSecrets,Ps=Cs.detectTypeFailure,Ns=Cs.detectTypeSuccess,Ts=Cs.importSecretsProgress,Ds=Cs.importSecretsSuccess,Ks=Cs.importSecretsFailure,Fs=Cs.defaultStore,Is=Cs.changeMandatoryField,Es=function(e){var t=e.file;return function(e,r){var n=new FileReader;return n.readAsText(t),n.onload=function(t){var r=t.target.result,n=Object(Ee.findKey)(Os,(function(e){return e.detect(r)}));if("undefined"!==typeof n){var s=Os[n].mandatoryFields;e(Ns({file:r,importType:n,mandatoryFields:s}))}else e(Ps({error:"Invalid type"}))},n}},Rs=function(e){var t=e.file,r=e.type,n=e.mandatoryFields;return function(e,s){e(As()),Os[r].parse(t,n,(function(t){var r=t.state,n=t.total;return e(Ts({importStatus:r,importTotal:n}))})).then((function(){e(Ds())})).catch((function(t){e(Ks({error:t}))}))}},Ms=ks.reducer,Ls=Object(N.a)({reducer:{AppUI:ie,EditSecretUI:Cr,Metadata:nr,NewSecretUI:Nn,ShowSecretUI:jr,Options:ps,Import:Ms},middleware:function(e){return e({serializableCheck:{ignoredActions:["AppUI/onLoginUserProgress","AppUI/loginUserSuccess","Metadata/addSecretToFolderSuccess"],ignoredPaths:["AppUI.currentUser","Metadata.metadata"]}})}}),Bs=r(235),Hs=r.n(Bs);function _s(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"/secrets";return Hs()(t,e.join("/"),"/")}function zs(e){var t=e.users,r=e.size,n=ge()("user-avatars","user-avatars--size-".concat(r));return Object(je.jsx)("div",{className:n,children:t.map((function(e){return Object(je.jsx)(Jr,{user:e,size:r},e.id)}))})}zs.defaultProps={size:"base"};var Gs=zs,Js=function(e){Object(v.a)(r,e);var t=Object(m.a)(r);function r(){var e;Object(p.a)(this,r);for(var n=arguments.length,s=new Array(n),a=0;a<n;a++)s[a]=arguments[a];return(e=t.call.apply(t,[this].concat(s))).handleShow=function(){var t=e.props.secret;e.props.dispatch(yr({secret:t,tab:"folder"===t.type?"access":"details"}))},e.handleShare=function(){var t=e.props.secret;e.props.dispatch(yr({secret:t,tab:"access"}))},e.handleMoveToParent=function(){var t=e.props,r=t.parentFolderId,n=t.secret;e.props.dispatch(rr({secret:n,currentFolderId:r}))},e.handleDelete=function(){var t=e.props.secret;return Ze({title:Object(je.jsxs)("span",{children:["Delete ",Object(je.jsx)("b",{children:t.title}),"?"]}),text:Object(je.jsxs)("span",{children:["You are about to ",Object(je.jsx)("b",{children:"delete"})," the secret ",Object(je.jsx)("b",{children:t.title}),". This action is definitive and can't be recovered."]}),acceptLabel:"Delete the secret",cancelLabel:"Cancel",onAccept:function(){return e.props.dispatch($t({secret:t}))},onCancel:function(){return{}}}),!0},e}return Object(f.a)(r,[{key:"render",value:function(){var e=this.props,t=e.parentFolderId,r=e.secret,n=e.currentUser,s=e.folder,a=r.canBeSharedBy(n);return a||"folder"!==r.type?Object(je.jsxs)(Ve,{id:"secret-action",pullRight:!0,children:[Object(je.jsx)(Ve.Toggle,{children:Object(je.jsx)(Se,{id:"more-vert",size:"small"})}),Object(je.jsxs)(Ve.Menu,{children:["folder"!==r.type&&Object(je.jsx)(Ve.MenuItem,{onSelect:this.handleShow,children:"Show"}),a&&Object(je.jsx)(Ve.MenuItem,{onSelect:this.handleShare,disabled:!this.props.isOnline,children:"Share"}),(t||r.canBeDeleted())&&Object(je.jsxs)("div",{children:[Object(je.jsx)(Ve.MenuItem,{divider:!0}),t&&Object(je.jsxs)(Ve.MenuItem,{onSelect:this.handleMoveToParent,children:["Remove from\xa0",Object(je.jsx)("b",{children:s.title})]}),r.canBeDeleted()&&Object(je.jsx)(Ve.MenuItem,{onSelect:this.handleDelete,disabled:!this.props.isOnline,children:"Delete"})]})]})]}):null}}]),r}(u.Component),Ys=Object(g.b)((function(e,t){var r=e.AppUI;return{isOnline:r.online,currentUser:r.currentUser,folder:e.Metadata.metadata.find((function(e){return e.id===t.parentFolderId}))}}))(Js);var Vs={drop:function(e,t){var r=e.secret,n=t.getItem().secret;Ls.dispatch(tr({secret:n,folder:r}))},canDrop:function(e,t){var r=e.secret,n=Ls.getState().AppUI.currentUser.username,s=t.getItem().secret;return 0!==s.users.find((function(e){return e.id===n})).rights&&"folder"===r.type&&r.id!==s.id&&0!==r.users.find((function(e){return e.id===n})).rights}};var Ws=new pn.DragSource("SecretListItem",{beginDrag:function(e){return{secret:e.secret}}},(function(e,t){return{connectDragSource:e.dragSource(),isDragging:t.isDragging()}}))((function(e){var t=e.secret,r=e.folders,n=e.isDragging,s=e.canDrop,a=e.isOver,i=e.connectDragSource,c=e.connectDropTarget,o=Object(g.d)((function(e){return e.AppUI.currentUser})),u=Object(g.d)((function(e){return e.AppUI.online})),d=t.users.find((function(e){return e.id===o.username})).rights,l=t.users.filter((function(e){return e.id!==o.username})),h=ge()("secret-list-item",{"secret-list-item--is-dragging":n,"secret-list-item--is-over":a,"secret-list-item--can-drop":s,"secret-list-item--cant-drop":!s}),p=Object(je.jsx)("div",{children:Object(je.jsxs)(y.b,{to:_s([].concat(Object(fn.a)(r),[t.id])),children:[Object(je.jsx)(Se,{id:t.getIcon(),size:"base"}),Object(je.jsx)("span",{className:"text",title:t.title,children:t.title})]})});return c(Object(je.jsxs)("div",{className:h,children:[Object(je.jsx)("div",{className:"secret-list-item-column secret-list-item-column--title",children:d>0&&(u||0===l.length)?i(p):p}),Object(je.jsxs)("div",{className:"secret-list-item-column secret-list-item-column--last-modified",children:[t.lastModifiedAt.fromNow()," - ",Object(je.jsx)("span",{className:"muted",children:t.lastModifiedBy})]}),Object(je.jsx)("div",{className:"secret-list-item-column secret-list-item-column--shared-with",children:l.length>0?Object(je.jsx)(Gs,{users:l}):"\u2013\u2013"}),Object(je.jsx)("div",{className:"secret-list-item-column secret-list-item-column--actions",children:Object(je.jsx)(Ys,{parentFolderId:r[r.length-1],secret:t})})]}))})),qs=new pn.DropTarget("SecretListItem",Vs,(function(e,t){return{connectDropTarget:e.dropTarget(),canDrop:t.canDrop(),isOver:t.isOver()}}))(Ws);var Qs=new pn.DragSource("SecretListItem",{beginDrag:function(e){return{secret:e.secret}}},(function(e,t){return{connectDragSource:e.dragSource(),isDragging:t.isDragging()}}))((function(e){var t,r=e.secret,n=e.parentFolderId,s=e.isDragging,a=e.connectDragSource,i=Object(g.d)((function(e){return e.AppUI.currentUser})),c=Object(g.d)((function(e){return e.AppUI.online})),o=Object(g.c)(),u=r.users.filter((function(e){return e.id!==i.username})),d=(null===(t=r.users.find((function(e){return e.id===i.username})))||void 0===t?void 0:t.rights)||0,l=ge()("secret-list-item",{"secret-list-item--is-dragging":s}),h=Object(je.jsx)("div",{children:Object(je.jsxs)("a",{onClick:function(){return o(yr({secret:r}))},tabIndex:"-1",children:[Object(je.jsx)(Se,{id:r.getIcon(),size:"base"}),Object(je.jsx)("span",{className:"text",title:r.title,children:r.title})]})});return Object(je.jsxs)("div",{className:l,children:[Object(je.jsx)("div",{className:"secret-list-item-column secret-list-item-column--title",children:d>0&&(c||0===u.length)?a(h):h}),Object(je.jsxs)("div",{className:"secret-list-item-column secret-list-item-column--last-modified",children:[r.lastModifiedAt.fromNow()," - ",Object(je.jsx)("span",{className:"muted",children:r.lastModifiedBy})]}),Object(je.jsx)("div",{className:"secret-list-item-column secret-list-item-column--shared-with",children:u.length>0?Object(je.jsx)(Gs,{users:u}):"\u2013\u2013"}),Object(je.jsx)("div",{className:"secret-list-item-column secret-list-item-column--actions",children:Object(je.jsx)(Ys,{parentFolderId:n,secret:r})})]})}));var $s=function(e){var t=e.secret,r=e.folders;return"folder"===t.type?Object(je.jsx)(qs,{secret:t,folders:r}):Object(je.jsx)(Qs,{parentFolderId:r[r.length-1],secret:t})};function Xs(e){var t=e.icon,r=e.title,n=e.link;return Object(je.jsx)("div",{className:"breadcrumb-item",children:Object(je.jsxs)(y.c,{to:n,className:"breadcrumb-link",activeClassName:"breadcrumb-link--active",exact:!0,children:[Object(je.jsx)(Se,{id:t,size:"base"}),r]})})}Xs.defaultProps={icon:"home",title:"Home",link:"/secrets/"};var Zs=Xs;function ea(e){var t=e.folders,r=e.withTitle,n=Object(g.d)((function(e){return e.AppUI.currentUser})),s=Object(g.d)((function(e){return e.Metadata.metadata})),a=t.reduce((function(e,t){return[].concat(Object(fn.a)(e),[{folderId:t,link:_s([t],e[e.length-1]?e[e.length-1].link:void 0)}])}),[]).reduce((function(e,t,r){var n=t.folderId,a=t.link,i=null===s||void 0===s?void 0:s.find((function(e){return e.id===n}));return i?[].concat(Object(fn.a)(e),[Object(je.jsx)("div",{className:"breadcrumb-item",children:Object(je.jsx)(y.c,{to:a,className:"breadcrumb-link",activeClassName:"breadcrumb-link--active",exact:!0,children:i.title})},r),Object(je.jsx)(Se,{id:"chevron-right",className:"breadcrumb-item-separator"},"".concat(r,"-sep"))]):e}),[]);return r&&(a.unshift(Object(je.jsx)(Se,{id:"chevron-right",className:"breadcrumb-item-separator"},"home-sep")),a.unshift(Object(je.jsx)(Zs,{title:n.username,icon:"home",link:"/secrets/"},"home"))),Object(je.jsx)("div",{className:"breadcrumb",children:a})}ea.defaultProps={folders:[],withTitle:!0};var ta=ea;var ra=function(e){var t=e.folder;return t.root?null:Object(je.jsx)("div",{className:"secret-list-folder",children:Object(je.jsx)("div",{colSpan:"4",className:"secret-list-folder-info",children:Object(je.jsx)(ta,{folders:t.breadcrumb,withTitle:!1})})})},na=function(e){Object(v.a)(r,e);var t=Object(m.a)(r);function r(){return Object(p.a)(this,r),t.apply(this,arguments)}return Object(f.a)(r,[{key:"render",value:function(){var e=this,t=this.props,r=t.allFolders,n=t.currentUser,s=ge()("secret-list-content-table",{"secret-list-content-table--is-dragging":this.props.isDragging}),a=new RegExp(this.props.searchQuery.split("").map((function(e){return Object(Ee.escapeRegExp)(e)})).join(".*"),"i"),i=this.props.secrets.filter((function(e){return a.test(e.title)})),c={},o=[],u=function(e,t){return e.find((function(e){return e.id===t}))};if(this.props.filtered){i.forEach((function(e){var t="ROOT",s=u(e.users,n.username);s&&(t=Object.keys(s.folders)[0]),"undefined"===typeof t&&(t="ROOT"),Object(Ee.set)(c,"".concat(t,".secrets.").concat(e.id),e),"ROOT"===t?(c[t].name="",c[t].root=!0):function(){for(var e=!1,s=[],a=[],i=t;!e;){var o=r.find((function(e){return e.id===i}));a.unshift(o.title),e=Object.keys(u(o.users,n.username).folders).includes("ROOT"),s.unshift(i),i=Object.keys(u(o.users,n.username).folders)[0]}c[t].name=a.join("/"),c[t].breadcrumb=s}()}));var d=Object.entries(c).map((function(e){var t=Object(he.a)(e,2),r=t[0],n=t[1];return Object(j.a)(Object(j.a)({},n),{},{id:r})}));d.sort((function(e,t){return e.name.toLowerCase().localeCompare(t.name.toLowerCase())})),d.sort((function(e,t){return e.root})),o=d.map((function(e){var t=Object.values(e.secrets);return t.sort((function(e,t){return null===e.title?1:null===t.title?-1:e.title.toLowerCase().localeCompare(t.title.toLowerCase())})),[{rowType:"header",rowData:e}].concat(Object(fn.a)(t.map((function(e){return{rowType:"row",rowData:e}}))))})).flat()}else i.sort((function(e,t){return null===e.title?1:null===t.title?-1:e.title.toLowerCase().localeCompare(t.title.toLowerCase())}));var l=function(e){var t=e.index,r=e.key,n=e.style,s=o[t],a=s.rowType,i=s.rowData;return"header"===a?Object(je.jsx)("div",{style:n,children:Object(je.jsx)(ra,{folder:i},i.id)},r):Object(je.jsx)("div",{style:n,children:Object(je.jsx)(Qs,{secret:i},i.id)},r)},h=function(t){var r=t.index,n=t.key,s=t.style,a=i[r];return Object(je.jsx)("div",{style:s,children:Object(je.jsx)($s,{secret:a,folders:e.props.folders},a.id)},n)},p=function(t){var r=t.index;return e.props.filtered&&"header"===o[r].rowType?o[r].rowData.root?0:75:50};return Object(je.jsx)("div",{className:s,children:Object(je.jsx)(bn.a,{children:function(t){var r=t.width,n=t.height;return Object(je.jsx)(bn.b,{width:r,height:n,rowHeight:p,rowRenderer:e.props.filtered?l:h,rowCount:e.props.filtered?o.length:i.length})}})})}}]),r}(u.Component),sa=Object(g.b)((function(e){return{currentUser:e.AppUI.currentUser,allFolders:Object.values(e.Metadata.metadata).filter((function(e){return"folder"===e.type}))||[]}}))(na);var aa=function(){var e=Object(g.c)();return Object(je.jsx)("div",{className:"secret-list-refresh",children:Object(je.jsx)(Ue,{title:"Refresh secret list",buttonStyle:"icon",onClick:function(){return e(Vt())},children:Object(je.jsx)(Se,{id:"refresh"})})})},ia=function(e){Object(v.a)(r,e);var t=Object(m.a)(r);function r(e){var n;return Object(p.a)(this,r),(n=t.call(this,e)).onSubmit=n.onSubmit.bind(Object(b.a)(n)),n}return Object(f.a)(r,[{key:"onSubmit",value:function(){var e=this.props,t=e.folder,r=e.isFolder,n=e.title,s=e.data;this.props.metadataActions.createSecret({folder:null===t||void 0===t?void 0:t.id,isFolder:r,title:n,data:s})}},{key:"render",value:function(){var e=this.props.isFolder;return Object(je.jsxs)(ke,{show:this.props.shown,onClose:this.props.newSecretActions.hideModal,children:[Object(je.jsx)(ke.Header,{title:e?this.props.intl.formatMessage({id:"create folder title"}):this.props.intl.formatMessage({id:"create secret title"})}),Object(je.jsx)(ke.Body,{children:Object(je.jsxs)(_e,{id:"new-secret",onSubmit:this.onSubmit,disabled:!1,children:[Object(je.jsx)(qe,{label:e?this.props.intl.formatMessage({id:"Folder title"}):this.props.intl.formatMessage({id:"Secret title"}),name:"title",value:this.props.title,type:"text",onChange:this.props.newSecretActions.changeTitle,autoSelect:!0,required:!0}),!e&&Object(je.jsx)(Dr,{fields:this.props.data.fields,onChange:this.props.newSecretActions.changeField,isNew:!0,canUpdate:!0})]})}),Object(je.jsxs)(ke.Footer,{children:[Object(je.jsx)(Ue,{type:"reset",buttonStyle:"default",onClick:this.props.newSecretActions.hideModal,children:Object(je.jsx)(fe.a,{id:"Cancel"})}),Object(je.jsx)(Ue,{type:"submit",onClick:this.onSubmit,disabled:this.props.isLoading,children:e?Object(je.jsx)(fe.a,{id:"add folder button"}):Object(je.jsx)(fe.a,{id:"add secret button"})})]})]})}}]),r}(u.Component),ca=Object(g.b)((function(e,t){return Object(j.a)(Object(j.a)({},e.NewSecretUI),{},{isLoading:e.AppUI.loading,folder:t.folder})}),(function(e){return{newSecretActions:Object(ht.bindActionCreators)(i,e),metadataActions:Object(ht.bindActionCreators)(n,e)}}))(Object(pt.c)(ia));var oa=function(e){var t=e.folder,r=e.showAddFolder,n=Object(g.d)((function(e){return e.AppUI.currentUser})),s=Object(g.c)(),a=null,i=!0;return t&&(a=t.id,i=t.canBeUpdatedBy(n)),Object(je.jsxs)("div",{className:"secret-list-new",children:[Object(je.jsx)(ca,{folder:t}),Object(je.jsxs)(Ue,{title:"Add secret",buttonStyle:"primary",size:"small",disabled:!i,onClick:function(){return s(Cn({folder:a,isFolder:!1}))},children:[Object(je.jsx)(Se,{id:"add-secret",size:"small"}),Object(je.jsx)(fe.a,{id:"new secret"})]}),r&&Object(je.jsxs)(Ue,{title:"Add folder",buttonStyle:"primary",size:"small",disabled:!i,onClick:function(){return s(Cn({folder:a,isFolder:!0}))},children:[Object(je.jsx)(Se,{id:"add-folder",size:"small"}),Object(je.jsx)(fe.a,{id:"new folder"})]})]})},ua=r(164),da=r.n(ua),la=function(e){Object(v.a)(r,e);var t=Object(m.a)(r);function r(e){var n;return Object(p.a)(this,r),(n=t.call(this,e)).onChange=n.onChange.bind(Object(b.a)(n)),n.focus=n.focus.bind(Object(b.a)(n)),n.blur=n.blur.bind(Object(b.a)(n)),n}return Object(f.a)(r,[{key:"componentDidMount",value:function(){da.a.bind("mod+f",this.focus)}},{key:"componentWillUnmount",value:function(){da.a.unbind("mod+f",this.focus)}},{key:"onChange",value:function(e){this.props.onChange(e.target.value)}},{key:"focus",value:function(e){this.searchInput!==document.activeElement&&(this.searchInput.focus(),e.preventDefault())}},{key:"blur",value:function(e){"Escape"===e.key&&""===e.target.value&&this.searchInput.blur()}},{key:"render",value:function(){var e=this;return Object(je.jsx)("div",{className:"input input--type-search input--size-small",children:Object(je.jsx)("input",{ref:function(t){e.searchInput=t},type:"search",placeholder:this.props.intl.formatMessage({id:"search"}),onChange:this.onChange,onKeyDown:this.blur})})}}]),r}(u.Component),ha=Object(pt.c)(la),pa=U.DecryptMetadataStatus,fa=function(e){Object(v.a)(r,e);var t=Object(m.a)(r);function r(e){var n;return Object(p.a)(this,r),(n=t.call(this,e)).state={message:""},n}return Object(f.a)(r,[{key:"render",value:function(){if(!this.props.show)return null;var e=this.props,t=e.state,r=e.total,n="".concat(Math.round(t/r*100),"%"),s={width:n};return Object(je.jsxs)("div",{className:"user-connect-progress",children:[Object(je.jsx)("div",{className:"user-connect-progress-bar",style:s}),Object(je.jsx)("div",{className:"user-connect-progress-text",children:this.state.message}),Object(je.jsx)("div",{className:"user-connect-progress-title",children:n})]})}}],[{key:"getDerivedStateFromProps",value:function(e){var t=e.message;return{message:t instanceof pa?"Updating your secrets...":t}}}]),r}(u.Component),ba=Object(g.b)((function(e){if(!e.AppUI.status)return{show:!1};var t=e.AppUI.status;return{show:!0,message:t.message,state:t.state,total:t.total}}))(fa),va=function(e){Object(v.a)(r,e);var t=Object(m.a)(r);function r(e){var n;return Object(p.a)(this,r),(n=t.call(this,e)).onSearch=n.onSearch.bind(Object(b.a)(n)),n.state={searchQuery:e.searchQuery},n}return Object(f.a)(r,[{key:"onSearch",value:function(e){this.setState({searchQuery:e})}},{key:"render",value:function(){var e,t,r,n=!1;return this.props.showAll?(e="apps",t=Object(je.jsx)(fe.a,{id:"all"}),r="/secrets/all/",n=!0):this.props.showMine?(e="user",t=Object(je.jsx)(fe.a,{id:"my secrets"}),r="/secrets/mine/",n=!0):this.props.showShared&&(e="people",t=Object(je.jsx)(fe.a,{id:"shared secrets"}),r="/secrets/shared/",n=!0),Object(je.jsxs)("div",{className:"page",children:[Object(je.jsxs)("div",{className:"page-header",children:[n?Object(je.jsx)("div",{className:"breadcrumb",children:Object(je.jsx)(Zs,{icon:e,title:t,link:r})}):Object(je.jsx)(ta,{folders:this.props.folders}),Object(je.jsx)(aa,{}),Object(je.jsx)(ha,{onChange:this.onSearch})]}),Object(je.jsx)(ba,{}),Object(je.jsxs)("div",{className:"page-content",children:[Object(je.jsx)("div",{className:"page-content-actions",children:Object(je.jsx)(oa,{showAddFolder:!this.props.showAll&&!this.props.showMine&&!this.props.showShared,folder:this.props.folder})}),Object(je.jsx)("div",{className:"secret-list-content-table-header",children:Object(je.jsxs)("div",{children:[Object(je.jsx)("div",{className:"secret-list-item-column--title",children:Object(je.jsx)(fe.a,{id:"Title"})}),Object(je.jsx)("div",{className:"secret-list-item-column--last-modified",children:Object(je.jsx)(fe.a,{id:"Last modified"})}),Object(je.jsx)("div",{className:"secret-list-item-column--shared-with",children:Object(je.jsx)(fe.a,{id:"Shared with"})}),Object(je.jsx)("div",{className:"secret-list-item-column--actions"})]})}),Object(je.jsx)(sa,{filtered:n,secrets:this.props.secrets,folders:this.props.folders,isDragging:this.props.isDragging,searchQuery:this.state.searchQuery,endDecrypt:null===this.props.status})]})]})}}]),r}(u.Component);va.defaultProps={folders:[],secrets:{},searchQuery:"",showAll:!1,showMine:!1,showShared:!1};var ma=new pn.DragDropContext(hn.a)(Object(pn.DragLayer)((function(e){return{isDragging:e.isDragging()}}))(va)),ga=Object(on.a)((function(e){return e.path?e.path.split("/"):[]}),(function(e,t){return dn()(e,t)}));function ya(e){var t=e.match.params,r=e.showAll,n=e.showMine,s=e.showShared,a=Object(g.d)((function(e){return e.Metadata.metadata})),i=Object(g.d)(oe),c=Object(g.d)(ue),o=Object(g.d)(le),u=ga(t),d=u[u.length-1],l=Object(g.d)((function(e){return de(e,d)}));if(r)return Object(je.jsx)(ma,{secrets:i,showAll:!0});if(n)return Object(je.jsx)(ma,{secrets:c,showMine:!0});if(s)return Object(je.jsx)(ma,{secrets:o,showShared:!0});var h=a.find((function(e){return e.id===d}));return Object(je.jsx)(ma,{folder:h,folders:u,secrets:l})}ya.defaultProps={showAll:!1,showMine:!1,showShared:!1};var ja=ya,wa=function(e){Object(v.a)(r,e);var t=Object(m.a)(r);function r(e){var n;return Object(p.a)(this,r),(n=t.call(this,e)).handleChange=n.handleChange.bind(Object(b.a)(n)),n.handleSubmit=n.handleSubmit.bind(Object(b.a)(n)),n.state={shortpass:""},n}return Object(f.a)(r,[{key:"handleChange",value:function(e){var t=e.name,r=e.value;this.setState(Object(ye.a)({},t,r))}},{key:"handleSubmit",value:function(){this.props.actions.activateShortLogin({shortpass:this.state.shortpass})}},{key:"render",value:function(){return Object(je.jsxs)(ke,{show:this.props.shown,onClose:this.props.actions.hideShortLogin,children:[Object(je.jsx)(ke.Header,{children:Object(je.jsx)("span",{className:"text",children:"Trust this device"})}),Object(je.jsx)(ke.Body,{children:Object(je.jsx)(_e,{className:"totp-form",id:"totp",onSubmit:this.handleSubmit,children:Object(je.jsx)(qe,{label:"Shortpass",name:"shortpass",value:this.state.shortpass,type:"password",onChange:this.handleChange,autoFocus:!0})})}),Object(je.jsxs)(ke.Footer,{children:[Object(je.jsx)(Ue,{type:"reset",buttonStyle:"default",onClick:this.props.actions.hideShortLogin,children:"Close"}),Object(je.jsx)(Ue,{type:"button",buttonStyle:"primary",onClick:this.handleSubmit,disabled:this.props.loading,children:"Activate"})]})]})}}],[{key:"getDerivedStateFromProps",value:function(e){return e.shown?null:{shortpass:""}}}]),r}(u.Component);wa.defaultProps={shown:!1,errors:{},loading:!1};var Oa=Object(g.b)((function(e){var t=e.Options;return{errors:t.errors,shown:t.showShortLogin,loading:t.loading}}),(function(e){return{actions:Object(ht.bindActionCreators)(c,e)}}))(wa),Sa=r(236),xa=r.n(Sa),ka=function(e){Object(v.a)(r,e);var t=Object(m.a)(r);function r(e){var n;return Object(p.a)(this,r),(n=t.call(this,e)).handleChange=n.handleChange.bind(Object(b.a)(n)),n.handleSubmit=n.handleSubmit.bind(Object(b.a)(n)),n.state={seed:O.a.Utils.generateSeed(),token:""},n}return Object(f.a)(r,[{key:"handleChange",value:function(e){var t=e.value.replace(/\s+/g,"").slice(0,6);this.setState({token:t})}},{key:"handleSubmit",value:function(){this.props.actions.activateTotp(this.state)}},{key:"render",value:function(){return Object(je.jsxs)(ke,{show:this.props.shown,onClose:this.props.actions.hideQRCode,children:[Object(je.jsx)(ke.Header,{children:Object(je.jsx)("span",{className:"text",children:"Activate Two-Factor authentication"})}),Object(je.jsx)(ke.Body,{children:Object(je.jsxs)(_e,{className:"totp-form",id:"totp",onSubmit:this.handleSubmit,children:[Object(je.jsx)("div",{className:"totp-form-qrcode",children:Object(je.jsx)(xa.a,{className:"totp-form-qrcode",value:"otpauth://totp/Secret-in.me?secret=".concat(this.state.seed.b32),size:256})}),Object(je.jsx)(qe,{name:"token",inputProps:{maxLength:6},placeholder:"6-digit code",value:this.state.token,onChange:this.handleChange,onSubmit:this.handleSubmit,error:this.props.errors.totp,autoFocus:!0})]})}),Object(je.jsxs)(ke.Footer,{children:[Object(je.jsx)(Ue,{type:"reset",buttonStyle:"default",onClick:this.props.actions.hideQRCode,children:"Close"}),Object(je.jsx)(Ue,{type:"button",buttonStyle:"primary",onClick:this.handleSubmit,disabled:this.props.loading,children:"Activate"})]})]})}}],[{key:"getDerivedStateFromProps",value:function(e){return e.shown?null:{seed:O.a.Utils.generateSeed(),token:""}}}]),r}(u.Component);ka.defaultProps={shown:!1,errors:{},loading:!1};var Ca=Object(g.b)((function(e){var t=e.Options;return{errors:t.errors,shown:t.showQRCode,loading:t.loading}}),(function(e){return{actions:Object(ht.bindActionCreators)(c,e)}}))(ka);function Ua(e){var t=e.username,r=e.rescueCodes.map((function(e,t){return"".concat(t+1,". ").concat(e)})),n=["SAVE YOUR BACKUP CODES","Keep these backup codes somewhere safe but accessible.",""].concat(Object(fn.a)(r),["","* Codes for user ".concat(t),"* Generated on ".concat(tt()().format("MMM Do, YYYY")),"* You can only use each backup code once.","* Need new codes? Go to ".concat(document.location.href)]).join("\n");return new Blob([n],{type:"text/plain;charset=utf-8;"})}var Aa=function(e){Object(v.a)(r,e);var t=Object(m.a)(r);function r(e){var n;return Object(p.a)(this,r),(n=t.call(this,e)).currentUser=e.currentUser,n}return Object(f.a)(r,[{key:"render",value:function(){var e=this.props.rescueCodes,t=this.currentUser.username;return Object(je.jsxs)(ke,{show:this.props.shown,onClose:this.props.actions.hideRescueCodes,children:[Object(je.jsx)(ke.Header,{children:Object(je.jsx)("span",{className:"text",children:"Rescue codes"})}),Object(je.jsxs)(ke.Body,{children:[Object(je.jsx)("h3",{children:"You should view and download your recovery codes and keep them safe."}),Object(je.jsx)("p",{children:"If you lose access to your secure token and your code generator, a recovery code is the only way to recover your account."}),Object(je.jsx)("pre",{children:e.join(" ")}),Object(je.jsx)("p",{children:Object(je.jsx)("a",{href:window.URL.createObjectURL(Ua({username:t,rescueCodes:e})),download:"Backup-codes-".concat(t,"@secretin.txt"),children:"Download my codes"})})]}),Object(je.jsx)(ke.Footer,{children:Object(je.jsx)(Ue,{type:"reset",buttonStyle:"default",onClick:this.props.actions.hideRescueCodes,children:"Close"})})]})}}]),r}(u.Component);Aa.defaultProps={shown:!1,rescueCodes:[]};var Pa=Object(g.b)((function(e){var t=e.Options;return{rescueCodes:t.rescueCodes,shown:t.showRescueCodes,currentUser:e.AppUI.currentUser}}),(function(e){return{actions:Object(ht.bindActionCreators)(c,e)}}))(Aa),Na=function(e){Object(v.a)(r,e);var t=Object(m.a)(r);function r(e){var n;return Object(p.a)(this,r),(n=t.call(this,e)).handleChangePassword=n.handleChangePassword.bind(Object(b.a)(n)),n}return Object(f.a)(r,[{key:"handleChangePassword",value:function(){this.props.dispatch(is({newPass:this.props.newPass1}))}},{key:"render",value:function(){var e=this;return Object(je.jsxs)(ke,{show:this.props.shown,onClose:function(){return e.props.dispatch(Qn())},children:[Object(je.jsx)(ke.Header,{children:Object(je.jsx)("span",{className:"text",children:"Change master password"})}),"success"!==this.props.status?Object(je.jsxs)(ke.Body,{children:[Object(je.jsx)(qe,{name:"newPass1",label:"New password",value:this.props.newPass1,onChange:function(){return e.props.dispatch(Vn.apply(c,arguments))},type:"password",disabled:this.props.loading}),this.props.newPass1.length>0&&Object(je.jsx)("span",{className:"options-changepassword",children:Object(je.jsx)(qe,{name:"newPass2",label:"Retype",value:this.props.newPass2,onChange:function(){return e.props.dispatch(Wn.apply(c,arguments))},type:"password",disabled:this.props.loading})}),Object(je.jsxs)("div",{className:"options-changepassword-infos",children:[""===this.props.error&&this.props.newPass1.length>0&&this.props.newPass1!==this.props.newPass2&&"Passwords mismatch",""!==this.props.error&&this.props.error]})]}):Object(je.jsx)(ke.Body,{children:Object(je.jsx)("div",{className:"options-changepassword-success",children:"Success"})}),Object(je.jsxs)(ke.Footer,{children:[Object(je.jsx)(Ue,{type:"reset",buttonStyle:"default",onClick:function(){return e.props.dispatch(Qn())},children:"Close"}),this.props.newPass1.length>0&&Object(je.jsx)(Ue,{type:"button",buttonStyle:"primary",onClick:this.handleChangePassword,disabled:this.props.newPass1!==this.props.newPass2,children:"Change it"})]})]})}}]),r}(u.Component);Na.defaultProps={shown:!1,loading:!1,newPass1:"",newPass2:"",error:""};var Ta=Object(g.b)((function(e){var t=e.Options.newPass;return{error:t.error,shown:t.shown,loading:t.loading,status:t.status,newPass1:t.newPass1,newPass2:t.newPass2}}))(Na),Da=function(e){Object(v.a)(r,e);var t=Object(m.a)(r);function r(e){var n;return Object(p.a)(this,r),(n=t.call(this,e)).onChange=n.onChange.bind(Object(b.a)(n)),n.id=Object(Ee.uniqueId)("input_"),n}return Object(f.a)(r,[{key:"onChange",value:function(e){this.props.onChange({name:this.props.name,checked:e.target.checked})}},{key:"render",value:function(){var e=ge()("checkbox",{"checkbox--checked":this.props.checked,"checkbox--unchecked":!this.props.checked});return Object(je.jsxs)("div",{className:"input input--type-checkbox",children:[Object(je.jsx)("input",{id:this.id,type:"checkbox",name:this.props.name,checked:this.props.checked,disabled:this.props.disabled,onChange:this.onChange}),Object(je.jsxs)("label",{htmlFor:this.id,children:[Object(je.jsx)("div",{className:e}),this.props.children]})]})}}]),r}(u.Component);Da.defaultProps={checked:!1,disabled:!1};var Ka=Da,Fa=function(e){Object(v.a)(r,e);var t=Object(m.a)(r);function r(e){var n;return Object(p.a)(this,r),(n=t.call(this,e)).onChangeTimeToClose=n.onChangeTimeToClose.bind(Object(b.a)(n)),n.onChangeDefaultUsername=n.onChangeDefaultUsername.bind(Object(b.a)(n)),n.onSaveDefaultUsername=n.onSaveDefaultUsername.bind(Object(b.a)(n)),n.state={defaultUsername:e.options.defaultUsername},n}return Object(f.a)(r,[{key:"onChangeDefaultUsername",value:function(e){var t=e.value;this.setState({defaultUsername:t})}},{key:"onChangeTimeToClose",value:function(e){var t=e.value;this.props.actions.changeTimeToClose({timeToClose:""===t?-1:parseInt(t,10)||0})}},{key:"onSaveDefaultUsername",value:function(){this.props.actions.changeDefaultUsername({defaultUsername:this.state.defaultUsername})}},{key:"render",value:function(){var e=this.props,t=e.options,r=e.isOnline,n=e.options.defaultUsername,s=void 0===n?"":n;return Object(je.jsxs)("div",{className:"page",children:[Object(je.jsx)("div",{className:"page-header",children:Object(je.jsx)("div",{className:"breadcrumb",children:Object(je.jsx)(Zs,{link:"/options/",icon:"gear",title:"Options"})})}),Object(je.jsxs)("div",{className:"page-content options",children:[Object(je.jsxs)("div",{className:"options-section",children:[Object(je.jsx)("h3",{className:"options-section-title",children:"Experience"}),Object(je.jsxs)("div",{className:"options-section-item",children:[Object(je.jsx)(qe,{name:"defaultUsername",label:"Default username",size:"small",value:this.state.defaultUsername,onChange:this.onChangeDefaultUsername,disabled:!r}),Object(je.jsx)("div",{className:"options-section-subitem-save",children:Object(je.jsx)(Ue,{type:"button",buttonStyle:this.state.defaultUsername===s?"default":"primary",onClick:this.onSaveDefaultUsername,size:"small",disabled:!r||this.state.defaultUsername===s,children:"Save"})})]})]}),Object(je.jsxs)("div",{className:"options-section",children:[Object(je.jsx)("h3",{className:"options-section-title",children:"Security"}),Object(je.jsxs)("div",{className:"options-section-item",children:[Object(je.jsx)(Ca,{}),Object(je.jsx)(Ka,{checked:t.totp,onChange:this.props.actions.toggleTotp,disabled:!r,children:"Activate two-factor authentication"}),t.totp&&Object(je.jsxs)("div",{className:"options-section-subitem",children:[Object(je.jsx)(Pa,{}),Object(je.jsx)(Ue,{size:"small",buttonStyle:"default",onClick:this.props.actions.showRescueCodes,children:"Generate rescue Codes"})]})]}),Object(je.jsxs)("div",{className:"options-section-item",children:[Object(je.jsx)(Oa,{}),Object(je.jsx)(Ka,{checked:t.shortLogin,onChange:this.props.actions.toggleShortLogin,disabled:!r,children:"Activate ShortLogin"})]}),Object(je.jsxs)("div",{className:"options-section-item",children:[Object(je.jsx)(Ka,{checked:0!==t.timeToClose,onChange:this.props.actions.toggleAutoLogout,disabled:!r,children:"Activate auto logout"}),(-1===t.timeToClose||t.timeToClose>0)&&Object(je.jsxs)("div",{className:"options-section-subitem",children:["Disconnect me after ",Object(je.jsx)(qe,{name:"timeToClose",label:"",size:"small",value:-1===t.timeToClose?"":t.timeToClose.toString(),onChange:this.onChangeTimeToClose,type:"number",inputProps:{min:0,max:60,step:5},disabled:!r}),Object(je.jsx)("b",{children:" min"})]})]})]}),Object(je.jsx)("div",{className:"options-section",children:Object(je.jsxs)("div",{className:"options-section-item",children:[Object(je.jsx)(Ta,{}),Object(je.jsx)(Ue,{type:"button",buttonStyle:"warning",onClick:this.props.actions.showChangePassword,disabled:!r,children:"Change master password"})]})})]})]})}}]),r}(u.Component),Ia=Object(g.b)((function(e){return{options:e.Options.options,isOnline:e.AppUI.online}}),(function(e){return{actions:Object(ht.bindActionCreators)(c,e)}}))(Fa);var Ea=function(){return Object(je.jsx)("div",{className:"spinner",children:Object(je.jsx)("svg",{className:"spinner-svg",viewBox:"0 0 66 66",xmlns:"http://www.w3.org/2000/svg",children:Object(je.jsx)("circle",{className:"spinner-svg-path",fill:"none",strokeWidth:"3",strokeLinecap:"round",cx:"33",cy:"33",r:"30"})})})},Ra=function(e){Object(v.a)(r,e);var t=Object(m.a)(r);function r(e){var n;return Object(p.a)(this,r),(n=t.call(this,e)).handleFileInputChange=n.handleFileInputChange.bind(Object(b.a)(n)),n}return Object(f.a)(r,[{key:"handleFileInputChange",value:function(e){this.props.onFileChoosen(e.target.files[0])}},{key:"render",value:function(){return this.props.connectDropTarget(Object(je.jsxs)("div",{className:"import-drop-zone",children:[Object(je.jsx)(Se,{id:"upload",size:120}),Object(je.jsxs)("div",{className:"import-drop-zone-label",children:[Object(je.jsx)("input",{id:"import-drop-zone-input",className:"import-drop-zone-input",type:"file",onChange:this.handleFileInputChange}),Object(je.jsx)("label",{htmlFor:"import-drop-zone-input",children:"Choose a file"}),Object(je.jsx)("span",{children:" or drag it here."})]})]}))}}]),r}(u.Component);var Ma=new pn.DropTarget(ln.NativeTypes.FILE,{drop:function(e,t){e.onFileChoosen(t.getItem().files[0])}},(function(e,t){return{connectDropTarget:e.dropTarget(),isOver:t.isOver()}}))(Ra),La=new pn.DragDropContext(hn.a)(Ma),Ba=function(e){Object(v.a)(r,e);var t=Object(m.a)(r);function r(e){var n;return Object(p.a)(this,r),(n=t.call(this,e)).handleChange=n.handleChange.bind(Object(b.a)(n)),n}return Object(f.a)(r,[{key:"handleChange",value:function(e){var t=e.value,r={field:this.props.field,value:t};this.props.onChange(r)}},{key:"render",value:function(){var e=this;return Object(je.jsx)(qe,{ref:function(t){e.input=t},label:this.props.field.name,name:this.props.field.name,value:this.props.field.value,onChange:this.handleChange,type:this.props.field.type})}}]),r}(u.Component),Ha=function(e){Object(v.a)(r,e);var t=Object(m.a)(r);function r(){return Object(p.a)(this,r),t.apply(this,arguments)}return Object(f.a)(r,[{key:"render",value:function(){var e=this,t=Object.keys(this.props.mandatoryFields),r=[];return t.forEach((function(t){r.push(Object(je.jsx)(Ba,{field:e.props.mandatoryFields[t],onChange:e.props.actions.changeMandatoryField},t))})),Object(je.jsx)("div",{children:r})}}]),r}(u.Component),_a=Object(g.b)((function(e){return{mandatoryFields:e.Import.mandatoryFields}}),(function(e){return{actions:Object(ht.bindActionCreators)(o,e)}}))(Ha),za=function(e){Object(v.a)(r,e);var t=Object(m.a)(r);function r(e){var n;return Object(p.a)(this,r),(n=t.call(this,e)).handleFileChoosen=n.handleFileChoosen.bind(Object(b.a)(n)),n.handleStartParsing=n.handleStartParsing.bind(Object(b.a)(n)),n}return Object(f.a)(r,[{key:"handleFileChoosen",value:function(e){this.props.importActions.detectType({file:e})}},{key:"handleStartParsing",value:function(){this.props.importActions.importSecrets({file:this.props.file,mandatoryFields:this.props.mandatoryFields,type:this.props.importType})}},{key:"shouldComponentUpdate",value:function(e,t){return!0!==this.props.success||e.success!==this.props.success}},{key:"componentDidUpdate",value:function(){var e=this;this.props.success&&(this.props.metadataActions.loadMetadata(),setTimeout((function(){e.props.importActions.defaultStore()}),1500))}},{key:"render",value:function(){return Object(je.jsxs)("div",{className:"page",children:[Object(je.jsx)("div",{className:"page-header",children:Object(je.jsx)("div",{className:"breadcrumb",children:Object(je.jsx)(Zs,{link:"/import/",icon:"import",title:"Import"})})}),Object(je.jsxs)("div",{className:"page-content options",children:[Object(je.jsxs)("span",{children:["Supported type are ",Object(je.jsx)("i",{children:"secret-in"}),", ",Object(je.jsx)("i",{children:"keepass"})]}),(this.props.success||this.props.importing)&&(this.props.success&&Object(je.jsxs)("div",{className:"import-progress",children:[Object(je.jsx)(Se,{id:"done",size:120}),Object(je.jsx)("div",{className:"import-progress-title",children:"Done!"})]})||Object(je.jsxs)("div",{className:"import-progress",children:[Object(je.jsx)(Ea,{}),0!==this.props.importTotal&&Object(je.jsx)("div",{className:"import-progress-title",children:"Importing... ".concat(this.props.importStatus," / ").concat(this.props.importTotal)})]}))||Object(je.jsx)(La,{onFileChoosen:this.handleFileChoosen}),""!==this.props.error&&Object(je.jsx)("span",{children:this.props.error.message}),Object.keys(this.props.mandatoryFields).length>0&&Object(je.jsx)(_a,{mandatoryFields:this.props.mandatoryFields}),""!==this.props.importType&&Object(je.jsxs)(Ue,{buttonStyle:"primary",className:"button button--style-default button--size-base",onClick:this.handleStartParsing,children:["Import from ",this.props.importType]})]})]})}}]),r}(u.Component),Ga=Object(g.b)((function(e){var t=e.Import;return{error:t.error,importType:t.importType,importing:t.importing,importStatus:t.importStatus,importTotal:t.importTotal,success:t.success,file:t.file,mandatoryFields:t.mandatoryFields}}),(function(e){return{importActions:Object(ht.bindActionCreators)(o,e),metadataActions:Object(ht.bindActionCreators)(n,e)}}))(za);var Ja=function(){return Object(je.jsxs)("div",{className:"layout",children:[Object(je.jsx)(cn,{}),Object(je.jsx)(lt,{}),Object(je.jsx)("div",{className:"layout-pane",children:Object(je.jsxs)(it.d,{children:[Object(je.jsx)(it.b,{path:"/secrets/all",render:function(e){return Object(je.jsx)(ja,Object(j.a)(Object(j.a)({},e),{},{showAll:!0}))}}),Object(je.jsx)(it.b,{path:"/secrets/mine",render:function(e){return Object(je.jsx)(ja,Object(j.a)(Object(j.a)({},e),{},{showMine:!0}))}}),Object(je.jsx)(it.b,{path:"/secrets/shared",render:function(e){return Object(je.jsx)(ja,Object(j.a)(Object(j.a)({},e),{},{showShared:!0}))}}),Object(je.jsx)(it.b,{path:"/secrets/:path*",render:function(e){return Object(je.jsx)(ja,Object(j.a)({},e))}}),Object(je.jsx)(it.b,{path:"/settings/",component:Ia}),Object(je.jsx)(it.b,{path:"/import/",component:Ga}),Object(je.jsx)(it.a,{to:"/secrets/"})]})})]})},Ya=function(e){Object(v.a)(r,e);var t=Object(m.a)(r);function r(e){var n;return Object(p.a)(this,r),(n=t.call(this,e)).disconnectingEvent=null,n.onAppFocus=n.onAppFocus.bind(Object(b.a)(n)),n.onAppBlur=n.onAppBlur.bind(Object(b.a)(n)),n.handleConnectionChange=n.handleConnectionChange.bind(Object(b.a)(n)),window.addEventListener("focus",n.onAppFocus),window.addEventListener("blur",n.onAppBlur),n}return Object(f.a)(r,[{key:"componentDidMount",value:function(){P.addEventListener("connectionChange",this.handleConnectionChange)}},{key:"componentWillUnmount",value:function(){P.removeEventListener("connectionChange",this.handleConnectionChange)}},{key:"handleConnectionChange",value:function(e){var t=e.connection;this.props.dispatch(V(t))}},{key:"onAppFocus",value:function(){clearTimeout(this.disconnectingEvent)}},{key:"onAppBlur",value:function(){clearTimeout(this.disconnectingEvent);var e=this.props,t=e.connected,r=e.options;if(t&&r&&r.timeToClose>0){var n=60*r.timeToClose*1e3;this.disconnectingEvent=setTimeout((function(){return window.location.reload()}),n)}}},{key:"render",value:function(){var e=this;return yn(),Object(je.jsx)(mn.b,{locale:gn(),defaultLocale:gn(),messages:De(gn()),children:Object(je.jsx)(y.a,{basename:"",children:Object(je.jsxs)("div",{className:"App",children:[this.props.connected?Object(je.jsx)(Ja,{}):Object(je.jsx)(at,{savedUsername:this.props.savedUsername,loading:this.props.loading,errors:this.props.errors}),Object(je.jsx)(Be,{onChangeLanguage:function(){return e.forceUpdate()}})]})})})}}]),r}(u.Component),Va=Object(g.b)((function(e){var t=e.AppUI;return{savedUsername:t.savedUsername,loading:t.loading,errors:t.errors,connected:t.connected,secrets:de(e),options:e.Options.options}}))(Ya);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));r(484);var Wa=document.getElementById("root");h.a.render(Object(je.jsx)(g.a,{store:Ls,children:Object(je.jsx)(Va,{})}),Wa),"undefined"===typeof window.process&&"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()}))}},[[485,1,2]]]);
//# sourceMappingURL=main.20bd2dee.chunk.js.map